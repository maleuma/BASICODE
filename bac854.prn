SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   1
BAC854  Z80

    1         0000      KC3	EQU	0	; Rechnertyp = KC85/4
    2         0000      DEV	EQU	0	; keine Device-Umschaltung gewaehlt
    3                   INCLUDE	BAC85.Z80
    1                   ;---------------------------------------------------------------------
    2                   ;	BASICODE 3C Version 1.5 fuer Kleincomputer KC85/4
    3                   ;	(C) Andreas und Uwe Zierott	Stand: 31.01.1990
    4                   ;	Farbe von Rudolf Wenzel		Stand: 08.12.1992
    5                   ;
    6                   ; Reassemblerlisting erzeugt mit Reassembler QMR unter CAOS
    7                   ; BAC854C.ASM		Adressen: 0401 bis 256A
    8                   ;
    9                   ; M. Leubner		03.04.2023 bis 19.04.2023
   10                   ;---------------------------------------------------------------------
   11                   ;
   12                   ; Modifikationen:
   13                   ; 11.11.2023:
   14                   ;	- GOSUB 280 (Aus- bzw. Einschalten der STOP/BRK-Taste FR = 0 bzw. 1)
   15                   ;	  deaktiviert, dadurch keine Kopie der KTAB mehr erforderlich
   16                   ;	- Copyright-Texte angepasst, Versionsnummer 1.5a eingetragen
   17                   ;	- Arbeitszellen so verlagert, dass 0000-000Fh frei bleibt fuer USB
   18                   ;	  (00AE-00E0h ist bereits unberuehrt weil KTAB nicht mehr kopiert wird)
   19                   ;	- einige Variablen umbenannt
   20                   ;	- unnuetze NOP-Befehle entfernt
   21                   ;	- GOSUB 220 kann jetzt auch aus Bild 1 Zeichen lesen
   22                   ;	- Codeoptimierung (CALL x, RET ersetzt durch JP x)
   23                   ;	- Codeoptimierung, indem alle gepatchten Spruenge der Farberweiterung
   24                   ;	  direkt in den Originalcode verschoben wurden (vermutlich hat R. Wenzel
   25                   ;	  auch keinen Quelltext gehabt und das Programm nur zum Teil uebersetzt)
   26                   ;	- 80 freie Bytes zwischen Grundprogramm und Farberweiterung geloescht
   27                   ;	Druckertreiber:
   28                   ;	- Modulsuche vorwaerts ab Steckplatz 7 (vorher rueckwaerts von 0 bis 1)
   29                   ;	- eingeschaltetes M003 wird jetzt auch im Steuerbytespeicher eingetragen
   30                   ;
   31                   ;	Version 1.5a veroeffentlicht
   32                   ;
   33                   ; 12.11.2023:
   34                   ;	- Idee1: Statt KTAB das UP KBDS ueber die SUTAB modifizieren.
   35                   ;	  Funktioniert aber nicht, da KBDS innerhalb von BASPV direkt benutzt
   36                   ;	- Idee2: KTAB auf Adresse E0-15Fh kopiert und GOSUB 280 wieder aktiviert
   37                   ;	  Funktioniert auch nicht richtig, da ubasex des M052 die Adressen
   38                   ;	  von 00BE bis 00FFh belegt (Systemabsturz bei CAOS 4.2)
   39                   ; 13.11.2023:
   40                   ;	- JP IRMOFF wieder ersetz durch CALL IRMOFF, RET (sonst Absturz)
   41                   ;	- Kaltstart setzt nun Nullbytes fuer Programmanfang korrekt
   42                   ; 16.11.2023:
   43                   ;	- Standardfarbe geaendert von Tuerkis/rot auf gelb/blau
   44         0031      DEFCOL	EQU	31H		; gelb auf blau (Original 2AH tuerkis auf rot)
   45                   ;	- Farbe bei Programmstart: weiss/schwarz
   46                   ;	- wenn CC() nicht definiert ist -> keine Aenderung der Farben
   47                   ; 17.11.2023:
   48                   ;	- Unterprogramm U1F3B aufgeloest und direkt eingebaut (nur 1x verwendet)
   49                   ;	- Farbwert bei Textanzeige im Grafikmode direkt aus CAOS-Arbeitszelle
   50                   ;	  lesen, statt Programmcode bei U1F25 zu modifizieren
   51                   ;	- Grafikfarbe bei Initialisierung nicht voreinstellen, wird vom Titel-
   52                   ;	  bild (Schallplatte) ohnehin ueberschrieben
   53                   ; 19.11.2023:
   54                   ;	- GOSUB 620, GOSUB 630 und GOSUB 650 Sprung entfernt (Patch?)
   55                   ;	- Grafikfarbe in FARB speichern und nicht mehr Programmcode modifizieren
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   2
BAC85   Z80

   56                   ;	- Code fuer Punkt/Linie zusammengefasst, Aufruf ueber PV3 + Register E
   57                   ;
   58                   ;	Version 1.5b veroeffentlicht
   59                   ;
   60                   ; 21.11.2023:
   61                   ;	- Version fuer KC85/3 in Vorbereitung nach BAC853C.SSS (Version 1.6)
   62                   ;	  * schnelle CLS-Routine
   63                   ;	  * VRAM ist immer B200H
   64                   ;	  * Punkt setzen/loeschen mit PUSE/PUDE
   65                   ; 18.12.2023:
   66                   ;	- Stack in 0B7CBH eintragen fuer Kompatibilitaet zu CAOS 3.4 und OS/pi
   67                   ;	- Zeichenzaehler A' retten beim Konvertieren BASIC -> ASCII fuer
   68                   ;	  Kompatibilitaet zu OS/pi (IRMON/OFF veraendert A')
   69                   ;	- Vortonlaenge beim KC-Format generell auf 400H gesetzt
   70                   ;	- IRM-Adresse fuer letzte Zeile links/unten rechnerspezifisch
   71                   ;	- Inversdarstellung KC85/3 fuer GOSUB 150 implementiert
   72                   ;	- Linien-Routine fuer KC85/3 implementiert
   73                   ;	- Test auf "schwaches Kassetteninterface" wieder eingebaut
   74                   ;	  (war nur noch in KC85/3-Version drin, Text aber in beiden Versionen)
   75                   ;	- Zeichen malen bei U09DD fuer KC85/3 implementiert
   76                   ; 20.12.2023:
   77                   ;	- Text im Grafikmodus (GOSUB 650) implementiert fuer KC85/3
   78                   ;	  Test mit "Tuerme von Hanoi": OK
   79                   ;	- FLOAD-Menuewort wird jetzt bei Initialisierung mit geloescht
   80                   ; 22.12.2023:
   81                   ;	- CN in Grafikfarbe einbauen bei UP Punkt/Linie am KC85/3
   82                   ; 23.12.2023:
   83                   ;	- GOSUB 150: Farbe aus CC(0/1) wird nicht mehr uebernommen
   84                   ;	- GOSUB 650: Farbebene nur noch schreiben, wenn Pixelebene Inhalt hat
   85                   ; 26.12.2023:
   86                   ;	- HEX-Ausgabe fuer Blocknummernanzeige optimiert
   87                   ;	- Anzeige "Speicher voll" verschoben und damit Sprungbefehl eingespart
   88                   ;	- U1671 und U17D7 verschoben und damit je einen Sprungbefehl eingespart
   89                   ;	- U1AAE verschoben, ein Sprungbefehl eingespart, 2x JP in JR verwandelt
   90                   ;	- U09AC (SCF,RET) an andere Stelle gelegt und 2 Byte gespart
   91                   ;
   92                   ;	Version 1.5c veroeffentlicht
   93                   ;
   94                   ;	- Dateiname wird bei ISRI und ISRO nicht in HL uebergeben
   95                   ;	- Die Datenfiles enthalten als erstes 3x UUU, dann 8 Zeichen fuer den
   96                   ;	  Dateinamen und noch ein 00h. Erst danach beginnen die Nutzdaten.
   97                   ;	  Das ist fuer USB/DISK nicht sinnvoll und waere bei Nutzung von
   98                   ;	  MBIN/MBOUT nicht der Fall. Besser also gleich auf MBIN/MBOUT umstellen
   99                   ;	  dann waere eventuell auch BASEX nutzbar.
  100                   ; 27.12.2023:
  101                   ;	- Beim Schreiben auf Kassette landet man im CAOS beim PRINT nach CLOSE
  102                   ;	  Ursache ist der Aufruf von CSRO ohne vorheriges ISRO.
  103                   ;	  (CSRO setzt OUTAB und WEND auf die gespeicherten Werte von ISRO)
  104                   ;	  Das Problem tritt nicht auf, wenn zuvor mit LOAD/CLOAD Daten von
  105                   ;	  Kassette geladen wurden - wie es frueher noetig war.
  106                   ;	  -> CAOS 4.9 initialisiert nun zur Sicherheit ZOTAB und ZWEND
  107                   ; 28.12.2023:
  108                   ;	- U09B7 (untere Bildschirmzeile nach U0000 kopieren) direkt eingebaut
  109                   ;	- Dateiname mit "UUU12345678" vorbereiten fuer MBIN/MBOUT
  110                   ; Umstellung von ISRI/MBI/CSRI auf MBIN:
  111                   ;	- Oeffnen: HL=Dateiname, D=08H
  112                   ;	  MBIN uebergibt beim Oeffnen bereits das erste Datenbyte. Das wird hier
  113                   ;	  in U0047 gespeichert, und beim folgenden Lesen dem Puffer entnommen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   3
BAC85   Z80

  114                   ;	- Lesen: D=0		PA: A=Datenbyte		CY=1 bei Fehler
  115                   ;	- Schliessen: D=40H
  116                   ; Umstellung von ISRO/MBO/CSRO auf MBOUT:
  117                   ;	- Oeffnen: HL=Dateiname, D=08H
  118                   ;	  MBOUT erwartet beim Oeffnen bereits das erste Datenbyte. Hier kann
  119                   ;	  also das Oeffnen vorerst nur gemerkt werden. Beim nachfolgenden
  120                   ;	  ersten Schreiben wird dann 1x D=8 mitgegeben.
  121                   ;	- Schreiben: D=0, A=Datenbyte			CY=1 bei Fehler
  122                   ;	- Schliessen: D=40H
  123                   ; 29.12.2023:
  124                   ;	- Dateiname des Datenfiles auf *.DDD (statt *.UUU geaendert)
  125                   ;	- BASEX/UBASEX setzt bei UMBOUT Bit 0(IX+8), um das Verify von CAOS
  126                   ;	  abzuwaehlen -> Nach Close das Bit wieder loeschen
  127                   ;	- TAPE: CAOS 3.1 macht 8 Sekunden Vorton, CAOS 4.9 ca. 4 Sekunden
  128                   ;	  -> laesst sich nicht vermeiden
  129                   ;	- CAOS 3.1: Blocknummernunterdrueckung funktioniert nicht bei Ein/Ausgabe
  130                   ;	  ueber USB (in M052-Software zu korrigieren)
  131                   ;	  ueber TAPE - nicht zu aendern, weil direkt in CAOS programmiert
  132                   ;	- CAOS 3.1 mit USB-Treiber schreibt nur 128 Byte, CAOS 4.9 256 Byte
  133                   ;	  Der Unterschied liegt am USB-Treiber (M052-Software/CAOS-Treiber)
  134                   ;	  Bei TAPE werden mindestens zwei Bloecke benoetigt, der Vorblock mit
  135                   ;	  dem Dateinamen und der Endeblock.
  136                   ; 30.12.2023:
  137                   ;	- zwei sinnlose Befehle nach U1AB5 auskommentiert
  138                   ;	- Die eigene Routine U04C3 (Spung zu IOERR) war zwar enthalten, aber
  139                   ;	  sinnlos, da diese nur von MBIN/MBOUT verwendet wurde, BASICODE 1.5
  140                   ;	  aber stattdessen MBI/MBO verwendet hat. F|er die neue Version mit
  141                   ;	  MBIN/MBOUT aber durchaus erforderlich.
  142                   ;	- Setzen von U04C3 als IO-ERROR-Routine verschoben zu WARM1, damit das
  143                   ;	  im Direktmode regeneriert wird
  144                   ;	- Neue Fehlerbehandlungsroutine fuer RUN-Mode, welche bei BASEX/UBASEX
  145                   ;	  nur das CY-Flag gesetzt zurueck gibt und nicht zu IOERR in den BASIC-
  146                   ;	  ROM springt. Getestet mit UBASEX unter CAOS 3.1 und CAOS 4.2
  147                   ; 02.01.2024:
  148                   ;	- kein CLS mehr bei GOTO 20, nur noch bei GOSUB 100 und 600
  149                   ;	- KTAB2 in Programm integriert und GOSUB 280 wieder aktiviert
  150                   ; 03.01.2024:
  151                   ;	- Absturz bei *L unter CAOS 3.4 behoben, dabei die Sonderbehandlung
  152                   ;	  der *-Sonderkommandos ueberarbeitet
  153                   ;	- CLS bei GOTO 20 wieder eingebaut
  154                   ; 04.01.2024:
  155                   ;	- DEVICE-Umschaltung auswaehlbar gemacht
  156                   ;		KC85/3-Version
  157                   ;		KC85/4-Version ohne DEVICE-Umschaltung
  158                   ;		KC85/5-Version mit DEVICE-Umschaltung
  159                   ;	- Test KTAB-Umschaltung BRK/STOP
  160                   ;
  161                   ;	Version 1.5d veroeffentlicht
  162                   ;
  163                   ;---------------------------------------------------------------------
  297                   .LIST
  298                   ;---------------------------------------------------------------------
  299                   
  300         000A      LF	EQU	0AH
  301         000D      CR	EQU	0DH
  302         001B      ESC	EQU	1BH
  303                   
  304                   ; Portadressen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   4
BAC85   Z80

  305                   
  306         0088      PIOAD	EQU	88H	; System-PIO Datenbyte Port A
  307                   			;	Bit 0 - CAOS ROM-E ein/aus
  308                   			;	Bit 1 - RAM0 ein/aus
  309                   			;	Bit 2 - IRM ein/aus
  310                   			;	Bit 3 - Schreibschutz RAM0
  311                   			;	Bit 4 - K_OUT
  312                   			;	Bit 5 - System-LED
  313                   			;	Bit 6 - Motorschaltspannung
  314                   			;	Bit 7 - USER-ROM ein/aus
  315         0089      PIOBD	EQU	89H	; System-PIO Datenbyte Port B
  316                   			;	Bit 0 - Symmetrie-Flip-Flop Tonausgabe
  317                   			;	Bit 1 \
  318                   			;	Bit 2 - Lautstaerke Tonausgabe
  319                   			;	Bit 3 - 4 Bit (Low-aktiv)
  320                   			;	Bit 4 /
  321                   			;	Bit 5 - RAM8 ein/aus
  322                   			;	Bit 6 - Schreibschutz RAM8
  323                   			;	Bit 7 - Blinken ein/aus
  324         008A      PIOAS	EQU	8AH	; System-PIO Steuerbyte Port A
  325         008C      CTC0	EQU	8CH	; CTC Kanal 0 (Tonhoehe 1)
  326         008D      CTC1	EQU	8DH	; CTC Kanal 1 (Tonhoehe 2, Kassettenausgabe)
  327         008E      CTC2	EQU	8EH	; CTC Kanal 2 (Tondauer)
  328                   
  329                   ;	*********************************
  330                   ;	*  Arbeitszellen von BASICODE	*
  331                   ;	*********************************
  332                   ;
  333                   ; Original:	0000H bis 00CEH bzw. 00CFH mit KTAB-Kopie
  334                   ; => nicht vertraeglich mit M052 USB-Tastatur und DEVICE-Treiber !!!
  335                   ;
  336                   ; neue Belegung:
  337                   ; 0000-000FH	belegt von USB-Software
  338                   ; 0010-0037H	ASCII-Speicher fuer eine Bildschirmzeile
  339                   ; 0038-003AH	RST38-Meldung Systemabsturz
  340                   ; 003BH		FLAGS (nicht verschieben!!!)
  341                   ; 003C-005EH	23 Byte BASICODE-Arbeitszellen
  342                   ; 005F-00ADH	79 Byte frei
  343                   ; 00AE-00E0H	USB-Interruptroutine
  344                   ; 00E1-014FH	111 Byte frei
  345                   ; 00D8-014FH	UBASEX: Zusatzroutinen wie DIENST.KCC (nicht nutzbar!)
  346                   ; 0150-016FH	BASEX/UBASEX: Umschaltroutine CALL*150
  347                   ; 0170-01C3H	84 Byte Stack
  348                   ; 01C4-01FFH	ISR-Tabelle und IX-Arbeitszellen
  349                   ; 0200-02FFH	BASEX/UBASEX und modifizierte SUTAB
  350                   ; 0300-03FFH	WORKRAM von BASIC
  351                   
  352                   ; 11.11.2023 Arbeitszellen erst ab Adresse 0010H und nur bis 005EH
  353                   
  354         0010      U0000	EQU	0010H		; Zwischenspeicher fuer Magnetbandroutinen
  355                   	;   bis 0037H		; 40 Zeichen = eine Bildschirmzeile
  356                   
  357         0038      U0038	EQU	0038H		; JUMP von RST 38
  358         0039      U0039	EQU	0039H		; Adresse von RST 38
  359                   
  360                   ; Adresse FLAGS=003BH nicht verlegen (wird vom Fullscreen-Editor ausgewertet)
  361         003B      FLAGS	EQU	003BH		; Bit0=1 Uebersetzung ASCII -> BASIC
  362                   				; Bit1=1 ASCII-File im Speicher
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   5
BAC85   Z80

  363                   				; Bit3=1 Init bei Kassettenein- und ausgabe
  364                   				; Bit6=1 unerlaubter BASICODE-Befehl
  365                   				; Bit7=1 Regelverstoss
  366                   
  367         003C      XPOS2	EQU	003CH		; X-Position (Linie X-Ende)
  368                   				; auch Zwischenspeicher fuer OUTAB
  369         003E      YPOS2	EQU	003EH		; Y-Position (Linie Y-Ende)
  370         0040      XPOS1	EQU	0040H		; aktuelle Grafikposition (Linie X-Anfang)
  371         0042      YPOS1	EQU	0042H		; aktuelle Grafikposition (Linie Y-Anfang)
  372         0044      CN	EQU	0044H		; "Color Numerisch"	CN=0 zeichnen
  373                   				; (GOSUB 620/630/650)	CN=1 loeschen
  374         0045      U0031	EQU	0045H		; Beginn ASCII-File
  375         0047      U0033	EQU	0047H		; Ende ASCII-File
  376         0049      CPOINT	EQU	0049H		; Zeiger in Kassettenpuffer bei Dateiarbeit
  377         004B      BLNR	EQU	004BH		; erwartete Blocknummer
  378         004C      U003C	EQU	004CH
  379         004D      U003D	EQU	004DH		; Merker fuer Interruptroutine PIO A
  380         004F      U003F	EQU	004FH		; Merker fuer Interruprroutine CTC1 oder CTC2
  381         0051      U0041	EQU	0051H		; Zwischenspeicher fuer UOUT1
  382                   				; Zeilennummer bei Konvertierung BASIC -> ASCII
  383         0053      U0043	EQU	0053H		; Bit0=1 Dateiende (Kassetteneingabe) erkannt
  384         0054      U0044	EQU	0054H		; FFH = Abbruch beim BASICODE Lesen/Schreiben
  385         0055      U0045	EQU	0055H		; Bit gesetzt fuer geoeffnete BASICODE-Kanaele
  386                   				; je ein Bit fuer NF=0 bis NF=7
  387         0056      U0046	EQU	0056H		; verwendet bei BASICODE-Bestand lesen/schreiben
  388         0057      U0047	EQU	0057H		; letztes gelesenes Datenbyte (Kassetteneingabe)
  389         005A      U004A	EQU	005AH		; Zaehlwert fuer BASICODE-Bandeingabe
  390         005C      U004C	EQU	005CH		; IRM-Adresse fuer malen auf unterer Bildschirmzeile
  391         005E      U004E	EQU	005EH		; Merkzelle fuer die Original-KTAB von CAOS
  392         0060      FNAME	EQU	0060H		; 11 Byte Dateiname fuer Kassettenroutinen
  393                   ;	bis	006AH
  394                   ;KTAB2	EQU	004FH		; Kopie der Tastaturtabelle KTAB
  395                   ;	;   bis 00CEH		; 11.11.2023: nicht mehr benutzt
  396                   
  397         01F0      U01F0	EQU	001F0H		; (IX+0) Zeitkonstante Kassettenroutinen
  398         01F2      U01F2	EQU	001F2H		; (IX+2) Blocknummer Kassettenroutinen
  399                   
  400                   ; WORKRAM von BASIC:
  401                   
  402         0340      DUMMY	EQU	0340H		; Anzahl der Dummy-Zeichen: NULL n
  403         034D      AUTOFG	EQU	034DH		; AUTO-Flag (automatische Zeilennummerierung)
  404         0356      STDPTR	EQU	0356H		; RAM-Mindestgroesse (KC85/3=7EFF KC85/4=BEFF)
  405         0358      CULINO	EQU	0358H		; aktuelle Zeilennummer
  406         035D      DATBYT	EQU	035DH		; Kopierschutz, wenn ungleich 0
  407         035F      PSTBEG	EQU	035FH		; Programmstart-Adresse (normal 0401H)
  408         0361      INPBUF	EQU	0361H		; Editierpuffer
  409         03AE      DATYPE	EQU	03AEH		; Datentyp
  410         03D7      SVARPT	EQU	03D7H		; Programmende + 1
  411         03D9      DVARPT	EQU	03D9H		; Adresse Feldvariablen
  412         03DB      FSLPTR	EQU	03DBH		; Erste freie Adresse nach den Variablenlisten
  413         03E5      WRA1	EQU	03E5H		; Arithmetikregister 1
  414                   
  415                   ; Arbeitszellen im IRM:
  416                   
  417         B781      ARGN	EQU	0B781H	; Anzahl Argumente
  418         B782      ARG1	EQU	0B782H	; Argument 1
  419         B784      ARG2	EQU	0B784H	;    "	   2
  420         B786      ARG3	EQU	0B786H	;    "	   3
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   6
BAC85   Z80

  421         B788      ARG4	EQU	0B788H	;    "	   4
  422         B796      NUMNX	EQU	0B796H	; Zeichenanzahl einer erfassten Zahl
  423                   			; hier genutzt als Zwischenspeicher Farbe bei GOSUB 150
  424         B799      HCADR	EQU	0B799H	; Hardcopy-Aufruf
  425         B79C      WINON	EQU	0B79CH	; Fenster-Anfang
  426         B79E      WINLG	EQU	0B79EH	; Fenster-Groesse
  427         B7A0      CURSO	EQU	0B7A0H	; Cursor-Position
  428         B7A3      COLOR	EQU	0B7A3H	; Farbe
  429         B7A6      CCTL0	EQU	0B7A6H	; Zeichentabelle 0 20H...5FH
  430         B7A8      CCTL1	EQU	0B7A8H	;	"	 1 00H...1FH und 60H...7FH
  431         B7B9      OUTAB	EQU	0B7B9H	; Adresse fuer Zeiger auf UP-Nr. bei Ausgabe
  432         B7BB      INTAB	EQU	0B7BBH	; Adresse fuer Zeiger auf UP-Nr. bei Eingabe
  433         B7BD      UOUT1	EQU	0B7BDH	; Sprung zu USER-Ausgabekanal 2 (Druckerausgabe)
  434         B7C6      UIN2	EQU	0B7C6H	; Sprung zu USER-Eingabekanal 3 V.24-duplex
  435         B7C9      IO_ERR	EQU	0B7C9H	; Reaktionsprogramm fuer BASIC I/O-Error bis CAOS 4.7
  436         B7CB      VRAM	EQU	0B7CBH	; VRAM-Adresse des eingestellten Bildes
  437         B7D3      HOR	EQU	0B7D3H	; Grafik Horizontalposition (X-Wert)
  438         B7D5      VERT	EQU	0B7D5H	; Grafik Vertikalposition (Y-Wert)
  439         B7D6      FARB	EQU	0B7D6H	; Grafik Farbe
  440                   		; Bit 0=1	XOR-Funktion
  441                   		; Bit 1=1	Punkt loeschen
  442                   		; Bit 2=1	Farbebene nicht veraendern
  443                   		; Bit 3-7	Vordergrundfarbe + Blinken
  444         B900      FNDEF	EQU	0B900H	; Funktionstastenspeicher (bis B99BH)
  445                   
  446                   ; Adressen aus dem BASIC-ROM:
  447                   
  448         C08C      SECST	EQU	0C08CH	; RESTART BASIC-Interpreter
  449         C33E      OMER	EQU	0C33EH
  450         C3FE      EDITO2	EQU	0C3FEH
  451         C4BB      ZPOIT	EQU	0C4BBH
  452         C5F1      TEXTOE	EQU	0C5F1H
  453         C689      CPREG	EQU	0C689H	; Vergleiche Register DE mit HL
  454         C767      LIST9	EQU	0C767H	; LIST: Stop nach vorgegebener Zeilenanzahl
  455         C791      LCREG	EQU	0C791H
  456         C79A      LIST11	EQU	0C79AH	; Token aufloesen
  457         C8BD      TCHAR	EQU	0C8BDH	; naechstes gueltiges Zeichen holen
  458         C8DF      RESTO	EQU	0C8DFH
  459         C918      STOP	EQU	0C918H
  460         C91B      END0	EQU	0C91BH
  461         C96F      EPRVL3	EQU	0C96FH	; Ausdruck berechnen -> DE
  462         C9AA      CLEAR	EQU	0C9AAH
  463         CB61      CRWDY2	EQU	0CB61H	; Anzeige CR, LF, Dummyzeichen
  464         CF48      DIM7	EQU	0CF48H	; Adresse einer Variablen holen -> DE
  465         D090      FRE	EQU	0D090H
  466         D0B1      FRE3	EQU	0D0B1H
  467         D0C0      POS1	EQU	0D0C0H
  468         D1E1      STROP	EQU	0D1E1H
  469         D46F      ADD5	EQU	0D46FH
  470         D59A      MUL1	EQU	0D59AH
  471         D5F5      DIV1	EQU	0D5F5H
  472         D697      TSGNM	EQU	0D697H
  473         D6AE      SGN1	EQU	0D6AEH
  474         D6BC      ABS	EQU	0D6BCH
  475         D6C0      ABS1	EQU	0D6C0H
  476         D6C8      OPARST	EQU	0D6C8H
  477         D6DD      OPKOP	EQU	0D6DDH	; Wert in Arithmetikregister 1 laden
  478         D6EE      OPLAD	EQU	0D6EEH
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   7
BAC85   Z80

  479         D6F7      OPTRAN	EQU	0D6F7H
  480         D829      NUMBO	EQU	0D829H
  481         D82A      NUMBO1	EQU	0D82AH
  482         D834      NUMKON	EQU	0D834H
  483         D928      EXPO	EQU	0D928H
  484         D9FD      RND	EQU	0D9FDH
  485         DC82      IOERR	EQU	0DC82H
  486         DCB0      CASS01	EQU	0DCB0H	; *.SSS Name holen
  487         DD57      CSAVE0	EQU	0DD57H	; BASIC-Programm abspeichern
  488         DDD5      CO	EQU	0DDD5H
  489                   
  490                   ; CAOS-Vereinbarungen:
  491                   
  492         F003      PV1	EQU	0F003H	; CAOS-UP aufrufen, DB UP-Nummer
  493         0000      CRT	EQU 00H		; Zeichenausgabe auf Bildschirm
  494                   ;MBO	EQU 01H		; Ausgabe Datenblock auf Kassette
  495         0002      UOT1	EQU 02H		; Ausgabe auf Anwenderkanal 1
  496         0004      KBD	EQU 04H		; Tastatureingebe mit Cursoreinblendung
  497                   ;MBI	EQU 05H		; Datenblock von Kassette einlesen
  498         0007      USIN2	EQU 07H		; Eingabe von Anwenderkanal 2
  499                   ;ISRO	EQU 08H		; Ausgabe 1. Block auf Kassette
  500                   ;CSRO	EQU 09H		; Ausgabe letzten Block auf Kassette
  501                   ;ISRI	EQU 0AH		; Einlesen 1. Block von Kassette
  502                   ;CSRI	EQU 0BH		; Abschluss Magnetbandeingabe
  503         000E      KBDZ	EQU 0EH		; Tastenstatusabfrage mit Quittung
  504         0012      LOOP	EQU 12H		; Ruecksprung zu CAOS-Menueschleife
  505         0014      WAIT	EQU 14H		; Warteschleife
  506         0023      OSTR	EQU 23H		; Ausgabe folgender Zeichenkette
  507         0024      OCHR	EQU 24H		; Zeichenausgabe ueber Ausgabetabelle
  508         0030      PUSE	EQU 30H		; Punkt setzen
  509         0034      PADR	EQU 34H		; Berechnen Pixel- und Farbadresse
  510         0037      MBIN	EQU 37H		; Byteweise Eingabe von Kassette
  511         0038      MBOUT	EQU 38H		; Byteweise Ausgabe auf Kassette
  512         003E      LINE	EQU 3EH		; Linie zeichnen
  513         F009      PV3	EQU	0F009H	; CAOS-UP aufrufen, E=UP-Nummer
  514         F015      PV5	EQU	0F015H	; CAOS-UP aufrufen, E=UP-Nummer, IRM ON/OFF
  515         F018      IRMON	EQU	0F018H	; IRM einschalten
  516         F01B      IRMOFF	EQU	0F01BH	; IRM abschalten
  517                   
  518                   ;---------------------------------------------------------------------
  519                   
  520         03FF      	ORG	0401H-2
  521                   ;
  522 03FF  20A9        	DW	U256B-0401H	; Dateigroesse BAC854C.SSS
  523                   ;
  524 0401  040B        	DW	U040B		; Zeiger auf naechste Programmzeile
  525 0403  000A        	DW	10		; Zeilennummer 10
  526 0405  9D AE       	DB	9DH,0AEH	; CALL*
  527                   	ASCTXT	U0410		; Kaltstart / Initialisierung BASICODE
   12 0407  34          		DB	(U0410/100H AND 0FH) + 30H
   18 0408  31          		DB	(U0410/10H AND 0FH) + 30H
   24 0409  30          		DB	(U0410 AND 0FH) + 30H
  528 040A  00          	DB	0		; Zeilenende
  529 040B  0000        U040B:	DW	0		; BASIC-Programmende
  530                   ;
  531                   ; Die Warmstart-Adresse wird im Bascoder nicht aufgerufen. Es ist aber im
  532                   ; BASICODE-Buch beschrieben, dass z.B. nach einem RESET mit Eingabe von
  533                   ; CALL*40D:RUN in das Programm zurueck gelangt werden kann. 
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   8
BAC85   Z80

  534                   ; Auf der Funktionstaste Shift+F4 liegt ebenfalls "REBASIC CALL*40D"
  535                   ;
  536 040D  C3 0B5C     U040D:	JP	WARM		; Warmstart BASICODE
  537                   	;
  538 0410  C3 0B38     U0410:	JP	KALT		; Kaltstart BASICODE
  539                   ;
  540                   ; RST 38H - Systemabsturz melden und zurueck zu CAOS
  541                   ;
  542 0413  21 E000     U0413:	LD	HL,0E000H	; RESET
  543 0416  22 0039     	LD	(U0039),HL	; auf RST 38H eintragen
  544 0419  DB 88       	IN	A,(PIOAD)
  545 041B  E6 9F       	AND	9FH
  546 041D  F6 0D       	OR	0DH
  547 041F  D3 88       	OUT	(PIOAD),A
  548 0421  31 01C4     	LD	SP,01C4H	; CAOS-System-Stack
  549 0424  CD F003     	CALL	PV1
  550 0427  23          	DB	OSTR
  551 0428  0D          	DB	0DH
  552 0429  21 20 53 79 	DB	'! Systemabsturz !'
  553 043A  0D 0A       	DB	CR,LF
  554 043C  00          	DB	0
  555 043D  CD F003     	CALL	PV1
  556 0440  12          	DB	LOOP
  557                   ;
  558                   ; Initialisierung BASICODE (bei Kaltstart, Warmstart))
  559                   ;
  560 0441  21 0010     BCINIT:	LD	HL,U0000	; 20.12.2023: ASCII-Zwischenspeicher loeschen
  561 0444  11 0011     	LD	DE,U0000+1	; damit wird auch ein evtl. vorhandenes
  562 0447  01 0027     	LD	BC,39		; Menuewort von FLOAD geloescht
  563 044A  72          	LD	(HL),D		; 0 eintragen
  564 044B  ED B0       	LDIR
  565 044D  CD F018     	CALL	IRMON
  566                   ; 11.11.2023: keine Kopie der KTAB mehr vornehmen
  567                   ;	LD	L,(IX+14)	; KTAB
  568                   ;	LD	H,(IX+15)	; aktueller Wert
  569                   ;	LD	DE,KTAB2
  570                   ;	LD	(IX+14),E	; KTAB
  571                   ;	LD	(IX+15),D	; Kopie
  572                   ;	LD	BC,128
  573                   ;	LDIR			; KTAB in RAM kopieren
  574                   ;IF KC3
  575                   ;	LD	HL,KTAB2+4DH	; Shift-Stop in KTAB
  576                   ;	LD	(HL),C		; mit 0 belegen (statt 13H)
  577                   ;ENDIF
  578 0450  21 0BA8     	LD	HL,U0C39	; modifizierte Eingaberoutine mit Konverter
  579 0453  22 B7C7     	LD	(UIN2+1),HL
  580 0456  21 09D3     	LD	HL,U0A7B	; Zeiger auf 07H = USIN2
  581 0459  22 B7BB     	LD	(INTAB),HL	; INTAB umstellen auf USIN2
  582 045C  CD 0917     	CALL	U09AE		; IRM-Adresse fuer Zeichen links/unten setzen
  583 045F  21 0000     	LD	HL,0		; Fenster volle Groesse
  584 0462  22 B79C     	LD	(WINON),HL
  585 0465  22 005A     	LD	(U004A),HL	; Zaehlwert Kassetteneingabe
  586 0468  21 2028     	LD	HL,2028H
  587 046B  22 B79E     	LD	(WINLG),HL
  588                   ; 30.12.2023: verschoben zu WARM1, damit das im Direktmode regeneriert wird
  589                   ;	LD	HL,U04C3	; eigene Routine fuer
  590                   ;	LD	(IO_ERR),HL	; IO-ERROR eintragen
  591 046E  3E 31       	LD	A,DEFCOL	; Standardfarbe
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   9
BAC85   Z80

  592 0470  32 B7A3     	LD	(COLOR),A	; Farbe einstellen
  593                   ; 17.11.2023: Grafikfarbe einstellen hier nicht noetig, da diese beim Zeichnen
  594                   ; des Titelbildes (Schallplatte) neu eingetragen wird
  595                   ;	AND	78H		; Vordergrundfarbe (ohne Blinken) herausfiltern
  596                   ;	LD	(FARB),A	; auch fuer Grafikbefehle eintragen
  597 0473  3E 7F       	LD	A,7FH		; Blinken aus, volle Lautstaerke, RAM8 ein
  598 0475  D3 89       	OUT	(PIOBD),A
  599 0477  21 09ED     	LD	HL,U0A95	; F-Tastenbelegungen
  600 047A  11 B900     	LD	DE,FNDEF	; Funktionstastenspeicher
  601 047D  01 0042     	LD	BC,U0AD7-U0A95
  602 0480  ED B0       	LDIR			; initialisieren
  603 0482  11 2130     	LD	DE,U21F3+2	; Treiber im RAM
  604 0485  21 BA02     	LD	HL,UBA00+2	; Treiber im IRM
  605 0488  CD 049E     	CALL	U04B4		; Treiber bereits im IRM?
  606 048B  28 0E       	JR	Z,BCINI1	; ja, fertig
  607 048D  EB          	EX	DE,HL
  608 048E  CD 049E     	CALL	U04B4		; Treiber noch im RAM verfuegbar?
  609 0491  20 08       	JR	NZ,BCINI1	; nein, nichts mehr da zum Kopieren
  610 0493  01 037C     	LD	BC,U256B-U21F3	; Laenge des V.24-Treibers
  611 0496  ED B0       	LDIR			; V.24-Treiber kopieren
  612 0498  CD BBF5     	CALL	UBBF5		; V.24-Modul initialisieren
  613 049B  C3 0772     BCINI1:	JP	IOFRET		; IRM OFF, RET
  614                   ;
  615                   ; Drucker(?)treiber pruefen:
  616                   ;
  617 049E  D5          U04B4:	PUSH	DE
  618 049F  56          	LD	D,(HL)
  619 04A0  2B          	DEC	HL
  620 04A1  5E          	LD	E,(HL)
  621 04A2  2B          	DEC	HL
  622 04A3  E5          	PUSH	HL		; steht ein CALL auf
  623 04A4  21 BAFE     	LD	HL,UBAFE	; UBAFE im Speicher?
  624 04A7  B7          	OR	A
  625 04A8  ED 52       	SBC	HL,DE
  626 04AA  E1          	POP	HL
  627 04AB  D1          	POP	DE
  628 04AC  C9          	RET
  629                   ;
  630                   ; eigene Routine fuer IO-ERROR (benutzt im Direktmode)
  631                   ;
  632 04AD  DB 88       U04C3:	IN	A,(PIOAD)
  633 04AF  CB 57       	BIT	2,A		; IRM ein?
  634 04B1  C4 F01B     	CALL	NZ,IRMOFF	; bei CAOS 3.1 erst noch den IRM ausschalten!
  635 04B4  C3 DC82     	JP	IOERR		; Sprung in BASIC-ROM
  636                   ;
  637                   ; Fehlerbehandlung im RUN-Mode, setzt nur CY-Flag bei Fehler
  638                   ;
  639 04B7  DB 88       U04C4:	IN	A,(PIOAD)
  640 04B9  CB 57       	BIT	2,A		; IRM ein?
  641 04BB  C4 F01B     	CALL	NZ,IRMOFF	; bei CAOS 3.1 erst noch den IRM ausschalten!
  642 04BE  37          	SCF			; Fehlerflag setzen
  643 04BF  E1          	POP	HL		; ERROR-Adresse vom Stack nehmen
  644 04C0  C9          	RET			; zurueck zu MBIN bzw. MBOUT
  645                   ;
  646                   ; Titelbild zeichnen
  647                   ;
  648 04C1  CD 05DC     TITEL:	CALL	CLS		; Bildschirm loeschen
  649 04C4  CD F018     	CALL	IRMON
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  10
BAC85   Z80

  650 04C7  3E 20       	LD	A,20H		; Vordergrundfarbe gruen
  651 04C9  32 B7D6     	LD	(FARB),A	; Grafikfarbe fuer Linie (Schallplatte)
  652 04CC  CD F01B     	CALL	IRMOFF
  653 04CF  AF          	XOR	A
  654 04D0  32 003D     	LD	(XPOS2+1),A
  655 04D3  32 0041     	LD	(XPOS1+1),A
  656 04D6  32 003F     	LD	(YPOS2+1),A
  657 04D9  32 0043     	LD	(YPOS1+1),A
  658 04DC  32 0044     	LD	(CN),A		; CN=0: Linie zeichnen (nicht loeschen)
  659                   ; Schallplatte zeichnen
  660 04DF  21 0A2F     	LD	HL,U0AD7	; Daten fuer Titelbild
  661 04E2  06 2B       	LD	B,43		; 43 Linien
  662 04E4  C5          TTL1:	PUSH	BC
  663 04E5  E5          	PUSH	HL
  664 04E6  3E 28       	LD	A,28H
  665 04E8  96          	SUB	(HL)
  666 04E9  32 003C     	LD	(XPOS2),A	; X-Ende
  667 04EC  23          	INC	HL
  668 04ED  3E 20       	LD	A,20H
  669 04EF  96          	SUB	(HL)
  670 04F0  32 003E     	LD	(YPOS2),A	; Y-Ende
  671 04F3  23          	INC	HL
  672 04F4  3E 28       	LD	A,28H
  673 04F6  96          	SUB	(HL)
  674 04F7  32 0040     	LD	(XPOS1),A	; X-Anfang
  675 04FA  23          	INC	HL
  676 04FB  3E 28       	LD	A,28H
  677 04FD  96          	SUB	(HL)
  678 04FE  32 0042     	LD	(YPOS1),A	; Y-Anfang
  679 0501  CD 077C     	CALL	LINIE		; Linie zeichnen (1. Quadrant)
  680 0504  E1          	POP	HL
  681 0505  E5          	PUSH	HL
  682 0506  3E 27       	LD	A,27H
  683 0508  86          	ADD	(HL)
  684 0509  32 003C     	LD	(XPOS2),A	; X-Ende
  685 050C  23          	INC	HL
  686 050D  3E 20       	LD	A,20H
  687 050F  96          	SUB	(HL)
  688 0510  32 003E     	LD	(YPOS2),A	; Y-Ende
  689 0513  23          	INC	HL
  690 0514  3E 27       	LD	A,27H
  691 0516  86          	ADD	(HL)
  692 0517  32 0040     	LD	(XPOS1),A	; X-Anfang
  693 051A  23          	INC	HL
  694 051B  3E 28       	LD	A,28H
  695 051D  96          	SUB	(HL)
  696 051E  32 0042     	LD	(YPOS1),A	; Y-Anfang
  697 0521  CD 077C     	CALL	LINIE		; Linie zeichnen (2. Quadrant)
  698 0524  E1          	POP	HL
  699 0525  E5          	PUSH	HL
  700 0526  3E 28       	LD	A,28H
  701 0528  96          	SUB	(HL)
  702 0529  32 003C     	LD	(XPOS2),A	; X-Ende
  703 052C  23          	INC	HL
  704 052D  3E 1F       	LD	A,1FH
  705 052F  86          	ADD	(HL)
  706 0530  32 003E     	LD	(YPOS2),A	; Y-Ende
  707 0533  23          	INC	HL
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  11
BAC85   Z80

  708 0534  3E 28       	LD	A,28H
  709 0536  96          	SUB	(HL)
  710 0537  32 0040     	LD	(XPOS1),A	; X-Anfang
  711 053A  23          	INC	HL
  712 053B  3E 27       	LD	A,27H
  713 053D  86          	ADD	(HL)
  714 053E  32 0042     	LD	(YPOS1),A	; Y-Anfang
  715 0541  CD 077C     	CALL	LINIE		; Linie zeichnen (3. Quadrant)
  716 0544  E1          	POP	HL
  717 0545  3E 27       	LD	A,27H
  718 0547  86          	ADD	(HL)
  719 0548  32 003C     	LD	(XPOS2),A	; X-Ende
  720 054B  23          	INC	HL
  721 054C  3E 1F       	LD	A,1FH
  722 054E  86          	ADD	(HL)
  723 054F  32 003E     	LD	(YPOS2),A	; Y-Ende
  724 0552  23          	INC	HL
  725 0553  3E 27       	LD	A,27H
  726 0555  86          	ADD	(HL)
  727 0556  32 0040     	LD	(XPOS1),A	; X-Anfang
  728 0559  23          	INC	HL
  729 055A  3E 27       	LD	A,27H
  730 055C  86          	ADD	(HL)
  731 055D  32 0042     	LD	(YPOS1),A	; Y-Anfang
  732 0560  23          	INC	HL
  733 0561  E5          	PUSH	HL
  734 0562  CD 077C     	CALL	LINIE		; Linie zeichnen (4. Quadrant)
  735 0565  E1          	POP	HL
  736 0566  C1          	POP	BC
  737 0567  05          	DEC	B		; noch eine Linie zu zeichnen?
  738 0568  C2 04E4     	JP	NZ,TTL1		; ja, dann weiter
  739                   ;Linie zwischen Schallplatte und TAPE-Signal
  740 056B  3E 3E       	LD	A,3EH
  741 056D  32 003E     	LD	(YPOS2),A
  742 0570  C6 08       	ADD	8
  743 0572  32 0042     	LD	(YPOS1),A
  744 0575  3E 49       	LD	A,49H
  745 0577  32 003C     	LD	(XPOS2),A
  746 057A  3E 29       	LD	A,29H
  747 057C  32 0040     	LD	(XPOS1),A
  748 057F  E5          	PUSH	HL
  749 0580  CD 077C     	CALL	LINIE		; Linie von Schallplatte nach rechts
  750 0583  E1          	POP	HL
  751                   ;TAPE-Signal zeichnen
  752 0584  0E 05       	LD	C,5		; 5x das gleiche Muster
  753 0586  E5          TTL2:	PUSH	HL
  754 0587  06 0C       	LD	B,12		; 12 Linien
  755 0589  C5          TTL3:	PUSH	BC
  756 058A  E5          	PUSH	HL
  757 058B  5E          	LD	E,(HL)
  758 058C  16 00       	LD	D,0
  759 058E  CB 7B       	BIT	7,E
  760 0590  28 01       	JR	Z,TTL4
  761 0592  15          	DEC	D
  762 0593  23          TTL4:	INC	HL
  763 0594  4E          	LD	C,(HL)
  764 0595  2A 003C     	LD	HL,(XPOS2)
  765 0598  19          	ADD	HL,DE
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  12
BAC85   Z80

  766 0599  22 003C     	LD	(XPOS2),HL
  767 059C  3A 003E     	LD	A,(YPOS2)
  768 059F  91          	SUB	C
  769 05A0  32 003E     	LD	(YPOS2),A
  770 05A3  CD 077C     	CALL	LINIE		; Linie zeichnen
  771 05A6  E1          	POP	HL
  772 05A7  C1          	POP	BC
  773 05A8  23          	INC	HL
  774 05A9  23          	INC	HL
  775 05AA  10 DD       	DJNZ	TTL3
  776 05AC  EB          	EX	DE,HL
  777 05AD  E1          	POP	HL
  778 05AE  0D          	DEC	C
  779 05AF  20 D5       	JR	NZ,TTL2
  780                   ;Programmtitel anzeigen
  781 05B1  EB          	EX	DE,HL
  782 05B2  06 03       	LD	B,3		; 3 Zeilen
  783 05B4  5E          TTL5:	LD	E,(HL)
  784 05B5  23          	INC	HL
  785 05B6  56          	LD	D,(HL)		; Cursor-Position
  786 05B7  23          	INC	HL
  787 05B8  EB          	EX	DE,HL
  788 05B9  CD 1126     	CALL	U05E1		; Cursor auf HL setzen
  789 05BC  EB          	EX	DE,HL
  790 05BD  CD C5F1     	CALL	TEXTOE		; Textausgabe (im BASIC-ROM)
  791 05C0  23          	INC	HL
  792 05C1  10 F1       	DJNZ	TTL5
  793 05C3  C9          	RET
  794                   ;
  795                   ; Fenster auf volle Groesse einstellen
  796                   ;
  797 05C4  CD F018     U05C5:	CALL	IRMON
  798 05C7  21 0000     	LD	HL,0		; Fenster volle Groesse
  799 05CA  22 B79C     	LD	(WINON),HL
  800 05CD  22 B7A0     	LD	(CURSO),HL
  801 05D0  21 2028     	LD	HL,2028H
  802 05D3  22 B79E     	LD	(WINLG),HL
  803 05D6  C3 0772     	JP	IOFRET		; IRM OFF, RET
  804                   ;
  805                   ; GOSUB 100	Initialisieren des Textmodus, Loeschen des Bildschirms
  806                   ;
  807 05D9  CD 1EB6     GO100:	CALL	U1ECA		; Farbe nach Variable CC einstellen
  808                   ;
  809                   ; Bildschirm loeschen
  810                   ;
  811         0000      IF KC3	; KC85/3-spezifisches schnelles Bildschirmloeschen
  829                   ELSE	;Beim KC85/4 ist das normale Bildschirm loeschen schnell genug
  830 05DC  3E 0C       CLS:	LD	A,0CH		; CLS
  831 05DE  1E 24       	LD	E,OCHR
  832 05E0  C3 F015     	JP	PV5		; CAOS-UP aufrufen, wenn IRM aus ist
  833                   ENDIF
  834                   ;
  835                   ; GOSUB 150	Auffaelliges Anzeigen eines Strings auf dem Bildschirm
  836                   ;		(links und rechts drei Leerzeichen)
  837                   ;		Uebergabe des Strings in der Variablen SR$
  838                   ;
  839 05E3  CD F018     GO150:	CALL	IRMON
  840 05E6  3A B7A3     	LD	A,(COLOR)	; aktuelle Farbe
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  13
BAC85   Z80

  841 05E9  32 B796     	LD	(NUMNX),A	; hier zwischenspeichern
  842 05EC  CD F01B     	CALL	IRMOFF
  843 05EF  CD 1EB6     	CALL	U1ECA		; Farbe nach Variable CC einstellen
  844 05F2  CD 15FD     	CALL	U1691		; Zeichenkette SR$ holen
  845         0000      IF KC3
  911                   ELSE
  912                   ;
  913                   ; Zeichenkette hervorgehoben anzeigen:
  914                   ; (2 Leerzeichen davor und dahinter, Zeichenkette selbst + je ein Leerzeichen
  915                   ; davor und dahinter invers)
  916                   ; PE:	DE	Zeichenkette
  917                   ;	B	Anzahl Zeichen
  918                   ;
  919 05F5  21 09E7     	LD	HL,U0A8F	; 2 Leerzeichen, invers ein, 1 Leerzeichen
  920 05F8  CD 0614     	CALL	U0608		; 5 Zeichen anzeigen
  921 05FB  CD 060F     	CALL	U0603		; Zeichenkette selbst und invers aus
  922 05FE  CD F018     	CALL	IRMON
  923 0601  3A B796     	LD	A,(NUMNX)	; gespeicherte Farbinformation
  924 0604  32 B7A3     	LD	(COLOR),A	; wieder regenerieren
  925 0607  C3 0772     	JP	IOFRET
  926                   	;
  927 060A  1A          U05FE:	LD	A,(DE)		; Zeichen aus Zeichenkette
  928 060B  13          	INC	DE
  929 060C  CD DDD5     	CALL	CO		; anzeigen
  930 060F  10 F9       U0603:	DJNZ	U05FE
  931 0611  21 09E8     	LD	HL,U0A90	; 1 Leerzeichen, invers aus, 2 Leerzeichen
  932 0614  0E 05       U0608:	LD	C,5
  933 0616  7E          U060A:	LD	A,(HL)
  934 0617  23          	INC	HL
  935 0618  CD DDD5     	CALL	CO
  936 061B  0D          	DEC	C
  937 061C  20 F8       	JR	NZ,U060A
  938 061E  C9          	RET
  939                   ENDIF
  940                   ;
  941                   ; Taste gedrueckt?
  942                   ;
  943 061F  AF          U0613:	XOR	A
  944 0620  DD CB 08 46 	BIT	0,(IX+8)	; Taste gedrueckt?
  945 0624  C8          	RET	Z		; nein
  946 0625  DD CB 08 86 	RES	0,(IX+8)	; quittieren
  947 0629  DD 7E 0D    	LD	A,(IX+13)	; Tastencode abholen
  948 062C  B7          	OR	A
  949 062D  C9          	RET
  950                   ;
  951                   ; Taste quittieren
  952                   ; PA:	Z=0	Taste gedrueckt
  953                   ;
  954 062E  DD CB 08 46 U0622:	BIT	0,(IX+8)	; Taste gedrueckt?
  955 0632  C8          	RET	Z		; nein
  956 0633  DD CB 08 86 	RES	0,(IX+8)	; quittieren
  957 0637  C9          	RET
  958                   ;
  959                   ; Tastaturabfrage, Eingabe ein Zeichen
  960                   ; (Aufruf mit IRM ON oder OFF moeglich)
  961                   ;	
  962 0638  DB 88       U062C:	IN	A,(PIOAD)
  963 063A  CB 57       	BIT	2,A		; IRM ein?
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  14
BAC85   Z80

  964 063C  20 09       	JR	NZ,U063B
  965 063E  C5          	PUSH	BC
  966 063F  CD F018     	CALL	IRMON		; einschalten
  967 0642  E5          	PUSH	HL
  968 0643  21 1136     	LD	HL,U05F1	; und nach RET wieder ausschalten
  969 0646  E3          	EX	(SP),HL
  970 0647  E5          U063B:	PUSH	HL
  971 0648  CD F003     	CALL	PV1
  972 064B  04          	DB	KBD		; Eingabe ein Zeichen
  973 064C  E1          	POP	HL
  974 064D  C9          	RET
  975                   ;
  976                   ; GOSUB 280	Aus- bzw. Einschalten der STOP/BREAK-Taste
  977                   ;		Uebergabe des gewuenschten Status in der Variablen FR (FR=0 bzw. FR=1)
  978                   ;
  979                   ; 11.11.2023 Funktion entfernt
  980                   ; 02.01.2024: wieder aktiviert im KTAB2 im Programmcode
  981                   ;
  982 064E  01 4652     GO280:	LD	BC,'FR'
  983 0651  CD CF48     	CALL	DIM7		; Adresse der Variable FR nach DE holen
  984 0654  13          	INC	DE
  985 0655  13          	INC	DE
  986 0656  13          	INC	DE
  987 0657  1A          	LD	A,(DE)		; Wert holen	A=81H bei FR=1
  988 0658  B7          	OR	A		;		A=0   bei FR=0
  989                   ;
  990                   ; BRK/STOP deaktivieren bzw. aktivieren durch Modifikation der KTAB
  991                   ; PE:	Z=1	Tasten aktivieren
  992                   ;	Z=0	Tasten deaktivieren
  993                   ;
  994 0659  21 1ABC     U0642:	LD	HL,KTAB2	; modifizierte KTAB in BASICODE
  995 065C  20 03       	JR	NZ,U064E	; Tasten deaktivieren
  996 065E  2A 005E     U0643:	LD	HL,(U004E)	; Original-KTAB von CAOS
  997 0661  DD 75 0E    U064E:	LD	(IX+14),L
  998 0664  DD 74 0F    	LD	(IX+15),H
  999 0667  C9          	RET
 1000                   ;
 1001                   ; Zeichen aus VRAM lesen (fuer GOSUB 220)
 1002                   ; PE:	H=Zeile, L=Spalte
 1003                   ; PA:	A=Zeichencode
 1004                   ;
 1005 0668  CD F018     U0654:	CALL	IRMON
 1006 066B  E5          	PUSH	HL
 1007 066C  D5          	PUSH	DE
 1008 066D  AF          	XOR	A
 1009 066E  E5          	PUSH	HL
 1010 066F  6C          	LD	L,H		; L=Zeile
 1011 0670  67          	LD	H,A		; HL=Zeile
 1012 0671  5D          	LD	E,L
 1013 0672  57          	LD	D,A		; DE=Zeile
 1014 0673  29          	ADD	HL,HL	; *2
 1015 0674  29          	ADD	HL,HL	; *4
 1016 0675  19          	ADD	HL,DE	; *5
 1017 0676  29          	ADD	HL,HL	; *10
 1018 0677  29          	ADD	HL,HL	; *20
 1019 0678  29          	ADD	HL,HL	; *40
 1020 0679  D1          	POP	DE		; E=Spalte
 1021 067A  57          	LD	D,A		; DE=Spalte
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  15
BAC85   Z80

 1022 067B  19          	ADD	HL,DE		; 40*Zeile + Spalte
 1023         0000      IF KC3
 1025                   ELSE
 1026 067C  ED 5B B7CB  	LD	DE,(VRAM)	; VRAM aktuelles Bild (KC85/4)
 1027                   ENDIF
 1028 0680  19          	ADD	HL,DE		; VRAM-Adresse berechnen
 1029 0681  7E          	LD	A,(HL)		; Inhalt von VRAM lesen
 1030 0682  B7          	OR	A		; leer?
 1031 0683  20 02       	JR	NZ,U0672
 1032 0685  3E 20       	LD	A,' '		; 20H statt 00H uebergeben
 1033 0687  D1          U0672:	POP	DE
 1034 0688  E1          	POP	HL
 1035 0689  C3 0772     	JP	IOFRET		; IRM OFF, RET
 1036                   ;
 1037                   ; Tonausgabe fuer GOSUB 400
 1038                   ;
 1039 068C  5F          U0677:	LD	E,A		; Tonhoehe 0..127
 1040 068D  79          	LD	A,C		; Lautstaerke 0..15
 1041 068E  E6 0F       	AND	0FH		; Wertebereich 0..15
 1042 0690  20 04       	JR	NZ,U0681	; Lautstaerke nicht 0
 1043 0692  3E 03       	LD	A,3		; CTC ruecksetzen
 1044 0694  18 1C       	JR	U069D
 1045                   	;
 1046 0696  7B          U0681:	LD	A,E		; Tonhoehe
 1047 0697  FE 2D       	CP	45
 1048 0699  38 06       	JR	C,U068C		; kleiner als 45
 1049 069B  D6 2D       	SUB	45
 1050 069D  06 07       	LD	B,7		; Vorteiler 16
 1051 069F  18 04       	JR	U0690
 1052                   	;
 1053 06A1  06 27       U068C:	LD	B,27H		; Vorteiler 256
 1054 06A3  C6 03       	ADD	3
 1055 06A5  16 00       U0690:	LD	D,0
 1056 06A7  5F          	LD	E,A		; DE=Tonhoehe
 1057 06A8  21 0994     	LD	HL,U0A3C	; Tabelle der Tonwerte
 1058 06AB  19          	ADD	HL,DE
 1059 06AC  7E          	LD	A,(HL)		; Zeitkonstante lesen
 1060 06AD  5F          	LD	E,A
 1061 06AE  78          	LD	A,B		; Steuerwort mit VT=16 oder VT=256
 1062 06AF  D3 8D       	OUT	(CTC1),A
 1063 06B1  7B          	LD	A,E		; Zeitkonstante (Tonhoehe)
 1064 06B2  D3 8D       U069D:	OUT	(CTC1),A
 1065 06B4  3E A7       	LD	A,0A7H		; EI, Zeitgeber, VT=256, ZK folgt
 1066 06B6  D3 8E       	OUT	(CTC2),A	; Steuerwort fuer Tondauer
 1067 06B8  3E A5       	LD	A,165
 1068 06BA  D3 8E       	OUT	(CTC2),A	; Zeitkonstante
 1069 06BC  1E 0F       	LD	E,0FH
 1070 06BE  79          	LD	A,C		; Lautstaerke
 1071 06BF  AB          	XOR	E		; negieren
 1072 06C0  A3          	AND	E		; maskieren 0..15
 1073 06C1  4F          	LD	C,A
 1074 06C2  3C          	INC	A
 1075 06C3  21 0BB8     	LD	HL,0BB8H
 1076 06C6  5D          U06B1:	LD	E,L
 1077 06C7  54          	LD	D,H
 1078 06C8  06 05       	LD	B,5		; 5x verschieben
 1079 06CA  CB 3A       U06B5:	SRL	D
 1080 06CC  CB 1B       	RR	E
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  16
BAC85   Z80

 1081 06CE  10 FA       	DJNZ	U06B5
 1082 06D0  19          	ADD	HL,DE
 1083 06D1  3D          	DEC	A
 1084 06D2  20 F2       	JR	NZ,U06B1
 1085 06D4  EB          	EX	DE,HL
 1086 06D5  D5          	PUSH	DE
 1087 06D6  E1          U06C1:	POP	HL
 1088 06D7  79          	LD	A,C
 1089 06D8  87          	ADD	A
 1090 06D9  06 61       	LD	B,61H		; Blinken aus, RAM8 ein
 1091 06DB  B0          	OR	B		; mit Lautstaerke kombinieren
 1092 06DC  D3 89       	OUT	(PIOBD),A	; Lautstaerke einstellen
 1093 06DE  5D          	LD	E,L
 1094 06DF  54          	LD	D,H
 1095 06E0  06 05       	LD	B,5
 1096 06E2  CB 3A       U06CD:	SRL	D
 1097 06E4  CB 1B       	RR	E
 1098 06E6  10 FA       	DJNZ	U06CD
 1099 06E8  19          	ADD	HL,DE
 1100 06E9  EB          	EX	DE,HL
 1101 06EA  D5          	PUSH	DE
 1102 06EB  79          	LD	A,C
 1103 06EC  EE 0F       	XOR	0FH
 1104 06EE  28 01       	JR	Z,U06DC
 1105 06F0  0C          	INC	C
 1106 06F1  2A 005A     U06DC:	LD	HL,(U004A)
 1107 06F4  2B          	DEC	HL
 1108 06F5  CB 7C       	BIT	7,H
 1109 06F7  20 07       	JR	NZ,U06EB
 1110 06F9  1B          	DEC	DE
 1111 06FA  7A          	LD	A,D
 1112 06FB  B3          	OR	E
 1113 06FC  28 D8       	JR	Z,U06C1
 1114 06FE  18 F1       	JR	U06DC
 1115                   	;
 1116 0700  E1          U06EB:	POP	HL
 1117 0701  3E 7F       	LD	A,7FH
 1118 0703  D3 89       	OUT	(PIOBD),A
 1119 0705  C9          	RET
 1120                   ;
 1121                   ; GOSUB 250	Ausgabe eines einfachen kurzen Tons ("Beep")
 1122                   ;
 1123 0706  0E 00       GO250:	LD	C,0
 1124 0708  3E 61       	LD	A,61H		; Blinken aus, RAM8 ein, volle Lautstaerke
 1125 070A  D3 89       	OUT	(PIOBD),A
 1126 070C  3E 05       U06F7:	LD	A,5		; Zeitkonstante folgt
 1127 070E  D3 8C       	OUT	(CTC0),A	; Steuerwort
 1128 0710  79          	LD	A,C		; Zeitkonstante (Tonhoehe 1)
 1129 0711  D3 8C       	OUT	(CTC0),A
 1130 0713  06 18       	LD	B,24
 1131 0715  10 FE       U0700:	DJNZ	U0700		; kurz warten
 1132 0717  0D          	DEC	C
 1133 0718  20 F2       	JR	NZ,U06F7
 1134 071A  0C          	INC	C
 1135 071B  3E 05       U0706:	LD	A,5
 1136 071D  D3 8C       	OUT	(CTC0),A
 1137 071F  79          	LD	A,C
 1138 0720  D3 8C       	OUT	(CTC0),A
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  17
BAC85   Z80

 1139 0722  06 30       	LD	B,48
 1140 0724  10 FE       U070F:	DJNZ	U070F		; kurz warten
 1141 0726  0C          	INC	C
 1142 0727  20 F2       	JR	NZ,U0706
 1143 0729  3E 7F       	LD	A,7FH		; Blinken aus, RAM8 ein, Lautstaerke=0
 1144 072B  D3 89       	OUT	(PIOBD),A
 1145 072D  3E 03       	LD	A,3
 1146 072F  D3 8C       	OUT	(CTC0),A	; CTC 1 (Tonhoehe) stoppen
 1147 0731  C9          	RET
 1148                   ;
 1149                   ; Zeichen zu Drucker ausgeben
 1150                   ;
 1151 0732  D5          PRINT:	PUSH	DE
 1152 0733  1E 02       	LD	E,UOT1
 1153 0735  CD F015     	CALL	PV5		; CAOS-UP aufrufen, wenn IRM aus ist
 1154 0738  D1          	POP	DE
 1155 0739  C9          	RET
 1156                   ;
 1157                   ; GOSUB 620	Setzen eines Punktes
 1158                   ;		Uebergabe der Position in den Variablen HO und VE
 1159                   ;		Uebergabe der Farbe in der Variablen CN
 1160                   ;
 1161 073A  CD 1EB6     GO620:	CALL	U1ECA		; Farbe nach Variable CC einstellen
 1162 073D  CD 157D     	CALL	U1607		; Werte der Variablen HO, VE und CN holen
 1163 0740  CD F018     	CALL	IRMON
 1164 0743  2A 003C     	LD	HL,(XPOS2)	; X-Position
 1165 0746  22 0040     	LD	(XPOS1),HL
 1166 0749  22 B7D3     	LD	(HOR),HL
 1167 074C  2A 003E     	LD	HL,(YPOS2)	; Y-Position
 1168 074F  11 0008     	LD	DE,8
 1169 0752  19          	ADD	HL,DE
 1170 0753  22 0042     	LD	(YPOS1),HL
 1171 0756  24          	INC	H
 1172 0757  25          	DEC	H
 1173 0758  20 18       	JR	NZ,IOFRET	; IRM OFF, RET
 1174 075A  7D          	LD	A,L
 1175 075B  2F          	CPL
 1176 075C  32 B7D5     	LD	(VERT),A
 1177 075F  1E 30       	LD	E,PUSE		; 30H = PUSE (Punkt setzen/loeschen)
 1178                   ; 19.11.2023:
 1179                   ; Grafikfarbe wird ausschliesslich ueber CAOS-Arbeitszelle FARB ermittelt,
 1180                   ; keine Modifikation des Programmcodes mehr erforderlich
 1181 0761  3A B7D6     GRAF1:	LD	A,(FARB)	; aktuelle Grafikfarbe
 1182 0764  E6 78       	AND	078H		; nur die Farb-Bits (ohne Blinken)
 1183 0766  57          	LD	D,A
 1184 0767  3A 0044     	LD	A,(CN)		; 0=zeichnen oder 1=loeschen aus CN
 1185 076A  87          	ADD	A		; 0=zeichnen oder 2=loeschen
 1186         0000      IF KC3
 1190                   ENDIF
 1191 076B  B2          	OR	D		; in Grafikfarbe einbauen
 1192 076C  32 B7D6     	LD	(FARB),A	; Grafikfarbe
 1193 076F  CD F009     	CALL	PV3		; PUSE oder LINE (UP-Nummer in Register E)
 1194 0772  CD F01B     IOFRET:	CALL	IRMOFF
 1195 0775  C9          	RET
 1196                   ;
 1197                   ; GOSUB 630	Zeichnen einer Linie ausgehend von der aktuellen Grafikposition
 1198                   ;		Uebergabe des Endpunktes in den Variablen HO und VE
 1199                   ;		Uebergabe der Farbe in der Variablen CN (CN=1 Loeschen, CN=0 zeichnen)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  18
BAC85   Z80

 1200                   ;		Festlegen der Grafikposition gegebenenfalls vorher durch das
 1201                   ;		Setzen eines Punktes
 1202                   ;
 1203 0776  CD 1EB6     GO630:	CALL	U1ECA		; Farbe nach Variable CC einstellen
 1204 0779  CD 157D     	CALL	U1607		; Werte der Variablen HO, VE und CN holen
 1205                   ;
 1206                   ; Linie zeichnen, hier Einsprung fuer Titelbild
 1207                   ;
 1208 077C  CD F018     LINIE:	CALL	IRMON
 1209 077F  2A 0040     	LD	HL,(XPOS1)	; X-Anfang (0=links)
 1210 0782  22 B782     	LD	(ARG1),HL	; => X-Koordinate Anfangspunkt
 1211 0785  21 00FF     	LD	HL,0FFH
 1212 0788  ED 5B 0042  	LD	DE,(YPOS1)	; Y-Anfang (0=oben!)
 1213 078C  B7          	OR	A
 1214 078D  ED 52       	SBC	HL,DE		; umrechnen fuer KC-Bildschirm (0=unten!)
 1215 078F  22 B784     	LD	(ARG2),HL	; Y-Koordinate Anfangspunkt
 1216 0792  2A 003C     	LD	HL,(XPOS2)	; X-Ende
 1217 0795  22 0040     	LD	(XPOS1),HL	; als neue X-Position eintragen
 1218 0798  22 B786     	LD	(ARG3),HL	; X-Koordinate Endpunkt
 1219 079B  2A 003E     	LD	HL,(YPOS2)	; Y-Ende (0=oben!)
 1220 079E  11 0008     	LD	DE,8		; +8
 1221 07A1  19          	ADD	HL,DE
 1222 07A2  22 0042     	LD	(YPOS1),HL	; als neue Y-Position eintragen
 1223 07A5  11 00FF     	LD	DE,0FFH
 1224 07A8  EB          	EX	DE,HL
 1225 07A9  ED 52       	SBC	HL,DE		; umrechnen fuer KC-Bildschirm (0=unten!)
 1226 07AB  22 B788     	LD	(ARG4),HL	; Y-Koordinate Endpunkt
 1227         0000      IF KC3
 1444                   ELSE
 1445 07AE  1E 3E       	LD	E,LINE		; UP-Nummer fuer Linie zeichnen/loeschen
 1446 07B0  18 AF       	JR	GRAF1		; weiter wie im UP Punkt setzen/loeschen
 1447                   ENDIF
 1448                   ;
 1449                   ; GOSUB 650	Ausgabe einer Zeichenkette im Grafikmodus
 1450                   ;		Uebergabe der Position in den Variablen HO und VE
 1451                   ;		Uebergabe des Strings in der Variablen SR$
 1452                   ;
 1453 07B2  CD 1EB6     GO650:	CALL	U1ECA		; Farbe nach Variable CC einstellen
 1454 07B5  CD 157D     	CALL	U1607		; Werte der Variablen HO, VE und CN holen
 1455 07B8  CD 15FD     	CALL	U1691		; Zeichenkette SR$ holen
 1456 07BB  05          	DEC	B		; Laenge der Zeichenkette
 1457 07BC  C8          	RET	Z		; Laenge = 0
 1458 07BD  3A 003F     	LD	A,(YPOS2+1)	; High(YPOS2)
 1459 07C0  B7          	OR	A
 1460 07C1  C0          	RET	NZ		; ausserhalb
 1461 07C2  78          	LD	A,B		; B = Laenge der Zeichenkette
 1462 07C3  CD F018     	CALL	IRMON		; Routine veraendert BC-Register!
 1463 07C6  47          	LD	B,A
 1464 07C7  2A 003C     	LD	HL,(XPOS2)	; X-Position im Grafikmodus
 1465 07CA  3E 07       	LD	A,7
 1466 07CC  A5          	AND	L
 1467 07CD  3C          	INC	A
 1468 07CE  4F          	LD	C,A		; C=Pixelverschiebung (1-8)
 1469 07CF  CB 3C       	SRL	H
 1470 07D1  CB 1D       	RR	L		; /8
 1471 07D3  CB 3D       	SRL	L
 1472 07D5  CB 3D       	SRL	L		; L=Horizontalposition (0-27H)
 1473 07D7  3A 003E     	LD	A,(YPOS2)	; Y-Position im Grafikmodus
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  19
BAC85   Z80

 1474 07DA  C6 08       	ADD	8		; Zeichenhoehe addieren
 1475 07DC  67          	LD	H,A		; H=Vertikalposition (0-0FFH)
 1476         0000      IF KC3
 1478                   ELSE
 1479 07DD  CD F003     	CALL	PV1
 1480 07E0  34          	DB	PADR		; HL=IRM-Adresse
 1481                   ENDIF
 1482 07E1  C5          U07C9:	PUSH	BC		; B=Laenge Zeichenkette, C=Pixelverschiebung
 1483 07E2  D5          	PUSH	DE		; Zeiger auf Zeichenkette
 1484 07E3  E5          	PUSH	HL		; IRM-Adresse
 1485 07E4  F3          	DI
 1486 07E5  DB 88       	IN	A,(PIOAD)
 1487 07E7  47          	LD	B,A
 1488 07E8  CB 97       	RES	2,A		; IRM aus
 1489 07EA  D3 88       	OUT	(PIOAD),A
 1490 07EC  1A          	LD	A,(DE)		; Zeichencode holen
 1491 07ED  5F          	LD	E,A		; Zeichencode
 1492 07EE  78          	LD	A,B
 1493 07EF  D3 88       	OUT	(PIOAD),A	; IRM wieder ein
 1494 07F1  7B          	LD	A,E		; Zeichencode
 1495 07F2  FB          	EI
 1496 07F3  FE 20       	CP	20H		; Steuerzeichen?
 1497 07F5  38 4C       	JR	C,U0816		; ja, uebergehen
 1498 07F7  41          	LD	B,C		; Pixelverschiebung
 1499 07F8  0E 08       	LD	C,8		; 8 Byte verarbeiten
 1500 07FA  CD 0973     	CALL	U0A1B		; Zeichenbildtabelle nach HL holen
 1501 07FD  5E          U07E5:	LD	E,(HL)		; Pixelmuster(1) aus Zeichentabelle lesen
 1502 07FE  AF          	XOR	A		; Pixelmuster(2) zunaechst 0
 1503 07FF  50          	LD	D,B		; Anzahl fuer Pixelverschiebung
 1504 0800  18 03       	JR	U07ED
 1505                   	;
 1506 0802  CB 3B       U07EA:	SRL	E		; Pixelmuster(1) passend verschieben
 1507 0804  1F          	RRA			; Pixelmuster(2) erzeugen
 1508 0805  10 FB       U07ED:	DJNZ	U07EA
 1509 0807  42          	LD	B,D		; Anzahl fuer Pixelverschiebung
 1510 0808  E3          	EX	(SP),HL		; HL = IRM-Adresse, Zeichenbildtabelle auf Stack
 1511 0809  57          	LD	D,A		; D=Pixelmuster(2)
 1512 080A  3A 0044     	LD	A,(CN)		; 0=zeichnen oder 1=loeschen
 1513 080D  B7          	OR	A		; zeichnen oder loeschen?
 1514 080E  28 13       	JR	Z,U0802		; -> zeichnen
 1515                   
 1516         0000      IF KC3
 1579                   ELSE
 1580                   
 1581                   ;Text loeschen
 1582 0810  7B          	LD	A,E		; E=Pixelmuster(1)
 1583 0811  B7          	OR	A
 1584 0812  28 06       	JR	Z,L01		; leer
 1585 0814  2F          	CPL			; Pixelmuster invertieren
 1586 0815  A6          	AND	(HL)		; loeschen
 1587 0816  77          	LD	(HL),A		; in Pixelebene eintragen
 1588 0817  CD 1EFA     	CALL	U1F1A		; Farbebene schreiben
 1589 081A  24          L01:	INC	H		; naechste BS-Spalte
 1590 081B  7A          	LD	A,D		; Pixelmuster(2)
 1591 081C  B7          	OR	A
 1592 081D  28 1D       	JR	Z,U080F		; leer
 1593 081F  2F          	CPL			; Pixelmuster invertieren
 1594 0820  A6          	AND	(HL)		; loeschen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  20
BAC85   Z80

 1595 0821  18 0F       	JR	U0808		; Pixelebene zurueck schreiben
 1596                   
 1597                   ;Text zeichnen
 1598 0823  7B          U0802:	LD	A,E		; Pixelmuster(1)
 1599 0824  B7          	OR	A
 1600 0825  28 05       	JR	Z,T01		; leer
 1601 0827  B6          	OR	(HL)		; einbauen in vorhandenen Inhalt
 1602 0828  77          	LD	(HL),A		; in Pixelebene eintragen
 1603 0829  CD 1EFA     	CALL	U1F1A		; Farbebene schreiben
 1604 082C  24          T01:	INC	H		; Position rechts daneben
 1605 082D  7A          	LD	A,D		; Pixelmuster(2)
 1606 082E  B7          	OR	A
 1607 082F  28 0B       	JR	Z,U080F		; leer
 1608 0831  B6          	OR	(HL)		; einbauen in vorhandenen Inhalt
 1609 0832  5F          U0808:	LD	E,A
 1610 0833  7C          	LD	A,H
 1611 0834  FE A8       	CP	0A8H		; raus aus IRM?
 1612 0836  30 04       	JR	NC,U080F	; ja
 1613 0838  73          	LD	(HL),E		; in Pixelebene schreiben
 1614 0839  CD 1EFA     	CALL	U1F1A		; Farbebene schreiben
 1615 083C  25          U080F:	DEC	H		; zurueck auf erste Spalte
 1616 083D  2C          	INC	L		; naechste Pixelzeile
 1617 083E  E3          	EX	(SP),HL		; HL=Zeichenbildtabelle
 1618 083F  23          	INC	HL		; naechstes Byte
 1619 0840  0D          	DEC	C
 1620 0841  20 BA       	JR	NZ,U07E5	; bis alle 8 Byte verarbeitet sind
 1621 0843  E1          U0816:	POP	HL		; IRM-Adresse
 1622 0844  D1          	POP	DE		; Zeiger auf Zeichenkette
 1623 0845  C1          	POP	BC		; B=Laenge Zeichenkette, C=Pixelverschiebung
 1624 0846  13          	INC	DE		; naechstes Zeichen aus Zeichenkette
 1625 0847  7D          	LD	A,L
 1626 0848  D6 08       	SUB	8		; 8 Pixelzeilen nach oben
 1627 084A  6F          	LD	L,A
 1628 084B  24          	INC	H		; eine Spalte nach rechts
 1629 084C  7C          	LD	A,H
 1630 084D  FE A8       	CP	0A8H		; raus aus IRM?
 1631 084F  30 02       	JR	NC,U0826	; ja
 1632 0851  10 8E       	DJNZ	U07C9		; bis Zeichenkette abgearbeitet ist
 1633 0853  C3 0772     U0826:	JP	IOFRET		; IRM OFF, RET
 1634                   
 1635                   ENDIF	; KC3
 1636                   
 1637         0000      if DEV
 1697                   endif
 1698                   ;
 1699                   ; Datei im KC-Format zum Lesen oeffnen
 1700                   ; NF=2
 1701                   ; PA:	CY=1	Fehler
 1702                   ;
 1703 0856  21 0060     U0829:	LD	HL,FNAME	; Dateiname
 1704 0859  16 08       	LD	D,8		; Bit3(D)=1 fuer Open
 1705 085B  DD CB 07 EE 	SET	5,(IX+7)	; Blocknummern unterdruecken
 1706 085F  CD 08AF     	CALL	U0895		; ein Datenbyte einlesen (Open)
 1707 0862  32 0057     	LD	(U0047),A	; Datenbyte eintragen
 1708 0865  D0          	RET	NC		; OK
 1709                   ; Lesefehler oder Dateiname falsch bei TAPE
 1710 0866  F5          	PUSH	AF
 1711 0867  11 4037     U082E:	LD	DE,4000H+MBIN	; Bit6(D)=1 fuer Close
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  21
BAC85   Z80

 1712 086A  CD F015     	CALL	PV5		; Bandeingabe stoppen
 1713 086D  F1          U082F:	POP	AF
 1714 086E  37          	SCF			; Fehler-Flag
 1715 086F  C9          	RET
 1716                   ;
 1717                   ; Datei im KC-Format zum Lesen schliessen
 1718                   ; NF=2
 1719                   ; PA:	CY=1	Fehler
 1720                   ;
 1721 0870  16 40       U0864:	LD	D,40H		; Bit6=1 fuer Close
 1722 0872  21          	DB	21H	; LD HL,nn
 1723                   
 1724                   ; Datei im KC-Format lesen
 1725                   ; NF=2
 1726                   ; PA:	A	Datenbyte
 1727                   ;	CY=1	Fehler
 1728                   ;
 1729 0873  16 00       U0869:	LD	D,0		; kein Open, kein Close
 1730 0875  3A 0057     	LD	A,(U0047)	; letztes Datenbyte
 1731 0878  FE 03       	CP	3		; war das die Ende-Kennung?
 1732 087A  28 2B       	JR	Z,U088D		; ja, End-Bit setzen
 1733 087C  F5          	PUSH	AF		; Datenbyte
 1734 087D  4A          	LD	C,D		; Steuerbyte
 1735 087E  CD 08AF     	CALL	U0895		; naechstes Datenbyte einlesen
 1736 0881  30 06       	JR	NC,U086B	; OK
 1737 0883  CB 71       	BIT	6,C		; Close?
 1738 0885  20 E0       	JR	NZ,U082E	; nein, jetzt noch Close
 1739 0887  18 E4       	JR	U082F
 1740                   	;
 1741 0889  FE 0D       U086B:	CP	CR		; nach einem CR muss noch ein LF folgen
 1742 088B  20 0B       	JR	NZ,U087F	; kein CR
 1743 088D  CB 71       	BIT	6,C		; war das letzte MBIN bereits Close?
 1744 088F  CC 08AF     	CALL	Z,U0895		; nein, noch ein Datenbyte einlesen (LF)
 1745 0892  38 D3       	JR	C,U082E		; Fehler -> Close
 1746 0894  3E 0D       	LD	A,CR		; nur das CR verwenden
 1747 0896  18 09       	JR	U0888
 1748                   	;
 1749 0898  FE 03       U087F:	CP	3		; BRK=Dateiende?
 1750 089A  20 05       	JR	NZ,U0888	; nein
 1751 089C  21 0053     	LD	HL,U0043
 1752 089F  CB C6       	SET	0,(HL)		; Datei-Ende setzen
 1753 08A1  32 0057     U0888:	LD	(U0047),A	; gelesenes Datenbyte
 1754 08A4  F1          	POP	AF		; und vorheriges uebergeben
 1755 08A5  B7          	OR	A		; CY=0, kein Fehler
 1756 08A6  C9          	RET
 1757                   	;
 1758 08A7  21 0053     U088D:	LD	HL,U0043
 1759 08AA  CB C6       	SET	0,(HL)		; Datei-Ende setzen
 1760 08AC  3E 0D       	LD	A,CR		; CR zurueckgeben
 1761 08AE  C9          	RET
 1762                   ;
 1763                   ; ein Datenbyte von Kassette lesen
 1764                   ;
 1765 08AF  DD CB 08 86 U0895:	RES	0,(IX+8)	; evtl. anstehenden Tastendruck ruecksetzen
 1766 08B3  AF          	XOR	A
 1767 08B4  32 0054     	LD	(U0044),A	; Abbruch zuruecksetzen
 1768 08B7  1E 37       	LD	E,MBIN
 1769 08B9  CD F015     	CALL	PV5
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  22
BAC85   Z80

 1770 08BC  F5          	PUSH	AF		; Datenbyte und Fehlerflag merken
 1771 08BD  DD CB 08 46 	BIT	0,(IX+8)	; Taste gedrueckt?
 1772 08C1  28 09       	JR	Z,U08F3		; nein
 1773 08C3  3E FF       	LD	A,0FFH
 1774 08C5  32 0054     	LD	(U0044),A	; Abbruch/Fehler setzen
 1775 08C8  DD CB 08 86 	RES	0,(IX+8)	; Tastendruck zuruecksetzen
 1776 08CC              U08F3:	;CALL	U09C8		; komplette unterste Bildschirmzeile malen
 1777 08CC  F1          	POP	AF		; A=Datenbyte, CY=1 bei Fehler
 1778 08CD  C9          	RET
 1779                   ;
 1780                   ; Datei im KC-Format zum Schreiben oeffnen
 1781                   ; NF=3
 1782                   ; PA:	CY=1	Fehler
 1783                   ;
 1784 08CE  3A 003B     U0915:	LD	A,(FLAGS)
 1785 08D1  F6 08       	OR	8		; Init setzen
 1786 08D3  32 003B     	LD	(FLAGS),A
 1787 08D6  B7          	OR	A		; CY=0, kein Fehler
 1788 08D7  C9          	RET
 1789                   ;
 1790                   ; Datei im KC-Format schreiben
 1791                   ; NF=3
 1792                   ; PE:	A	Datenbyte
 1793                   ; PA:	CY=1	Fehler
 1794                   ;
 1795 08D8  FE 0D       U0946:	CP	CR		; CR?
 1796 08DA  20 06       	JR	NZ,U094F	; nein
 1797 08DC  CD 08E2     	CALL	U094F		; CR schreiben
 1798 08DF  D8          	RET	C		; Fehler
 1799 08E0  3E 0A       	LD	A,LF		; und danach ein LF automatisch anhaengen
 1800 08E2  16 00       U094F:	LD	D,0		; kein Open, kein Close
 1801 08E4  21 003B     U0950:	LD	HL,FLAGS
 1802 08E7  CB 5E       	BIT	3,(HL)		; Init?
 1803 08E9  28 0B       	JR	Z,U0976		; nein
 1804 08EB  CB 9E       	RES	3,(HL)		; Init ruecksetzen
 1805 08ED  CB DA       	SET	3,D		; Bit3(D)=1 fuer Open
 1806 08EF  21 0060     	LD	HL,FNAME	; Dateiname
 1807 08F2  DD CB 07 EE 	SET	5,(IX+7)	; Blocknummern unterdruecken
 1808 08F6  1E 38       U0976:	LD	E,MBOUT
 1809 08F8  D5          	PUSH	DE		; D=Steueryte auf Stack erhalten
 1810 08F9  CD F015     	CALL	PV5
 1811 08FC  D1          	POP	DE
 1812 08FD  D8          	RET	C		; Fehler
 1813 08FE  CB 72       	BIT	6,D		; war das Close?
 1814 0900  20 0A       	JR	NZ,U0977	; ja, Tastensimulation von BASEX zuruecknehmen
 1815 0902  DD CB 08 46 	BIT	0,(IX+8)	; Taste gedrueckt?
 1816                   ;	LD	A,(IX+13)	; Tastencode
 1817                   ;	OR	A		; Taste gedrueckt?
 1818 0906  C8          	RET	Z		; nein
 1819 0907  3E FF       	LD	A,0FFH
 1820 0909  32 0054     	LD	(U0044),A	; Abbruch/Fehler setzen
 1821 090C  DD CB 08 86 U0977:	RES	0,(IX+8)	; Tastendruck zuruecksetzen
 1822 0910  C9          	RET
 1823                   ;
 1824                   ; Datei im KC-Format zum Schreiben schliessen
 1825                   ; NF=3
 1826                   ; PA:	CY=1	Fehler
 1827                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  23
BAC85   Z80

 1828 0911  3E 03       U099A:	LD	A,3		; Ende-Kennung
 1829 0913  16 40       	LD	D,40H		; Bit6=1 fuer Close
 1830 0915  18 CD       	JR	U0950		; als letztes Zeichen in Datei schreiben
 1831                   ;
 1832                   ; IRM-Adresse auf linke Spalte / letzte Zeile setzen
 1833                   ;
 1834 0917  E5          U09AE:	PUSH	HL
 1835         0000      IF KC3
 1837                   ELSE
 1838 0918  21 80F8     	LD	HL,80F8H	; IRM-Adresse fuer Zeichen links/unten (KC85/4)
 1839                   ENDIF
 1840 091B  22 005C     	LD	(U004C),HL	; IRM-Adresse eintragen
 1841 091E  E1          	POP	HL
 1842 091F  C9          	RET
 1843                   ;
 1844                   ; unterste Bildschirmzeile malen mit dem Inhalt des Puffers
 1845                   ;
 1846 0920  CD 0917     U09C8:	CALL	U09AE		; IRM-Adresse auf links/unten einstellen
 1847 0923  21 0010     	LD	HL,U0000
 1848 0926  01 2820     	LD	BC,2820H	; B=40 Spalten, C=Leerzeichen
 1849 0929  7E          U09D1:	LD	A,(HL)
 1850 092A  B9          	CP	C		; Steuerzeichen?
 1851 092B  30 01       	JR	NC,U09D6	; nein
 1852 092D  79          	LD	A,C		; stattdessen Leerzeichen
 1853 092E  CD 0935     U09D6:	CALL	U09DD		; Zeichen malen
 1854 0931  23          	INC	HL
 1855 0932  10 F5       	DJNZ	U09D1
 1856 0934  C9          	RET
 1857                   ;
 1858                   ; Zeichen in unterster Bildschirmzeile malen (ohne VRAM)
 1859                   ;
 1860 0935  F5          U09DD:	PUSH	AF
 1861 0936  FE 20       	CP	20H		; Steuerzeichen?
 1862 0938  DC 0917     	CALL	C,U09AE		; dann wieder von vorn beginnen
 1863 093B  38 34       	JR	C,U0A19		; sonst nichts
 1864 093D  E5          	PUSH	HL
 1865 093E  D5          	PUSH	DE
 1866 093F  C5          	PUSH	BC
 1867 0940  5F          	LD	E,A		; Zeichen
 1868 0941  DB 88       	IN	A,(PIOAD)
 1869 0943  CB 57       	BIT	2,A		; IRM ein?
 1870 0945  CC F018     	CALL	Z,IRMON		; bei Bedarf einschalten
 1871 0948  F5          	PUSH	AF		; IRM-Zustand merken
 1872 0949  7B          	LD	A,E
 1873 094A  1E 20       	LD	E,' '
 1874 094C  BB          	CP	E		; Steuerzeichen?
 1875 094D  30 01       	JR	NC,U09F8	; nein
 1876 094F  7B          	LD	A,E		; stattdessen Leerzeichen anzeigen
 1877 0950  CD 0973     U09F8:	CALL	U0A1B		; Zeichenbildtabelle nach HL holen
 1878 0953  ED 5B 005C  	LD	DE,(U004C)	; IRM-Adresse
 1879 0957  D5          	PUSH	DE
 1880         0000      IF KC3
 1896                   ELSE
 1897 0958  01 0008     	LD	BC,8		; 8 Bit
 1898 095B  ED B0       	LDIR			; direkt in Pixel-IRM kopieren
 1899 095D  E1          	POP	HL
 1900 095E  24          	INC	H		; eine Spalte nach rechts
 1901 095F  22 005C     	LD	(U004C),HL	; IRM-Adresse fuer naechstes Zeichen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  24
BAC85   Z80

 1902 0962  7C          	LD	A,H
 1903 0963  FE A8       	CP	0A8H		; Ende erreicht?
 1904 0965  CC 0917     	CALL	Z,U09AE		; IRM-Adresse auf links/unten zurueckstellen
 1905                   ENDIF
 1906 0968  F1          	POP	AF
 1907 0969  CB 57       	BIT	2,A		; war IRM aus?
 1908 096B  CC F01B     	CALL	Z,IRMOFF	; dann jetzt wieder ausschalten
 1909 096E  C1          	POP	BC
 1910 096F  D1          	POP	DE
 1911 0970  E1          	POP	HL
 1912 0971  F1          U0A19:	POP	AF
 1913 0972  C9          	RET
 1914         0000      IF KC3
 1932                   ENDIF
 1933                   ;
 1934                   ; Zeichenbildtabelle holen
 1935                   ; PE:	A = Zeichencode
 1936                   ; PA:	HL = Adresse des Zeichencodes
 1937                   ;
 1938 0973  E6 7F       U0A1B:	AND	7FH		; ohne 7 Bit, also nur CCTL0/CCTL1
 1939 0975  FE 20       	CP	20H
 1940 0977  38 0D       	JR	C,U0A2E		; 00H bis 1FH aus CCTL1
 1941 0979  FE 60       	CP	60H
 1942 097B  30 07       	JR	NC,U0A2C	; 60H bis 7FH aus CCTL1
 1943 097D  2A B7A6     	LD	HL,(CCTL0)
 1944 0980  D6 20       	SUB	20H		; 20H bis 5FH aus CCTL0
 1945 0982  18 05       	JR	U0A31
 1946                   	;
 1947 0984  D6 40       U0A2C:	SUB	40H
 1948 0986  2A B7A8     U0A2E:	LD	HL,(CCTL1)
 1949 0989  D5          U0A31:	PUSH	DE
 1950 098A  EB          	EX	DE,HL
 1951 098B  6F          	LD	L,A
 1952 098C  26 00       	LD	H,0
 1953 098E  29          	ADD	HL,HL		; Zeichen * 8
 1954 098F  29          	ADD	HL,HL
 1955 0990  29          	ADD	HL,HL
 1956 0991  19          	ADD	HL,DE		; Zeichentabelle addieren
 1957 0992  D1          	POP	DE
 1958 0993  C9          	RET
 1959                   ;
 1960                   ; Tabelle der Zeitkonstanten fuer Tonwerte
 1961                   ;
 1962 0994  FF          U0A3C:	DB	0FFH	; 0	45
 1963 0995  F0          	DB	0F0H	; 1	46
 1964 0996  E3          	DB	0E3H	; 2	47
 1965 0997  D6          	DB	0D6H	; 3	48
 1966 0998  CA          	DB	0CAH	; 4	49
 1967 0999  BF          	DB	0BFH	; 5	50
 1968 099A  B4          	DB	0B4H	; 6	51
 1969 099B  AA          	DB	0AAH	; 7	52
 1970 099C  A1          	DB	0A1H	; 8	53
 1971 099D  98          	DB	98H	; 9	54
 1972 099E  8F          	DB	8FH	; 10	55
 1973 099F  87          	DB	87H	; 11	56
 1974 09A0  7F          	DB	7FH	; 12	57
 1975 09A1  78          	DB	78H	; 13	58
 1976 09A2  71          	DB	71H	; 14	59
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  25
BAC85   Z80

 1977 09A3  6B          	DB	6BH	; 15	60
 1978 09A4  65          	DB	65H	; 16	61
 1979 09A5  5F          	DB	5FH	; 17	62
 1980 09A6  5A          	DB	5AH	; 18	63
 1981 09A7  55          	DB	55H	; 19	64
 1982 09A8  50          	DB	50H	; 20	65
 1983 09A9  4C          	DB	4CH	; 21	66
 1984 09AA  47          	DB	47H	; 22	67
 1985 09AB  43          	DB	43H	; 23	68
 1986 09AC  40          	DB	40H	; 24	69
 1987 09AD  3C          	DB	3CH	; 25	70
 1988 09AE  39          	DB	39H	; 26	71
 1989 09AF  36          	DB	36H	; 27	72
 1990 09B0  33          	DB	33H	; 28	73
 1991 09B1  30          	DB	30H	; 29	74
 1992 09B2  2D          	DB	2DH	; 30	75
 1993 09B3  2B          	DB	2BH	; 31	76
 1994 09B4  28          	DB	28H	; 32	77
 1995 09B5  26          	DB	26H	; 33	78
 1996 09B6  24          	DB	24H	; 34	79
 1997 09B7  22          	DB	22H	; 35	80
 1998 09B8  20          	DB	20H	; 36	81
 1999 09B9  1E          	DB	1EH	; 37	82
 2000 09BA  1C          	DB	1CH	; 38	83
 2001 09BB  1B          	DB	1BH	; 39	84
 2002 09BC  19          	DB	19H	; 40	85
 2003 09BD  18          	DB	18H	; 41	86
 2004 09BE  17          	DB	17H	; 42	87
 2005 09BF  15          	DB	15H	; 43	88
 2006 09C0  14          	DB	14H	; 44	89
 2007 09C1  13          	DB	13H	;	90
 2008 09C2  12          	DB	12H	;	91
 2009 09C3  11          	DB	11H	;	92
 2010 09C4  10          	DB	10H	;	93
 2011 09C5  0F          	DB	0FH	;	94
 2012 09C6  0E          	DB	0EH	;	95
 2013 09C7  0D          	DB	0DH	;	96
 2014 09C8  0D          	DB	0DH	;	97
 2015 09C9  0C          	DB	0CH	;	98
 2016 09CA  0B          	DB	0BH	;	99
 2017 09CB  0B          	DB	0BH	;	100
 2018 09CC  0A          	DB	0AH	;	101
 2019 09CD  09          	DB	09H	;	102
 2020 09CE  09          	DB	09H	;	103
 2021 09CF  08          	DB	08H	;	104
 2022 09D0  08          	DB	08H	;	105
 2023 09D1  08          	DB	08H	;	106
 2024 09D2  07          	DB	07H	;	107
 2025 09D3  07          U0A7B:	DB	07H	;	108	(Zeiger auf USER-Eingabe Kanal 2)
 2026 09D4  06          	DB	06H	;	109
 2027 09D5  06          	DB	06H	;	110
 2028 09D6  06          	DB	06H	;	111
 2029 09D7  05          	DB	05H	;	112
 2030 09D8  05          	DB	05H	;	113
 2031 09D9  05          	DB	05H	;	114
 2032 09DA  04          	DB	04H	;	115
 2033 09DB  04          	DB	04H	;	116
 2034 09DC  04          	DB	04H	;	117
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  26
BAC85   Z80

 2035 09DD  04          	DB	04H	;	118
 2036 09DE  04          	DB	04H	;	119
 2037 09DF  03          	DB	03H	;	120
 2038 09E0  03          	DB	03H	;	121
 2039 09E1  03          	DB	03H	;	121
 2040 09E2  03          	DB	03H	;	123
 2041 09E3  03          	DB	03H	;	124
 2042 09E4  03          	DB	03H	;	125
 2043 09E5  02          	DB	02H	;	126
 2044 09E6  02          	DB	02H	;	127
 2045                   
 2046         0000      IF KC3
 2051                   ELSE
 2052                   ;
 2053                   ; Zeichenkette zum Hervorheben (invers) beim KC85/4
 2054                   ;
 2055 09E7  20          U0A8F:	DB	' '
 2056 09E8  20          U0A90:	DB	' '
 2057 09E9  1B 37       	DB	ESC,'7'		; Invers ein/aus
 2058 09EB  20 20       	DB	'  '
 2059                   ENDIF
 2060                   ;
 2061                   ; F-Tastenbelegung
 2062                   ;
 2063 09ED  00          U0A95:	NOP
 2064 09EE  2A 4C 0D    	DB	'*L',CR		; F1
 2065 09F1  00          	NOP
 2066 09F2  2A 41 0D    	DB	'*A',CR		; F2
 2067 09F5  00          	NOP
 2068 09F6  2A 57 0D    	DB	'*W',CR		; F3
 2069 09F9  00          	NOP
 2070 09FA  2A 54 0D    	DB	'*T',CR		; F4
 2071 09FD  00          	NOP
 2072 09FE  2A 43 0D    	DB	'*C',CR		; F5
 2073 0A01  00          	NOP
 2074 0A02  2A 4B 0D    	DB	'*K',CR		; F6
 2075 0A05  00          	NOP
 2076 0A06  1D          	DB	1DH		; Shift+F1 = RUN
 2077 0A07  00          	NOP
 2078 0A08  1E          	DB	1EH		; Shift+F2 = CONT
 2079 0A09  00          	NOP
 2080 0A0A  1C          	DB	1CH		; Shift+F3 = LIST
 2081 0A0B  00          	NOP
 2082 0A0C  02 25 52 45 	DB	2,'%REBASIC',0DH,'CALL*'	; Shift+F4
 2083                   	ASCTXT	U040D
   12 0A1B  34          		DB	(U040D/100H AND 0FH) + 30H
   18 0A1C  30          		DB	(U040D/10H AND 0FH) + 30H
   22 0A1D  44          		DB	(U040D AND 0FH) + 37H
 2084 0A1E  0D          	DB	CR
 2085 0A1F  00          	NOP
 2086 0A20  43 4C 4F 41 	DB	'CLOAD"'	; Shift+F5
 2087 0A26  00          	NOP
 2088 0A27  02 43 53 41 	DB	2,'CSAVE"'	; Shift+F6
 2089 0A2E  00          	NOP
 2090                   ;
 2091                   ; Daten fuer Titelbild
 2092                   ;
 2093 0A2F  01 1F 01 1F U0AD7:	DB	01H,1FH,01H,1FH		; 43 Linien fuer Schallplatte
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  27
BAC85   Z80

 2094 0A33  02 05 06 0E 	DB	02H,05H,06H,0EH
 2095 0A37  01 1E 08 1E 	DB	01H,1EH,08H,1EH
 2096 0A3B  03 05 07 0E 	DB	03H,05H,07H,0EH
 2097 0A3F  01 1D 0B 1D 	DB	01H,1DH,0BH,1DH
 2098 0A43  01 0B 01 0B 	DB	01H,0BH,01H,0BH
 2099 0A47  01 1C 0E 1C 	DB	01H,1CH,0EH,1CH
 2100 0A4B  01 0A 05 0A 	DB	01H,0AH,05H,0AH		; 8. Linie
 2101 0A4F  01 1B 10 1B 	DB	01H,1BH,10H,1BH
 2102 0A53  01 09 07 09 	DB	01H,09H,07H,09H
 2103 0A57  01 1A 12 1A 	DB	01H,1AH,12H,1AH
 2104 0A5B  02 08 08 08 	DB	02H,08H,08H,08H
 2105 0A5F  01 19 13 19 	DB	01H,19H,13H,19H
 2106 0A63  06 07 09 07 	DB	06H,07H,09H,07H
 2107 0A67  01 18 14 18 	DB	01H,18H,14H,18H		; 15. Linie
 2108 0A6B  07 06 09 06 	DB	07H,06H,09H,06H
 2109 0A6F  01 17 15 17 	DB	01H,17H,15H,17H
 2110 0A73  08 05 0A 05 	DB	08H,05H,0AH,05H
 2111 0A77  01 16 16 16 	DB	01H,16H,16H,16H
 2112 0A7B  08 04 0A 04 	DB	08H,04H,0AH,04H
 2113 0A7F  01 15 17 15 	DB	01H,15H,17H,15H
 2114 0A83  08 03 0A 03 	DB	08H,03H,0AH,03H		; 22. Linie
 2115 0A87  01 14 18 14 	DB	01H,14H,18H,14H
 2116 0A8B  08 02 0A 02 	DB	08H,02H,0AH,02H
 2117 0A8F  01 13 19 13 	DB	01H,13H,19H,13H
 2118 0A93  05 01 1F 01 	DB	05H,01H,1FH,01H
 2119 0A97  01 12 1A 12 	DB	01H,12H,1AH,12H
 2120 0A9B  0E 02 1E 02 	DB	0EH,02H,1EH,02H
 2121 0A9F  01 11 1A 11 	DB	01H,11H,1AH,11H		; 29. Linie
 2122 0AA3  0E 03 1E 03 	DB	0EH,03H,1EH,03H
 2123 0AA7  01 10 1B 10 	DB	01H,10H,1BH,10H
 2124 0AAB  0E 04 1E 04 	DB	0EH,04H,1EH,04H
 2125 0AAF  01 0F 1B 0F 	DB	01H,0FH,1BH,0FH
 2126 0AB3  0E 05 1E 05 	DB	0EH,05H,1EH,05H		; 34. Linie
 2127 0AB7  02 0E 1C 0E 	DB	02H,0EH,1CH,0EH
 2128 0ABB  0E 06 1E 06 	DB	0EH,06H,1EH,06H
 2129 0ABF  07 0D 1C 0D 	DB	07H,0DH,1CH,0DH
 2130 0AC3  0D 07 1E 07 	DB	0DH,07H,1EH,07H
 2131 0AC7  09 0C 1C 0C 	DB	09H,0CH,1CH,0CH
 2132 0ACB  0D 08 1E 08 	DB	0DH,08H,1EH,08H
 2133 0ACF  0B 0B 1D 0B 	DB	0BH,0BH,1DH,0BH
 2134 0AD3  0C 09 1D 09 	DB	0CH,09H,1DH,09H
 2135 0AD7  0C 0A 1D 0A 	DB	0CH,0AH,1DH,0AH		; 43. Linie
 2136                   
 2137 0ADB  00 08 05 00 	DB	00H,08H,05H,00H		; Linien fuer TAPE-Signal
 2138 0ADF  00 F8 05 00 	DB	00H,0F8H,05H,00H
 2139 0AE3  00 08 05 00 	DB	00H,08H,05H,00H
 2140 0AE7  00 F8 05 00 	DB	00H,0F8H,05H,00H
 2141 0AEB  00 08 0A 00 	DB	00H,08H,0AH,00H
 2142 0AEF  00 F8 0A 00 	DB	00H,0F8H,0AH,00H
 2143                   
 2144 0AF3  020A        	DW	020AH		; Posision
 2145 0AF5  42 41 53 49 	DB	'BASICODE-3C Version 1.5d',0
 2146                   
 2147 0B0E  0412        	DW	0412H		; Position
 2148         0000      IF KC3
 2152                   ELSE
 2153         0000      IF DEV
 2155                   ELSE
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  28
BAC85   Z80

 2156 0B10  4B 43 38 35 	DB	'KC85/4',0
 2157                   ENDIF
 2158 0B17  060A        	DW	060AH		; Position
 2159 0B19  5A 69 65 72 	DB	'Zierott, Wenzel, Leubner'
 2160                   ENDIF
 2161 0B31  0D 0A 0A 0A 	DB	CR,LF,LF,LF,LF,LF
 2162 0B37  00          	DB	0
 2163                   ;
 2164                   ; Kaltstart (Initialisierung mit CALL*410)
 2165                   ;
 2166 0B38  DD 6E 0E    KALT:	LD	L,(IX+14)	; KTAB
 2167 0B3B  DD 66 0F    	LD	H,(IX+15)	; aktueller Wert
 2168 0B3E  22 005E     	LD	(U004E),HL	; hier merken
 2169 0B41  AF          	XOR	A		; A=0
 2170 0B42  32 003B     	LD	(FLAGS),A
 2171 0B45  32 0055     	LD	(U0045),A	; keine Kanaele geoeffnet
 2172                   ; 13.11.2023, Frank Ludwig:
 2173                   ; Beim Kaltstart wird das Basicodeprogramm nicht sauber geloescht.
 2174                   ; Die Zeiger werden zwar auf das Ende des Bascoders gesetzt.
 2175                   ; Die zwei Null-Bytes, die das Programmende kennzeichnen werden dort
 2176                   ; aber nicht eingetragen. Der Zeiger auf den Anfang der naechsten Zeile bleibt
 2177                   ; also bestehen.
 2178                   ;
 2179 0B48  21 212C     	LD	HL,Z1000	; Anfang BASICODE-Programm
 2180 0B4B  77          	LD	(HL),A		; Eintragen der beiden Null-Bytes
 2181 0B4C  23          	INC	HL
 2182 0B4D  77          	LD	(HL),A
 2183 0B4E  23          	INC	HL		; Programmende, Basicode-Programm loeschen
 2184                   
 2185 0B4F  3C          	INC	A		; A=1
 2186 0B50  32 0340     	LD	(DUMMY),A	; Anzahl Dummyzeichen
 2187                   ;	LD	HL,U21F3	; Programmende, Basicode-Programm loeschen
 2188 0B53  22 03D7     	LD	(SVARPT),HL	; Anfang Variablenspeicher
 2189 0B56  22 03D9     	LD	(DVARPT),HL	; Liste der Feldvariablen
 2190 0B59  22 03DB     	LD	(FSLPTR),HL	; Erste freie Adresse hinter den Listen
 2191                   ;
 2192                   ; Warmstart (CALL*40D)
 2193                   ;
 2194 0B5C  CD 0441     WARM:	CALL	BCINIT		; Initialisierung, Druckertreiber kopieren
 2195 0B5F  21 0D41     	LD	HL,BCMENU	; BASICODE-Menue
 2196 0B62  E5          	PUSH	HL		; als Ruecksprungadresse auf den Stack
 2197 0B63  3E C3       	LD	A,0C3H		; JUMP auf 38H eintragen
 2198 0B65  32 0038     	LD	(U0038),A	; RST38 abfangen
 2199 0B68  21 0413     	LD	HL,U0413	; "Systemabsturz"-Meldung
 2200 0B6B  22 0039     	LD	(U0039),HL	; als Sprungadresse
 2201 0B6E  21 212C     WARM1:	LD	HL,Z1000	; Anfang BASIC-Programm Zeile 1000
 2202 0B71  22 035F     	LD	(PSTBEG),HL	; als sichtbaren Anfang einstellen
 2203 0B74  21 04AD     	LD	HL,U04C3	; eigene Routine fuer
 2204 0B77  22 B7C9     	LD	(IO_ERR),HL	; IO-ERROR regenerieren
 2205 0B7A  CD 065E     	CALL	U0643		; Original-KTAB einstellen (BRK/STOP aktiviert)
 2206 0B7D  3A 0055     	LD	A,(U0045)	; BASICODE-Kanaele geoeffnet?
 2207 0B80  B7          	OR	A
 2208 0B81  C8          	RET	Z		; nein, dann Logo und Speicherbelegung anzeigen
 2209 0B82  CD F01B     	CALL	IRMOFF		; ansonsten jetzt IRM OFF (???)
 2210 0B85  21 1E7D     	LD	HL,U1E81+16	; Ende von Sprungverteiler Datei Schliessen
 2211 0B88  87          WARM2:	ADD	A		; Entspechend der Bitnummer ...
 2212 0B89  2B          	DEC	HL		; ... Sprungadresse suchen
 2213 0B8A  2B          	DEC	HL		;  (benutzt werden die Bits 0..3)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  29
BAC85   Z80

 2214 0B8B  38 0E       	JR	C,WARM3		; Datei schliessen
 2215 0B8D  20 F9       	JR	NZ,WARM2	; noch weitere Dateien offen
 2216 0B8F  32 0055     	LD	(U0045),A	; wenn fertig, alle Kanaele geschlossen
 2217 0B92  21 1C97     	LD	HL,U1CAB	; Text 'Bestaende geschlossen!'
 2218 0B95  CD 1A51     	CALL	U1AE5		; anzeigen
 2219 0B98  C3 C08C     	JP	SECST		; RESTART BASIC-Interpreter
 2220                   	;
 2221 0B9B  F5          WARM3:	PUSH	AF
 2222 0B9C  E5          	PUSH	HL
 2223 0B9D  7E          	LD	A,(HL)		; Adresse aus Sprungverteiler lesen
 2224 0B9E  23          	INC	HL
 2225 0B9F  66          	LD	H,(HL)
 2226 0BA0  6F          	LD	L,A
 2227 0BA1  CD 15BD     	CALL	CALLHL		; CALL (HL) hier Kanal schliessen
 2228 0BA4  E1          	POP	HL
 2229 0BA5  F1          	POP	AF
 2230 0BA6  18 E0       	JR	WARM2
 2231                   ;
 2232                   ; abgefangene Eingaberoutine bei USER-INPUT 2 (07H)
 2233                   ; konvertiert bei Bedarf das ASCII-File zu BASIC, indem das ASCII-File
 2234                   ; als Eingabedaten verwendet wird.
 2235                   ;
 2236 0BA8  3A 003B     U0C39:	LD	A,(FLAGS)
 2237 0BAB  CB 47       	BIT	0,A		; laeuft gerade Konvertierung ASCII -> BASIC?
 2238 0BAD  C2 0C61     	JP	NZ,U0CE2	; ja
 2239 0BB0  2A 0358     	LD	HL,(CULINO)	; aktuelle Zeilennummer
 2240 0BB3  23          	INC	HL
 2241 0BB4  3A 034D     	LD	A,(AUTOFG)	; automatische Zeilennummerierung?
 2242 0BB7  B4          	OR	H		; oder Programm-Mode?
 2243 0BB8  B5          	OR	L
 2244 0BB9  C2 0638     	JP	NZ,U062C	; dann direkt zu KBD
 2245 0BBC  CD 0B6E     	CALL	WARM1		; Programmanfang auf Zeile 1000 stellen und
 2246                   				; BASICODE-Dateien schliessen, falls noetig
 2247 0BBF  CD 0638     	CALL	U062C		; Eingabe ein Zeichen
 2248 0BC2  FE 20       	CP	20H
 2249 0BC4  D0          	RET	NC		; kein Steuerzeichen
 2250 0BC5  FE 1D       	CP	1DH
 2251 0BC7  28 41       	JR	Z,U1AAE		; RUN-Taste -> BASICODE-Routinen aktivieren
 2252 0BC9  FE 1E       	CP	1EH
 2253 0BCB  28 3D       	JR	Z,U1AAE		; CONT-Taste -> BASICODE-Routinen aktivieren
 2254 0BCD  FE 0D       	CP	CR
 2255 0BCF  C0          	RET	NZ		; nicht Enter
 2256                   
 2257                   ; bei Enter noch testen, was im Eingabepuffer steht:
 2258 0BD0  21 0361     	LD	HL,INPBUF	; Eingabepuffer
 2259 0BD3  23          U0C66:	INC	HL
 2260 0BD4  7E          	LD	A,(HL)
 2261 0BD5  FE 20       	CP	20H
 2262 0BD7  28 FA       	JR	Z,U0C66		; Leerzeichen uebergehen
 2263 0BD9  C5          	PUSH	BC
 2264 0BDA  D5          	PUSH	DE
 2265 0BDB  11 1EA3     	LD	DE,U1EB7	; diese Befehle abfangen (CONT, GO, RUN, CSAVE)
 2266 0BDE  06 04       	LD	B,4		; 4 Befehle
 2267 0BE0  E5          U0C73:	PUSH	HL
 2268 0BE1  7E          U0C74:	LD	A,(HL)		; Zeichen aus Eingabepuffer
 2269 0BE2  E6 5F       	AND	5FH		; UPCASE
 2270 0BE4  4F          	LD	C,A		; in C merken
 2271 0BE5  1A          	LD	A,(DE)		; Zeichen aus Vergleichsspeicher
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  30
BAC85   Z80

 2272 0BE6  13          	INC	DE
 2273 0BE7  B7          	OR	A		; Ende-0?
 2274 0BE8  28 16       	JR	Z,U0C93		; Befehl erkannt
 2275 0BEA  23          	INC	HL
 2276 0BEB  B9          	CP	C
 2277 0BEC  28 F3       	JR	Z,U0C74		; stimmt, weitersuchen
 2278 0BEE  E1          	POP	HL
 2279 0BEF  1A          U0C82:	LD	A,(DE)
 2280 0BF0  13          	INC	DE
 2281 0BF1  B7          	OR	A		; Ende-0 suchen
 2282 0BF2  20 FB       	JR	NZ,U0C82
 2283 0BF4  10 EA       	DJNZ	U0C73		; bis alle 4 Befehle getestet sind
 2284 0BF6  D1          	POP	DE
 2285 0BF7  C1          	POP	BC
 2286 0BF8  7E          	LD	A,(HL)		; Eingabepuffer
 2287 0BF9  FE 2A       	CP	'*'		; Sonderbefehl mit * ?
 2288 0BFB  28 21       	JR	Z,U0CA5
 2289 0BFD  3E 0D       	LD	A,CR		; ansonsten einfach das CR zurueckgeben
 2290 0BFF  C9          	RET
 2291                   ;
 2292                   ; CONT, GO, RUN oder CSAVE erkannt:
 2293                   ;
 2294 0C00  E3          U0C93:	EX	(SP),HL
 2295 0C01  D1          	POP	DE
 2296 0C02  78          	LD	A,B
 2297 0C03  3D          	DEC	A
 2298 0C04  28 11       	JR	Z,U0C9E		; CSAVE
 2299 0C06  D1          	POP	DE
 2300 0C07  C1          	POP	BC
 2301 0C08  3E 0D       	LD	A,CR		; CR, RUN-Mode
 2302 0C0A  21 04B7     U1AAE:	LD	HL,U04C4	; Spezial-Routine fuer
 2303 0C0D  22 B7C9     	LD	(IO_ERR),HL	; IO-ERROR eintragen
 2304 0C10  21 1F0F     	LD	HL,ZEILE2	; BASICODE-Routinen freigeben fuer RUN-Modus
 2305 0C13  22 035F     	LD	(PSTBEG),HL	; als Programmstart-Adresse eintragen
 2306 0C16  C9          	RET
 2307                   	;
 2308 0C17  C1          U0C9E:	POP	BC
 2309 0C18  C1          	POP	BC
 2310 0C19  77          	LD	(HL),A
 2311 0C1A  0E 07       	LD	C,7		; 7. Sonderbefehl
 2312 0C1C  18 1D       	JR	U0CBA		; aus Sprungtabelle lesen
 2313                   ;
 2314                   ; Sonderbehandlung Befehle mit *
 2315                   ;
 2316 0C1E  36 00       U0CA5:	LD	(HL),0		; Stern im Eingabepuffer loeschen
 2317                   ;	CALL	IRMON
 2318 0C20  3E 31       	LD	A,DEFCOL	; Standardfarbe einstellen
 2319 0C22  32 B7A3     	LD	(COLOR),A
 2320 0C25  CD F01B     	CALL	IRMOFF
 2321 0C28  CD C8BD     	CALL	TCHAR		; naechstes gueltiges Zeichen holen
 2322                   
 2323 0C2B  E6 5F       	AND	5FH		; upcase
 2324 0C2D  21 1E8D     	LD	HL,U1EA1	; 6 Kennbuchstaben
 2325 0C30  01 0006     	LD	BC,6
 2326 0C33  ED B1       	CPIR
 2327 0C35  28 04       	JR	Z,U0CBA		; gefunden
 2328 0C37  50          	LD	D,B		; D=0
 2329 0C38  59          	LD	E,C		; E=0
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  31
BAC85   Z80

 2330 0C39  0E 06       	LD	C,6		; 6. Befehl = Menue
 2331 0C3B  79          U0CBA:	LD	A,C
 2332 0C3C  CD F018     	CALL	IRMON
 2333 0C3F  FD 2A 0356  	LD	IY,(STDPTR)	; RAM-Mindestgroesse (KC85/3=7EFF KC85/4=BEFF)
 2334 0C43  FD 2B       	DEC	IY		; davor gehen und als neuen Stack definieren
 2335         0000      IF KC3
 2337                   ENDIF
 2338 0C45  CD F01B     	CALL	IRMOFF
 2339 0C48  01 C08C     	LD	BC,SECST	; RESTART BASIC-Interpreter
 2340 0C4B  C5          	PUSH	BC		; auf Stack legen als RET-Adresse
 2341 0C4C  21 1E93     	LD	HL,U1EA7	; Tabelle der Sprungadressen der Routinen
 2342 0C4F  4F          	LD	C,A
 2343 0C50  06 00       	LD	B,0		; BC=Nr. der Routine
 2344 0C52  09          	ADD	HL,BC
 2345 0C53  09          	ADD	HL,BC		; Position in Tabelle berechnen
 2346 0C54  4E          	LD	C,(HL)
 2347 0C55  23          	INC	HL
 2348 0C56  46          	LD	B,(HL)		; BC=Sprungadresse
 2349 0C57  C5          	PUSH	BC		; auf Stack legen zum Start
 2350 0C58  EB          	EX	DE,HL
 2351 0C59  FE 07       	CP	7
 2352 0C5B  C4 05DC     	CALL	NZ,CLS		; Bildschirm loeschen, ausser bei CSAVE
 2353 0C5E  C3 CB61     	JP	CRWDY2		; Anzeige CR, LF, Dummyzeichen
 2354                   ;
 2355                   ; USER-Input 2 waehrend Uebersetzung ASCII -> BASIC
 2356                   ;
 2357 0C61  D5          U0CE2:	PUSH	DE
 2358 0C62  CD 061F     	CALL	U0613		; Taste gedrueckt?
 2359 0C65  FE 03       	CP	3		; BRK?
 2360 0C67  28 17       	JR	Z,U0D01		; ja
 2361 0C69  2A 0049     	LD	HL,(CPOINT)	; Pufferzeiger
 2362 0C6C  F3          	DI
 2363 0C6D  DB 88       	IN	A,(PIOAD)
 2364 0C6F  CB 97       	RES	2,A		; IRM aus
 2365 0C71  D3 88       	OUT	(PIOAD),A
 2366 0C73  7E          	LD	A,(HL)
 2367 0C74  ED 5B 0047  	LD	DE,(U0033)	; Ende ASCII-File
 2368 0C78  1B          	DEC	DE
 2369 0C79  E5          	PUSH	HL
 2370 0C7A  B7          	OR	A
 2371 0C7B  ED 52       	SBC	HL,DE
 2372 0C7D  E1          	POP	HL
 2373 0C7E  38 29       	JR	C,U0D2A
 2374 0C80  4F          U0D01:	LD	C,A
 2375 0C81  3A 003B     	LD	A,(FLAGS)
 2376 0C84  E6 FC       	AND	0FCH		; Bit 0 und 1 ruecksetzen
 2377 0C86  32 003B     	LD	(FLAGS),A
 2378 0C89  DB 88       	IN	A,(PIOAD)
 2379 0C8B  CB D7       	SET	2,A		; IRM ein
 2380 0C8D  D3 88       	OUT	(PIOAD),A
 2381 0C8F  FB          	EI
 2382 0C90  2A 0051     	LD	HL,(U0041)	; gespeicherte Adresse fuer UOUT1
 2383 0C93  22 B7BE     	LD	(UOUT1+1),HL	; wieder eintragen
 2384 0C96  2A 003C     	LD	HL,(XPOS2)	; gespeicherte Adresse fuer OUTAB
 2385 0C99  22 B7B9     	LD	(OUTAB),HL	; wieder eintragen
 2386 0C9C  79          	LD	A,C
 2387 0C9D  FE 1D       	CP	1DH		; RUN?
 2388 0C9F  D1          	POP	DE
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  32
BAC85   Z80

 2389 0CA0  CA 0C0A     	JP	Z,U1AAE		; -> BASICODE-Routinen aktivieren
 2390 0CA3  D6 03       	SUB	3
 2391 0CA5  C8          	RET	Z		; BRK
 2392 0CA6  3E 0D       	LD	A,CR
 2393 0CA8  C9          	RET
 2394                   	;
 2395 0CA9  FE 0D       U0D2A:	CP	CR
 2396 0CAB  20 05       	JR	NZ,U0D33
 2397 0CAD  CD 0917     	CALL	U09AE		; IRM-Adresse auf links/unten einstellen
 2398 0CB0  18 0C       	JR	U0D3F
 2399                   	;
 2400 0CB2  FE 20       U0D33:	CP	20H		; Steuerzeichen?
 2401 0CB4  38 04       	JR	C,U0D3B
 2402 0CB6  FE 7F       	CP	7FH
 2403 0CB8  38 04       	JR	C,U0D3F
 2404 0CBA  3E 23       U0D3B:	LD	A,'#'		; Ersatz fuer nicht darstellbare Zeichen
 2405 0CBC  18 05       	JR	U0D44
 2406                   	;
 2407 0CBE  47          U0D3F:	LD	B,A
 2408 0CBF  CD 0CD2     	CALL	U0D53		; Spezialbehandlung fuer DATA, REM und LOG
 2409 0CC2  78          	LD	A,B
 2410 0CC3  23          U0D44:	INC	HL
 2411 0CC4  22 0049     	LD	(CPOINT),HL	; Pufferzeiger
 2412 0CC7  D1          	POP	DE
 2413 0CC8  47          	LD	B,A
 2414 0CC9  DB 88       	IN	A,(PIOAD)
 2415 0CCB  CB D7       	SET	2,A		; IRM ein
 2416 0CCD  D3 88       	OUT	(PIOAD),A
 2417 0CCF  FB          	EI
 2418 0CD0  78          	LD	A,B
 2419 0CD1  C9          	RET
 2420                   ;
 2421                   ; Spezialbehandlung fuer DATA, REM und LOG
 2422                   ;
 2423 0CD2  3A 003B     U0D53:	LD	A,(FLAGS)
 2424 0CD5  E6 40       	AND	40H		; Bit 6?
 2425 0CD7  20 55       	JR	NZ,U0DAF
 2426 0CD9  78          	LD	A,B
 2427 0CDA  FE 22       	CP	'"'
 2428 0CDC  28 30       	JR	Z,U0D8F		; Zeichenkette
 2429 0CDE  E5          	PUSH	HL
 2430 0CDF  23          	INC	HL
 2431 0CE0  FE 4C       	CP	'L'
 2432 0CE2  28 38       	JR	Z,U0D9D
 2433 0CE4  FE 52       	CP	'R'
 2434 0CE6  28 19       	JR	Z,U0D82
 2435 0CE8  FE 44       	CP	'D'
 2436 0CEA  20 2E       	JR	NZ,U0D9B
 2437                   ; D
 2438 0CEC  7E          	LD	A,(HL)
 2439 0CED  FE 41       	CP	'A'
 2440 0CEF  20 29       	JR	NZ,U0D9B
 2441                   ; DA
 2442 0CF1  23          	INC	HL
 2443 0CF2  7E          	LD	A,(HL)
 2444 0CF3  FE 54       	CP	'T'
 2445 0CF5  20 23       	JR	NZ,U0D9B
 2446                   ; DAT
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  33
BAC85   Z80

 2447 0CF7  23          	INC	HL
 2448 0CF8  7E          	LD	A,(HL)
 2449 0CF9  FE 41       	CP	'A'
 2450 0CFB  20 1D       	JR	NZ,U0D9B
 2451                   ; DATA
 2452 0CFD  3E 3A       	LD	A,':'
 2453 0CFF  18 0C       	JR	U0D8E
 2454                   	;
 2455                   ; R
 2456 0D01  7E          U0D82:	LD	A,(HL)
 2457 0D02  FE 45       	CP	'E'
 2458 0D04  20 14       	JR	NZ,U0D9B
 2459                   ; RE
 2460 0D06  23          	INC	HL
 2461 0D07  7E          	LD	A,(HL)
 2462 0D08  FE 4D       	CP	'M'
 2463 0D0A  20 0E       	JR	NZ,U0D9B
 2464                   ; REM
 2465 0D0C  AF          	XOR	A
 2466 0D0D  E1          U0D8E:	POP	HL
 2467 0D0E  32 004C     U0D8F:	LD	(U003C),A
 2468 0D11  3A 003B     	LD	A,(FLAGS)
 2469 0D14  F6 40       	OR	40H		; Bit 6 setzen
 2470 0D16  32 003B     	LD	(FLAGS),A
 2471 0D19  C9          	RET
 2472                   	;
 2473                   ; alles andere
 2474 0D1A  E1          U0D9B:	POP	HL
 2475 0D1B  C9          	RET
 2476                   	;
 2477                   ; L
 2478 0D1C  7E          U0D9D:	LD	A,(HL)
 2479 0D1D  FE 4F       	CP	'O'
 2480 0D1F  20 F9       	JR	NZ,U0D9B
 2481                   ; LO
 2482 0D21  23          	INC	HL
 2483 0D22  7E          	LD	A,(HL)
 2484 0D23  FE 47       	CP	'G'
 2485 0D25  20 F3       	JR	NZ,U0D9B
 2486                   ; LOG
 2487 0D27  E1          	POP	HL
 2488 0D28  23          	INC	HL
 2489 0D29  23          	INC	HL
 2490 0D2A  36 4E       	LD	(HL),'N'	; LOG -> LN
 2491 0D2C  2B          	DEC	HL
 2492 0D2D  C9          	RET
 2493                   	;
 2494 0D2E  3A 004C     U0DAF:	LD	A,(U003C)
 2495 0D31  B8          	CP	B
 2496 0D32  28 04       	JR	Z,U0DB9
 2497 0D34  3E 0D       	LD	A,CR
 2498 0D36  B8          	CP	B
 2499 0D37  C0          	RET	NZ
 2500 0D38  3A 003B     U0DB9:	LD	A,(FLAGS)
 2501 0D3B  E6 BF       	AND	0BFH		; Bit 6 ruecksetzen
 2502 0D3D  32 003B     	LD	(FLAGS),A
 2503 0D40  C9          	RET
 2504                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  34
BAC85   Z80

 2505                   ; Speicherbelegung anzeigen
 2506                   ;
 2507 0D41  21 0007     BCMENU:	LD	HL,7		; Stacktiefe in Bytes-1
 2508                   ;
 2509                   ; BASICODE-Menu
 2510                   ;
 2511 0D44  E5          STAR:	PUSH	HL
 2512 0D45  CD 04C1     	CALL	TITEL		; Titelbild zeichnen
 2513 0D48  2A 03D7     	LD	HL,(SVARPT)	; Ende BASIC-Programm
 2514 0D4B  11 212E     	LD	DE,U21F3	; Anfang BASIC-Programm
 2515 0D4E  B7          	OR	A
 2516 0D4F  ED 52       	SBC	HL,DE		; berechnen
 2517 0D51  11 1D04     	LD	DE,U1D18	; Text "Programm:"
 2518 0D54  CD 0D89     	CALL	U0E0A		; Text+Wert anzeigen
 2519 0D57  CD 1A20     	CALL	U1AB5		; ASCII-File und BASIC-Programm im Speicher?
 2520 0D5A  E6 02       	AND	2
 2521 0D5C  21 0000     	LD	HL,0
 2522 0D5F  28 09       	JR	Z,U0DEB		; kein ASCII-File im Speicher
 2523 0D61  2A 0047     	LD	HL,(U0033)	; Ende ASCII-File
 2524 0D64  ED 5B 0045  	LD	DE,(U0031)	; Beginn ASCII-File
 2525 0D68  ED 52       	SBC	HL,DE
 2526 0D6A  11 1D10     U0DEB:	LD	DE,U1D24	; Text "ASC-File:"
 2527 0D6D  CD 0D89     	CALL	U0E0A		; Text+Wert anzeigen
 2528 0D70  D1          	POP	DE
 2529 0D71  21 FFF3     	LD	HL,-13		; freien Speicher
 2530 0D74  19          	ADD	HL,DE
 2531 0D75  39          	ADD	HL,SP
 2532 0D76  ED 5B 03DB  	LD	DE,(FSLPTR)	; erste freie Adresse hinter den Variablen
 2533 0D7A  B7          	OR	A
 2534 0D7B  ED 52       	SBC	HL,DE
 2535 0D7D  11 1D1A     	LD	DE,U1D2E	; Text "Frei:"
 2536 0D80  CD 0D89     	CALL	U0E0A		; anzeigen
 2537 0D83  21 1D24     	LD	HL,U1D38	; Text "BASICODE-Menue..."
 2538 0D86  C3 C5F1     	JP	TEXTOE		; anzeigen
 2539                   ;
 2540                   ; Ausgabe Prgrammgroesse in Bytes
 2541                   ;
 2542 0D89  EB          U0E0A:	EX	DE,HL
 2543 0D8A  D5          	PUSH	DE
 2544 0D8B  CD C5F1     	CALL	TEXTOE		; Textausgabe
 2545 0D8E  D1          	POP	DE
 2546 0D8F  CD D82A     	CALL	NUMBO1		; Zahl ausgeben
 2547 0D92  21 1CFB     	LD	HL,U1D0F	; Text "Bytes", CR, LF
 2548 0D95  C3 C5F1     	JP	TEXTOE		; Textausgabe
 2549                   ;
 2550                   ; *L - Laden, Uebersetzen und Starten
 2551                   ;
 2552 0D98  2A 212C     STAR_L:	LD	HL,(Z1000)	; Anfang BASIC-Programm
 2553 0D9B  7C          	LD	A,H
 2554 0D9C  B5          	OR	L
 2555 0D9D  28 18       	JR	Z,U0E38		; kein BASIC-Programm im Speicher
 2556 0D9F  21 1C62     	LD	HL,U1C76	; Text 'Programm wurde geloescht!'
 2557 0DA2  CD 1A51     	CALL	U1AE5		; anzeigen
 2558 0DA5  21 0000     	LD	HL,0		; Programm loeschen
 2559 0DA8  22 212C     	LD	(Z1000),HL	; Anfang BASIC-Programm
 2560 0DAB  21 212E     	LD	HL,U21F3
 2561 0DAE  22 03D7     	LD	(SVARPT),HL	; Programmende+1
 2562 0DB1  22 03D9     	LD	(DVARPT),HL
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  35
BAC85   Z80

 2563 0DB4  22 03DB     	LD	(FSLPTR),HL	; erste freie Adresse hinter den Variablen
 2564 0DB7  CD 0DE0     U0E38:	CALL	STAR_A		; Einlesen ASCII-File
 2565 0DBA  3A 0053     	LD	A,(U0043)
 2566 0DBD  B7          	OR	A		; fehlerfrei eingelesen?
 2567 0DBE  C0          	RET	NZ		; nein
 2568 0DBF  2A 0047     	LD	HL,(U0033)	; Ende ASCII-File
 2569 0DC2  36 1D       	LD	(HL),1DH	; RUN anhaengen
 2570 0DC4  23          	INC	HL
 2571 0DC5  22 0047     	LD	(U0033),HL	; Ende ASCII-File
 2572 0DC8  C3 0E76     	JP	STAR_T		; Uebersetzen ASCII-File nach BASIC
 2573                   ;
 2574                   ; CSAVE - Sonderbehandlung
 2575                   ;
 2576 0DCB  AF          CSAVE:	XOR	A		; kein Kopierschutz
 2577 0DCC  32 035D     	LD	(DATBYT),A
 2578 0DCF  CD DCB0     	CALL	CASS01		; *.SSS Name holen
 2579 0DD2  2A 03D7     	LD	HL,(SVARPT)	; Programmende+1
 2580 0DD5  11 212C     	LD	DE,Z1000	; Anfang BASIC-Programm
 2581 0DD8  B7          	OR	A
 2582 0DD9  ED 52       	SBC	HL,DE		; Laenge des BASICODE-Programms
 2583 0DDB  44          	LD	B,H
 2584 0DDC  4D          	LD	C,L
 2585                   ;	LD	DE,Z1000	; Anfang BASIC-Programm (doppelt gemoppelt ???)
 2586 0DDD  C3 DD57     	JP	CSAVE0		; BASIC-Programm abspeichern
 2587                   ;
 2588                   ; *A - Einlesen ASCII-File
 2589                   ;
 2590 0DE0  CD 1887     STAR_A:	CALL	U18EC		; BASICODE Bandeingabe vorbereiten
 2591 0DE3  CD 18D1     U0E67:	CALL	BCSYN		; Synchronisation mit Frequenzmessung
 2592 0DE6  3E FF       	LD	A,0FFH
 2593 0DE8  32 0053     	LD	(U0043),A
 2594 0DEB  2A 03D7     	LD	HL,(SVARPT)	; Programmende+1
 2595 0DEE  22 0045     	LD	(U0031),HL	; Beginn ASCII-File
 2596 0DF1  CD 1942     U0E75:	CALL	BCIN		; ein Byte lesen
 2597 0DF4  38 FB       	JR	C,U0E75		; Fehler, wiederholen
 2598 0DF6  C2 17B2     	JP	NZ,BCIOLD	; Taste gedrueckt -> ISR (Eingabe) zurueckstellen
 2599 0DF9  FE 02       	CP	2
 2600 0DFB  28 08       	JR	Z,U0E89		; Startbyte erkannt
 2601 0DFD  21 1BEA     	LD	HL,U1BFE	; Text 'kein BASICODE-Programm!'
 2602 0E00  CD 1A51     	CALL	U1AE5		; anzeigen
 2603 0E03  18 DE       	JR	U0E67
 2604                   	;
 2605 0E05  CD 1942     U0E89:	CALL	BCIN		; ein Byte lesen
 2606 0E08  38 18       	JR	C,U0EA6		; Fehler oder letztes Byte
 2607 0E0A  20 26       	JR	NZ,U0EB6	; Taste gedrueckt
 2608 0E0C  E5          	PUSH	HL
 2609 0E0D  ED 72       	SBC	HL,SP		; Stack erreicht?
 2610 0E0F  E1          	POP	HL
 2611 0E10  38 0C       	JR	C,U0EA2
 2612 0E12  CD 1A4E     	CALL	U0ECA		; 'Speichergrenze erreicht!'
 2613 0E15  21 FFF8     	LD	HL,-8
 2614 0E18  39          	ADD	HL,SP
 2615 0E19  2B          	DEC	HL
 2616 0E1A  36 0D       	LD	(HL),CR
 2617 0E1C  18 14       	JR	U0EB6
 2618                   	;
 2619 0E1E  77          U0EA2:	LD	(HL),A		; Byte eintragen
 2620 0E1F  23          	INC	HL		; naechste Adresse
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  36
BAC85   Z80

 2621 0E20  18 E3       	JR	U0E89		; und weiter
 2622                   	;
 2623 0E22  2B          U0EA6:	DEC	HL
 2624 0E23  AF          	XOR	A		; A=0, wenn OK
 2625 0E24  D9          	EXX
 2626 0E25  24          	INC	H		; Pruefsumme
 2627 0E26  25          	DEC	H		; richtig?
 2628 0E27  D9          	EXX
 2629 0E28  28 0A       	JR	Z,U0EB8		; ja
 2630 0E2A  E5          	PUSH	HL
 2631 0E2B  21 1B8D     	LD	HL,U1BA1	; Text 'Lesefehler erkannt!'
 2632 0E2E  CD 1A51     	CALL	U1AE5		; anzeigen
 2633 0E31  E1          	POP	HL
 2634 0E32  3E FF       U0EB6:	LD	A,0FFH
 2635 0E34  32 0053     U0EB8:	LD	(U0043),A	; FF=Lesefehler, 00=OK
 2636 0E37  22 0047     	LD	(U0033),HL	; Ende ASCII-File
 2637 0E3A  CD 17B2     	CALL	BCIOLD		; umgeleitete ISR (Eingabe) zurueckstellen
 2638 0E3D  3A 003B     	LD	A,(FLAGS)
 2639 0E40  F6 02       	OR	2		; Bit 1 setzen, ASCII-File im Speicher
 2640 0E42  32 003B     	LD	(FLAGS),A
 2641 0E45  C9          	RET
 2642                   ;
 2643                   ; *W - Retten ASCII-File
 2644                   ;
 2645 0E46  3A 003B     STAR_W:	LD	A,(FLAGS)
 2646 0E49  E6 02       	AND	2		; Bit 1?
 2647 0E4B  CA 1A45     	JP	Z,U1ADC		; kein ASCII-File im Speicher!
 2648 0E4E  CD 18B4     	CALL	U1919		; BASICODE Bandsusgabe vorbereiten
 2649 0E51  CD 191F     	CALL	VTON		; 5 Sekunden Vorton
 2650 0E54  26 00       	LD	H,0		; Startwert fuer Pruefsumme
 2651 0E56  D9          	EXX
 2652 0E57  3E 02       	LD	A,2		; Startbyte STX (Start of Text)
 2653 0E59  CD 19A0     	CALL	BCOUT		; ein Byte schreiben
 2654 0E5C  2A 0045     	LD	HL,(U0031)	; Beginn ASCII-File
 2655 0E5F  ED 5B 0047  	LD	DE,(U0033)	; Ende ASCII-File
 2656 0E63  7E          U0EED:	LD	A,(HL)		; Zeichen aus Speicher holen
 2657 0E64  23          	INC	HL
 2658 0E65  CD 19A0     	CALL	BCOUT		; ein Byte schreiben
 2659 0E68  CD 062E     	CALL	U0622		; Taste gedrueckt?
 2660 0E6B  C2 17A5     	JP	NZ,BCOOLD	; ja, umgeleitete ISR (Ausgabe) zurueckstellen
 2661 0E6E  CD C689     	CALL	CPREG		; ASCII-File fertig?
 2662 0E71  20 F0       	JR	NZ,U0EED	; nein, weiter
 2663 0E73  C3 1793     	JP	U18D0		; Ende-Byte, Pruefbyte und ISR rueckstellen
 2664                   ;
 2665                   ; *T - Uebersetzen ASCII-File ==> BASIC
 2666                   ;
 2667 0E76  CD 1A20     STAR_T:	CALL	U1AB5		; ASCII-File und BASIC-Programm im Speicher?
 2668 0E79  CB 4F       	BIT	1,A
 2669 0E7B  CA 1A45     	JP	Z,U1ADC		; kein ASCII-File im Speicher!
 2670 0E7E  3A 003B     	LD	A,(FLAGS)
 2671 0E81  F6 01       	OR	1		; Bit 0 setzen
 2672 0E83  E6 BF       	AND	0BFH		; Bit 6 ruecksetzen
 2673 0E85  32 003B     	LD	(FLAGS),A
 2674 0E88  2A 0045     	LD	HL,(U0031)	; Beginn ASCII-File
 2675 0E8B  22 0049     	LD	(CPOINT),HL	; Pufferzeiger
 2676 0E8E  CD 0917     	CALL	U09AE		; IRM-Adresse auf links/unten einstellen
 2677 0E91  CD F018     	CALL	IRMON
 2678 0E94  2A B7BE     	LD	HL,(UOUT1+1)	; Adresse der aktuellen Druckerausgabe
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  37
BAC85   Z80

 2679 0E97  22 0051     	LD	(U0041),HL	; hier merken
 2680 0E9A  21 0935     	LD	HL,U09DD	; Zeichen auf untere Zeile malen
 2681 0E9D  22 B7BE     	LD	(UOUT1+1),HL	; jetzt hier eintragen
 2682 0EA0  2A B7B9     	LD	HL,(OUTAB)	; Adresse Ausgabezeiger
 2683 0EA3  22 003C     	LD	(XPOS2),HL	; zwischenspeichern
 2684 0EA6  21 1249     	LD	HL,U12DF+1	; Zeiger auf 02=UOT1
 2685 0EA9  22 B7B9     	LD	(OUTAB),HL	; Ausgaberoutine umstellen, damit Anzeige auf
 2686 0EAC  C3 0772     	JP	IOFRET		; der unteren Bildschirmzeile erfolgt
 2687                   ;
 2688                   ; *C - Uebersetzen BASIC ==> ASCII
 2689                   ;
 2690 0EAF  CD 1A20     STAR_C:	CALL	U1AB5		; ASCII-File und BASIC-Programm im Speicher?
 2691 0EB2  CB 47       	BIT	0,A		; BASIC-Programm?
 2692 0EB4  20 06       	JR	NZ,U0F52	; vorhanden
 2693 0EB6  21 1C7C     	LD	HL,U1C90	; Text 'kein Programm im Speicher!'
 2694 0EB9  C3 1A51     	JP	U1AE5		; anzeigen
 2695                   	;
 2696 0EBC  21 212B     U0F52:	LD	HL,Z1000-1	; Anfang BASIC-Programm
 2697 0EBF  3A 003B     U0F55:	LD	A,(FLAGS)
 2698 0EC2  E6 3F       	AND	3FH		; Bit 6 und 7 (Fehler) ruecksetzen
 2699 0EC4  32 003B     	LD	(FLAGS),A
 2700 0EC7  23          	INC	HL
 2701 0EC8  7E          	LD	A,(HL)		; 2x 00 hintereinander
 2702 0EC9  23          	INC	HL		; kennzeichnet Programmende
 2703 0ECA  B6          	OR	(HL)
 2704 0ECB  CA 0F7C     	JP	Z,U1012		; fertig
 2705 0ECE  23          	INC	HL
 2706 0ECF  CD 061F     	CALL	U0613		; Taste gedrueckt?
 2707 0ED2  FE 03       	CP	3		; BRK?
 2708 0ED4  C8          	RET	Z		; Abbruch mit BRK
 2709 0ED5  5E          	LD	E,(HL)
 2710 0ED6  23          	INC	HL
 2711 0ED7  56          	LD	D,(HL)		; DE = Zeilennummer
 2712 0ED8  CD C8BD     U0F6E:	CALL	TCHAR		; naechstes gueltiges Zeichen holen
 2713 0EDB  B7          	OR	A
 2714 0EDC  28 7A       	JR	Z,U0FEE		; 0 = Zeilenende
 2715 0EDE  FE 22       	CP	'"'
 2716 0EE0  28 6D       	JR	Z,U0FE5		; Beginn einer Zeichenkette
 2717 0EE2  FE 8E       	CP	8EH		; REM?
 2718 0EE4  28 69       	JR	Z,U0FE5		; ja
 2719 0EE6  FE 80       	CP	80H
 2720 0EE8  38 EE       	JR	C,U0F6E		; kein Token
 2721 0EEA  E5          	PUSH	HL
 2722 0EEB  0E 80       	LD	C,80H		; Bit 7 setzen: Regelverstoss
 2723 0EED  FE 8B       	CP	8BH		; RESTORE?
 2724 0EEF  20 05       	JR	NZ,U0F8C
 2725 0EF1  CD C8BD     	CALL	TCHAR		; naechstes gueltiges Zeichen holen
 2726 0EF4  18 4D       	JR	U0FD9
 2727                   	;
 2728 0EF6  FE B1       U0F8C:	CP	0B1H		; AND?
 2729 0EF8  28 08       	JR	Z,U0F98
 2730 0EFA  FE B2       	CP	0B2H		; OR?
 2731 0EFC  28 04       	JR	Z,U0F98
 2732 0EFE  FE AA       	CP	0AAH		; NOT?
 2733 0F00  20 23       	JR	NZ,U0FBB
 2734                   	;
 2735                   ; logische Operationen mit AND, OR oder NOT erfordern Klammern,
 2736                   ; wenn Vergleichsoperatioren benutzt werden
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  38
BAC85   Z80

 2737 0F02  CD C8BD     U0F98:	CALL	TCHAR		; naechstes gueltiges Zeichen holen
 2738 0F05  FE 28       	CP	'('		; folgt eine Klammer?
 2739 0F07  28 07       	JR	Z,U0FA6
 2740 0F09  7E          U0F9F:	LD	A,(HL)
 2741 0F0A  23          	INC	HL
 2742 0F0B  CD 1061     	CALL	U10F7		; Test auf Verleichsoperatoren
 2743 0F0E  20 F9       	JR	NZ,U0F9F	; weitersuchen bis Zeilenende
 2744 0F10  E1          U0FA6:	POP	HL
 2745 0F11  E5          	PUSH	HL
 2746 0F12  2B          U0FA8:	DEC	HL
 2747 0F13  7E          	LD	A,(HL)
 2748 0F14  FE 20       	CP	' '
 2749 0F16  28 FA       	JR	Z,U0FA8		; Leerzeichen uebergehen
 2750 0F18  FE 29       	CP	')'
 2751 0F1A  28 27       	JR	Z,U0FD9		; Klammer zu gefunden, OK
 2752 0F1C  2B          U0FB2:	DEC	HL
 2753 0F1D  7E          	LD	A,(HL)
 2754 0F1E  CD 1065     	CALL	U10FB
 2755 0F21  20 F9       	JR	NZ,U0FB2
 2756 0F23  18 1E       	JR	U0FD9
 2757                   	;
 2758                   ; auf NEXT muss Variable folgen
 2759 0F25  FE 82       U0FBB:	CP	82H		; NEXT?
 2760 0F27  20 10       	JR	NZ,U0FCF
 2761 0F29  CD C8BD     	CALL	TCHAR		; naechstes gueltiges Zeichen holen
 2762 0F2C  FE 5B       	CP	'Z'+1
 2763 0F2E  30 06       	JR	NC,U0FCC	; auf NEXT folgt keine Variable
 2764 0F30  FE 41       	CP	'A'
 2765 0F32  38 02       	JR	C,U0FCC		; auf NEXT folgt keine Variable
 2766 0F34  3E 01       	LD	A,1
 2767 0F36  3D          U0FCC:	DEC	A		; Z=1, wenn Variable folgt
 2768 0F37  18 0A       	JR	U0FD9
 2769                   	;
 2770 0F39  21 1DFF     U0FCF:	LD	HL,U1E13	; Tabelle mit erlaubten Token
 2771 0F3C  01 002E     	LD	BC,U1E41-U1E13	; Anzahl
 2772 0F3F  ED B1       	CPIR
 2773 0F41  0E 40       	LD	C,40H		; Bit 6 setzen: unerlaubter Befehl
 2774 0F43  E1          U0FD9:	POP	HL
 2775 0F44  28 92       	JR	Z,U0F6E
 2776 0F46  3A 003B     	LD	A,(FLAGS)
 2777 0F49  B1          	OR	C		; Bit 6 oder 7 setzen
 2778 0F4A  32 003B     	LD	(FLAGS),A
 2779 0F4D  18 89       	JR	U0F6E
 2780                   	;
 2781                   ;Zeichenkette oder REM
 2782 0F4F  4F          U0FE5:	LD	C,A		; C = '"'
 2783 0F50  23          U0FE6:	INC	HL		; naechstes Zeichen
 2784 0F51  7E          	LD	A,(HL)		; holen
 2785 0F52  B9          	CP	C		; Ende der Zeichenkette?
 2786 0F53  28 83       	JR	Z,U0F6E		; ja, weiter testen
 2787 0F55  B7          	OR	A		; 0 = Zeilenende
 2788 0F56  20 F8       	JR	NZ,U0FE6	; ansonsten weiter nach dem Ende der Zeichenkette suchen
 2789                   	;
 2790                   ;Zeilenende
 2791 0F58  3A 003B     U0FEE:	LD	A,(FLAGS)
 2792 0F5B  CB 77       	BIT	6,A
 2793 0F5D  20 07       	JR	NZ,U0FFC	; -> unerlaubter Befehl
 2794 0F5F  CB 7F       	BIT	7,A
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  39
BAC85   Z80

 2795 0F61  20 08       	JR	NZ,U1001	; -> Regelverstoss
 2796 0F63  C3 0EBF     	JP	U0F55
 2797                   	;
 2798 0F66  21 1C19     U0FFC:	LD	HL,U1C2D	; Text 'unerlaubter BASICODE-Befehl!'
 2799 0F69  18 03       	JR	U1004
 2800                   	;
 2801 0F6B  21 1C36     U1001:	LD	HL,U1C4A	; Text 'Regelverstoss!'
 2802 0F6E  D5          U1004:	PUSH	DE
 2803 0F6F  CD 1A51     	CALL	U1AE5		; anzeigen
 2804 0F72  D1          	POP	DE
 2805 0F73  CD C4BB     	CALL	ZPOIT
 2806 0F76  D5          	PUSH	DE
 2807 0F77  23          	INC	HL
 2808 0F78  23          	INC	HL
 2809 0F79  C3 C401     	JP	EDITO2+3
 2810                   	;
 2811                   ; BASIC-Programm fertig geprueft, Beginn der Konvertierung BASIC -> ASCII
 2812 0F7C  E5          U1012:	PUSH	HL		; Ende BASIC-Programm
 2813 0F7D  11 212D     	LD	DE,Z1000+1	; Beginn BASIC-Programm
 2814 0F80  B7          	OR	A		; CY=0
 2815 0F81  ED 52       	SBC	HL,DE
 2816 0F83  4D          	LD	C,L
 2817 0F84  44          	LD	B,H		; BC = Laenge BASIC-Programm
 2818 0F85  21 FFD0     	LD	HL,-48		; 48 Byte fuer Stack frei halten
 2819 0F88  39          	ADD	HL,SP
 2820 0F89  EB          	EX	DE,HL		; DE = 48 Byte vor Stack
 2821 0F8A  E1          	POP	HL		; Ende BASIC-Programm
 2822 0F8B  ED B8       	LDDR			; BASIC-Programm hier hin verschieben
 2823 0F8D  ED 43 212C  	LD	(Z1000),BC	; kein BASIC-Programm mehr im Speicher
 2824 0F91  EB          	EX	DE,HL		; HL = Beginn des verschobenen BASIC-Programms
 2825 0F92  01 212E     	LD	BC,U21F3	; Hier ASCII-File ablegen
 2826 0F95  ED 43 03D7  	LD	(SVARPT),BC	; Programmende+1
 2827 0F99  3E 0D       	LD	A,CR
 2828 0F9B  CD 19FE     	CALL	U1A8A		; Zeichen im ASCII-File ablegen und malen
 2829 0F9E  23          U1034:	INC	HL
 2830 0F9F  5E          	LD	E,(HL)
 2831 0FA0  23          	INC	HL
 2832 0FA1  56          	LD	D,(HL)
 2833 0FA2  ED 53 0051  	LD	(U0041),DE	; Zeilennummer ablegen
 2834 0FA6  AF          	XOR	A		; Zaehler fuer Zeilenlaenge
 2835 0FA7  08          	EX	AF,AF'
 2836 0FA8  E5          	PUSH	HL		; Zeiger auf BASIC-Programm
 2837 0FA9  C5          	PUSH	BC		; Zeiger auf ASCII-File
 2838 0FAA  AF          	XOR	A
 2839 0FAB  06 98       	LD	B,98H
 2840 0FAD  CD D6AE     	CALL	SGN1		; Zeilennummer
 2841 0FB0  CD D834     	CALL	NUMKON		; konvertieren
 2842 0FB3  C1          	POP	BC
 2843 0FB4  CD C8BD     U104A:	CALL	TCHAR		; naechstes gueltiges Zeichen holen
 2844 0FB7  B7          	OR	A
 2845 0FB8  28 05       	JR	Z,U1055
 2846 0FBA  CD 19FE     	CALL	U1A8A		; Zeichen im ASCII-File ablegen und malen
 2847 0FBD  18 F5       	JR	U104A
 2848                   	;
 2849 0FBF  E1          U1055:	POP	HL
 2850 0FC0  3A 003B     	LD	A,(FLAGS)
 2851 0FC3  F6 40       	OR	40H		; Bit 6 setzen (unerlaubter Befehl)
 2852 0FC5  32 003B     	LD	(FLAGS),A
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  40
BAC85   Z80

 2853 0FC8  59          U105E:	LD	E,C
 2854 0FC9  50          	LD	D,B
 2855 0FCA  CD C689     	CALL	CPREG		; Vergleiche Register DE mit HL
 2856 0FCD  DA 1A4E     	JP	C,U0ECA		; 'Speichergrenze erreicht!'
 2857 0FD0  CD C8BD     	CALL	TCHAR		; naechstes gueltiges Zeichen holen
 2858 0FD3  B7          	OR	A
 2859 0FD4  28 51       	JR	Z,U10BD
 2860 0FD6  FE 22       	CP	'"'
 2861 0FD8  28 3C       	JR	Z,U10AC		; Zeichenkette
 2862 0FDA  FE 80       	CP	80H
 2863 0FDC  30 05       	JR	NC,U1079	; Token
 2864 0FDE  CD 19FE     	CALL	U1A8A		; Zeichen im ASCII-File ablegen und malen
 2865 0FE1  18 E5       	JR	U105E
 2866                   	;
 2867                   ; Token decodieren
 2868 0FE3  FE BF       U1079:	CP	0BFH		; LN?
 2869 0FE5  11 1CF7     	LD	DE,U1D0B	; Umwandeln in LOG
 2870 0FE8  28 1F       	JR	Z,U109F
 2871 0FEA  F5          	PUSH	AF
 2872 0FEB  E5          	PUSH	HL
 2873 0FEC  C5          	PUSH	BC
 2874 0FED  21 1E28     	LD	HL,U1E3C	; GOSUB, GOTO, STEP, THEN, TO
 2875 0FF0  01 0005     	LD	BC,5		; 5 Token testen
 2876 0FF3  ED B1       	CPIR
 2877 0FF5  20 0A       	JR	NZ,U1097	; keiner der 5 Token
 2878 0FF7  F5          	PUSH	AF
 2879 0FF8  3A 003B     	LD	A,(FLAGS)
 2880 0FFB  F6 40       	OR	40H		; Bit 6 setzen (unerlaubter Befehl)
 2881 0FFD  32 003B     	LD	(FLAGS),A
 2882 1000  F1          	POP	AF
 2883 1001  CD C79A     U1097:	CALL	LIST11		; Token aufloesen
 2884 1004  C1          	POP	BC
 2885 1005  E1          	POP	HL
 2886 1006  CD 19FE     U109C:	CALL	U1A8A		; Zeichen im ASCII-File ablegen und malen
 2887 1009  1A          U109F:	LD	A,(DE)
 2888 100A  13          	INC	DE
 2889 100B  B7          	OR	A
 2890 100C  F2 1006     	JP	P,U109C
 2891 100F  F1          	POP	AF
 2892 1010  FE 8E       	CP	8EH	; REM?
 2893 1012  20 B4       	JR	NZ,U105E	; weiter im Text
 2894 1014  18 03       	JR	U10AF		; den Rest nach REM einfach kopieren
 2895                   	;
 2896 1016  CD 19FE     U10AC:	CALL	U1A8A		; Zeichen im ASCII-File ablegen und malen
 2897 1019  5F          U10AF:	LD	E,A
 2898 101A  23          U10B0:	INC	HL
 2899 101B  7E          	LD	A,(HL)
 2900 101C  B7          	OR	A
 2901 101D  28 08       	JR	Z,U10BD		; Zeilenende
 2902 101F  CD 19FE     	CALL	U1A8A		; Zeichen im ASCII-File ablegen und malen
 2903 1022  BB          	CP	E
 2904 1023  20 F5       	JR	NZ,U10B0
 2905 1025  18 A1       	JR	U105E
 2906                   	;
 2907 1027  08          U10BD:	EX	AF,AF'
 2908 1028  FE 3D       	CP	61		; Zeile darf max. 60 Zeichen lang sein
 2909 102A  38 16       	JR	C,U10D8		; OK
 2910 102C  C5          	PUSH	BC
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  41
BAC85   Z80

 2911 102D  E5          	PUSH	HL
 2912 102E  21 1CDE     	LD	HL,U1CF2	; Zeile
 2913 1031  CD C5F1     	CALL	TEXTOE
 2914 1034  2A 0051     	LD	HL,(U0041)	; Zeilennummer
 2915 1037  CD D829     	CALL	NUMBO
 2916 103A  21 1CE5     	LD	HL,U1CF9	; ist zu lang.
 2917 103D  CD C5F1     	CALL	TEXTOE
 2918 1040  E1          	POP	HL
 2919 1041  C1          	POP	BC
 2920 1042  3E 0D       U10D8:	LD	A,CR
 2921 1044  CD 19FE     	CALL	U1A8A		; Zeichen im ASCII-File ablegen und malen
 2922 1047  23          	INC	HL
 2923 1048  7E          	LD	A,(HL)
 2924 1049  23          	INC	HL
 2925 104A  B6          	OR	(HL)		; Programmende?
 2926 104B  C2 0F9E     	JP	NZ,U1034	; weiter konvertieren
 2927 104E  ED 43 0047  	LD	(U0033),BC	; Ende ASCII-File
 2928 1052  2A 03D7     	LD	HL,(SVARPT)	; Programmende+1
 2929 1055  22 0045     	LD	(U0031),HL	; Beginn ASCII-File
 2930 1058  3A 003B     	LD	A,(FLAGS)
 2931 105B  F6 02       	OR	2		; Bit 1 setzen: ASCII-File im Speicher
 2932 105D  32 003B     	LD	(FLAGS),A
 2933 1060  C9          	RET
 2934                   ;
 2935                   ; Setze Regelverstoss, wenn Vergleichsoperatoren ohne Klammer benutzt wurden
 2936                   ;
 2937 1061  FE B4       U10F7:	CP	0B4H	; =
 2938 1063  28 0F       	JR	Z,U110A
 2939 1065  FE 3A       U10FB:	CP	':'
 2940 1067  C8          	RET	Z		; Z=1, neuer Befehl
 2941 1068  B7          	OR	A
 2942 1069  C8          	RET	Z		; Z=1, Zeilenende
 2943 106A  FE 80       	CP	80H
 2944 106C  D8          	RET	C		; C=1, ASCII-Zeichen (kein Token)
 2945 106D  FE B3       	CP	0B3H	; >
 2946 106F  28 03       	JR	Z,U110A
 2947 1071  FE B5       	CP	0B5H	; <
 2948 1073  C0          	RET	NZ
 2949 1074  3A 003B     U110A:	LD	A,(FLAGS)
 2950 1077  B1          	OR	C		; Regelverstoss setzen (Klammer fehlt)
 2951 1078  32 003B     	LD	(FLAGS),A
 2952 107B  AF          	XOR	A		; Z=1
 2953 107C  C9          	RET
 2954                   ;
 2955                   ; *K - Listen ASCII-File
 2956                   ;
 2957 107D  3A 003B     STAR_K:	LD	A,(FLAGS)
 2958 1080  E6 02       	AND	2		; Bit 1 gesetzt?
 2959 1082  CA 1A45     	JP	Z,U1ADC		; kein ASCII-File im Speicher!
 2960 1085  CD C791     	CALL	LCREG
 2961 1088  2A 0045     	LD	HL,(U0031)	; Beginn ASCII-File
 2962 108B  ED 5B 0047  	LD	DE,(U0033)	; Ende ASCII-File
 2963 108F  7E          U1125:	LD	A,(HL)
 2964 1090  23          	INC	HL
 2965 1091  FE 0D       	CP	CR
 2966 1093  28 0F       	JR	Z,U113A		; neue Zeile
 2967 1095  FE 20       	CP	20H
 2968 1097  30 02       	JR	NC,U1131
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  42
BAC85   Z80

 2969 1099  3E 23       	LD	A,'#'		; statt Steuerzeichen ein '#' anzeigen
 2970 109B  CD DDD5     U1131:	CALL	CO		; Zeichen anzeigen
 2971 109E  CD C689     U1134:	CALL	CPREG		; Vergleiche Register DE mit HL
 2972 10A1  20 EC       	JR	NZ,U1125	; weiter bis zum Ende ASCII-File
 2973 10A3  C9          	RET
 2974                   	;
 2975 10A4  E5          U113A:	PUSH	HL
 2976 10A5  CD CB61     	CALL	CRWDY2		; Anzeige CR, LF, Dummyzeichen
 2977 10A8  CD C767     	CALL	LIST9		; Stop nach vorgegebener Zeilenanzahl
 2978 10AB  E1          	POP	HL
 2979 10AC  CD 061F     	CALL	U0613		; Taste gedrueckt?
 2980 10AF  FE 03       	CP	3
 2981 10B1  20 EB       	JR	NZ,U1134	; weiter anzeigen
 2982 10B3  C9          	RET
 2983                   ;
 2984                   ; GOTO 20	Programmstart, System-Reset, Loeschen aller Variablen
 2985                   ; PE:	A	Groesse des Stringraums in Byte (256 Byte werden mindestens benutzt)
 2986                   ;	CC(0)	Vordergrundfarbe
 2987                   ;	CC(1)	Hintergrundfarbe
 2988                   ; PA:	HO=39	Anzahl Textspalten-1
 2989                   ;	VE=31	Anzahl Textzeilen-1
 2990                   ;	HG=320	Bildschirmbreite in Pixeln
 2991                   ;	VG=240	Bildschirmhoehe in Piceln
 2992                   ;	CN=0	Voreinstellung = zeichnen (nicht loeschen	
 2993                   ;	IN=0
 2994                   ;	IN$=""
 2995                   ;	SR$=""
 2996                   ;
 2997 10B4  CD 1EB6     GO20:	CALL	U1ECA		; Farbe nach Variable CC einstellen
 2998 10B7  E1          	POP	HL
 2999 10B8  D1          	POP	DE
 3000 10B9  C1          	POP	BC
 3001 10BA  F1          	POP	AF
 3002 10BB  08          	EX	AF,AF'
 3003 10BC  D9          	EXX
 3004 10BD  3A 003B     	LD	A,(FLAGS)
 3005 10C0  E6 F4       	AND	0F4H		; Bit 0, 1 und 3 ruecksetzen
 3006 10C2  32 003B     	LD	(FLAGS),A
 3007                   ; 02.01.2024: hier Loeschen des Bildschirms erforderlich? - ja.
 3008 10C5  CD 05DC     	CALL	CLS		; Bildschirm loeschen
 3009 10C8  AF          	XOR	A
 3010 10C9  CD C8DF     	CALL	RESTO
 3011 10CC  01 4100     	LD	BC,4100H	; A
 3012 10CF  CD 15E7     	CALL	U167B		; Wert der Variable A nach HL holen
 3013 10D2  11 0100     	LD	DE,256		; Mindestgroesse
 3014 10D5  CD C689     	CALL	CPREG		; Vergleiche Register DE mit HL
 3015 10D8  38 01       	JR	C,U116E		; Mindestgroesse 256 benutzen
 3016 10DA  EB          	EX	DE,HL		; Wert der Variablen A benutzen
 3017 10DB  AF          U116E:	XOR	A		; Z=1
 3018 10DC  CD C9B2     	CALL	CLEAR+8		; Variablen loeschen
 3019 10DF  21 1E2D     	LD	HL,U1E41	; vordefinierte Variablen
 3020 10E2  ED 5B 03D7  	LD	DE,(SVARPT)	; Programmende+1
 3021 10E6  01 0030     	LD	BC,U1E71-U1E41
 3022 10E9  ED B0       	LDIR			; Variablen mit Startwerten belegen
 3023 10EB  EB          	EX	DE,HL		; HL=Ende der belegten Variablen
 3024 10EC  22 03D9     	LD	(DVARPT),HL
 3025 10EF  22 03DB     	LD	(FSLPTR),HL	; erste freie Adresse hinter den Variablen
 3026 10F2  CD 05C4     	CALL	U05C5		; Fenster auf volle Groesse stellen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  43
BAC85   Z80

 3027 10F5  D9          	EXX
 3028 10F6  08          	EX	AF,AF'
 3029 10F7  F5          	PUSH	AF
 3030 10F8  C5          	PUSH	BC
 3031 10F9  D5          	PUSH	DE
 3032 10FA  E9          	JP	(HL)
 3033                   ;
 3034                   ; GOSUB 110	Setzen des Cursors an eine bestimmte Position
 3035                   ;		Uebergabe der Position in den Variablen HO und VE
 3036                   ;
 3037 10FB  CD 1EB6     GO110:	CALL	U1ECA		; Farbe nach Variable CC einstellen
 3038 10FE  01 5645     	LD	BC,'VE'
 3039 1101  CD 15E7     	CALL	U167B		; Wert der Variable VE nach HL holen
 3040 1104  7D          	LD	A,L
 3041 1105  FE 20       	CP	32		; ausserhalb?
 3042 1107  38 07       	JR	C,U11A3		; nein
 3043 1109  CB 7F       	BIT	7,A
 3044 110B  3E 1F       	LD	A,31		; Position ganz unten
 3045 110D  28 01       	JR	Z,U11A3
 3046 110F  AF          	XOR	A		; Position ganz oben
 3047 1110  F5          U11A3:	PUSH	AF
 3048 1111  01 484F     	LD	BC,'HO'
 3049 1114  CD 15E7     	CALL	U167B		; Wert der Variable HO nach HL holen
 3050 1117  7D          	LD	A,L
 3051 1118  FE 28       	CP	40		; ausserhalb?
 3052 111A  38 07       	JR	C,U11B6		; nein
 3053 111C  CB 7F       	BIT	7,A
 3054 111E  3E 27       	LD	A,39		; Position ganz rechts
 3055 1120  28 01       	JR	Z,U11B6
 3056 1122  AF          	XOR	A		; Position ganz links
 3057 1123  6F          U11B6:	LD	L,A
 3058 1124  F1          	POP	AF
 3059 1125  67          	LD	H,A
 3060                   ;	JP	U05E1		; Cursor auf HL setzen
 3061                   ;
 3062                   ; Cursor auf HL setzen
 3063                   ;	
 3064 1126  C5          U05E1:	PUSH	BC
 3065 1127  CD F018     	CALL	IRMON		; veraendert BC-Register
 3066 112A  22 B7A0     	LD	(CURSO),HL
 3067 112D  18 07       	JR	U05F1
 3068                   ;
 3069                   ; aktuelle Cursorposition nach HL
 3070                   ;	
 3071 112F  C5          U05EA:	PUSH	BC
 3072 1130  CD F018     	CALL	IRMON		; veraendert BC-Register
 3073 1133  2A B7A0     	LD	HL,(CURSO)
 3074 1136  CD F01B     U05F1:	CALL	IRMOFF
 3075 1139  C1          	POP	BC		; veraendert BC-Register
 3076 113A  C9          	RET
 3077                   ;
 3078                   ; GOSUB 120	Ermittlung der Position des Cursors
 3079                   ;		Rueckgabe der Position in den Variablen HO und VE
 3080                   ;
 3081 113B  CD 112F     GO120:	CALL	U05EA		; Cursorposition nach HL
 3082 113E  E5          	PUSH	HL
 3083 113F  01 484F     	LD	BC,'HO'
 3084 1142  CD CF48     	CALL	DIM7		; Adresse der Variable HO nach DE holen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  44
BAC85   Z80

 3085 1145  E1          	POP	HL
 3086 1146  E5          	PUSH	HL
 3087 1147  7D          	LD	A,L		; A=Spalte
 3088 1148  CD 1152     	CALL	U11D3		; Wert in Variable eintragen
 3089 114B  01 5645     	LD	BC,'VE'
 3090 114E  CD CF48     	CALL	DIM7		; Adresse der Variable VE nach DE holen
 3091 1151  F1          	POP	AF		; A=Zeile
 3092 1152  6F          U11D3:	LD	L,A
 3093 1153  26 00       	LD	H,0		; HL=Wert
 3094 1155  C3 1673     	JP	U1671		; in Variable eintragen
 3095                   ;
 3096                   ; GOSUB 200	Auslesen eines Tastendrucks
 3097                   ;		Rueckgabe des Zeichens in der Variablen IN$
 3098                   ;		Rueckgabe einer leeren Variable IN$, wenn keine Taste gedrueckt wurde
 3099                   ;
 3100 1158  CD 061F     GO200:	CALL	U0613		; Taste gedrueckt?
 3101 115B  18 03       	JR	U11E7
 3102                   ;
 3103                   ; GOSUB 210	Warten auf einen Tastendruck
 3104                   ;		Rueckgabe des Zeichens in der Variablen IN$
 3105                   ;
 3106 115D  CD 0638     GO210:	CALL	U062C		; Eingabe ein Zeichen
 3107 1160  FE 03       U11E7:	CP	3
 3108 1162  20 05       	JR	NZ,U11F0
 3109 1164  E1          	POP	HL
 3110 1165  E1          	POP	HL
 3111 1166  C3 C918     	JP	STOP
 3112                   	;
 3113 1169  B7          U11F0:	OR	A
 3114 116A  F5          	PUSH	AF
 3115 116B  01 49CE     	LD	BC,'IN'+80H	; IN$
 3116 116E  CD CF48     	CALL	DIM7		; Adresse der Variable IN$ nach DE holen
 3117 1171  EB          	EX	DE,HL
 3118 1172  36 00       	LD	(HL),0
 3119 1174  F1          	POP	AF
 3120 1175  5F          	LD	E,A
 3121 1176  28 40       	JR	Z,U123F
 3122 1178  FE 01       	CP	1
 3123 117A  20 17       	JR	NZ,U121A
 3124 117C  1E 7F       	LD	E,7FH
 3125 117E  E5          	PUSH	HL
 3126 117F  CD 112F     	CALL	U05EA		; Cursorposition nach HL
 3127 1182  2C          	INC	L
 3128 1183  2D          	DEC	L
 3129 1184  E1          	POP	HL
 3130 1185  28 31       	JR	Z,U123F
 3131 1187  36 03       	LD	(HL),3
 3132 1189  23          	INC	HL
 3133 118A  23          	INC	HL
 3134 118B  01 1CF4     	LD	BC,U1D08
 3135 118E  71          	LD	(HL),C
 3136 118F  23          	INC	HL
 3137 1190  70          	LD	(HL),B
 3138 1191  18 25       	JR	U123F
 3139                   	;
 3140 1193  3E 01       U121A:	LD	A,1
 3141 1195  77          	LD	(HL),A
 3142 1196  23          	INC	HL
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  45
BAC85   Z80

 3143 1197  23          	INC	HL
 3144 1198  D5          	PUSH	DE
 3145 1199  E5          	PUSH	HL
 3146 119A  CD D1E1     	CALL	STROP
 3147 119D  E1          	POP	HL
 3148 119E  73          	LD	(HL),E
 3149 119F  23          	INC	HL
 3150 11A0  72          	LD	(HL),D
 3151 11A1  EB          	EX	DE,HL
 3152 11A2  D1          	POP	DE
 3153 11A3  73          	LD	(HL),E
 3154 11A4  7B          	LD	A,E
 3155 11A5  FE 08       	CP	8
 3156 11A7  38 08       	JR	C,U1238
 3157 11A9  FE 0C       	CP	0CH
 3158 11AB  30 04       	JR	NC,U1238
 3159 11AD  C6 14       	ADD	14H
 3160 11AF  18 06       	JR	U123E
 3161                   	;
 3162 11B1  FE 60       U1238:	CP	60H		; Kleinbuchstabe?
 3163 11B3  38 03       	JR	C,U123F		; nein
 3164 11B5  D6 20       	SUB	20H		; in Grossbuchstabe wandeln
 3165 11B7  5F          U123E:	LD	E,A
 3166 11B8  16 00       U123F:	LD	D,0
 3167 11BA  D5          	PUSH	DE
 3168 11BB  01 494E     	LD	BC,'IN'
 3169 11BE  CD CF48     	CALL	DIM7		; Adresse der Variable IN nach DE holen
 3170 11C1  E1          	POP	HL
 3171 11C2  C3 1673     	JP	U1671		; in Variable 'IN' eintragen
 3172                   ;
 3173                   ; Cursorposition ausserhalb bei GOSUB 220
 3174                   ;
 3175 11C5  AF          U124C:	XOR	A
 3176 11C6  18 EF       	JR	U123E
 3177                   ;
 3178                   ; GOSUB 220	Auslesen eines Zeichens vom Bildschirm
 3179                   ;		Uebergeben der Bildschirmposition in den Variablen HO und VE
 3180                   ;		Rueckgeben des Zeichens als numerischer Wert in der Variablen IN
 3181                   ;
 3182 11C8  01 5645     GO220:	LD	BC,'VE'
 3183 11CB  CD 15E7     	CALL	U167B		; Wert der Variable VE nach HL holen
 3184 11CE  7D          	LD	A,L
 3185 11CF  FE 20       	CP	20H
 3186 11D1  30 F2       	JR	NC,U124C	; VE ausserhalb!
 3187 11D3  F5          	PUSH	AF
 3188 11D4  01 484F     	LD	BC,'HO'
 3189 11D7  CD 15E7     	CALL	U167B		; Wert der Variable HO nach HL holen
 3190 11DA  7D          	LD	A,L
 3191 11DB  FE 28       	CP	40
 3192 11DD  E1          	POP	HL		; H=Zeile
 3193 11DE  30 E5       	JR	NC,U124C	; HO ausserhalb!
 3194 11E0  6F          	LD	L,A		; L=Spalte
 3195 11E1  CD 0668     	CALL	U0654		; Zeichen aus VRAM nach Register A lesen
 3196 11E4  5F          	LD	E,A
 3197 11E5  FE C9       	CP	0C9H		; C9 im VRAM ???
 3198 11E7  20 C8       	JR	NZ,U1238	; nein, upcase
 3199 11E9  18 CC       	JR	U123E		; in Variable IN uebergeben
 3200                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  46
BAC85   Z80

 3201                   ; GOSUB 260	Ermittlung einer Zufallszahl zwischen 0 und 1
 3202                   ;		Rueckgabe der Zahl in der Variablen RV
 3203                   ;
 3204 11EB  AF          GO260:	XOR	A
 3205 11EC  3C          	INC	A
 3206 11ED  CD DA06     	CALL	RND+9
 3207 11F0  3A 03E6     	LD	A,(WRA1+1)
 3208 11F3  5F          	LD	E,A
 3209 11F4  ED 5F       	LD	A,R
 3210 11F6  83          	ADD	E
 3211 11F7  32 03E6     	LD	(WRA1+1),A
 3212 11FA  01 5256     	LD	BC,'RV'
 3213 11FD  CD CF48     U1286:	CALL	DIM7		; Adresse der Variable nach DE holen
 3214 1200  EB          	EX	DE,HL
 3215 1201  C3 D6F7     	JP	OPTRAN
 3216                   ;
 3217                   ; GOSUB 270	 Ermittlung der Groesse des freien Speichers
 3218                   ;		 Rueckgabe des Wertes in der Variablen FR
 3219                   ;
 3220 1204  AF          GO270:	XOR	A
 3221 1205  32 03AE     	LD	(DATYPE),A
 3222 1208  CD D090     	CALL	FRE
 3223 120B  CD 1226     	CALL	U12AF
 3224 120E  CD D6C8     	CALL	OPARST
 3225 1211  3E 01       	LD	A,1
 3226 1213  32 03AE     	LD	(DATYPE),A
 3227 1216  CD D090     	CALL	FRE
 3228 1219  CD 1226     	CALL	U12AF
 3229 121C  C1          	POP	BC
 3230 121D  D1          	POP	DE
 3231 121E  CD D46F     	CALL	ADD5
 3232 1221  01 4652     	LD	BC,'FR'
 3233 1224  18 D7       	JR	U1286
 3234                   ;
 3235 1226  CD D697     U12AF:	CALL	TSGNM
 3236 1229  F0          	RET	P
 3237 122A  01 9100     	LD	BC,9100H	; 65536
 3238 122D  11 0000     	LD	DE,0
 3239 1230  C3 D46F     	JP	ADD5
 3240                   ;
 3241                   ; GOSUB 300	Umwandlung eines numerischen Wertes in einen String
 3242                   ;		Uebergabe des numerischen Wertes in der Variablen SR
 3243                   ;		Rueckgabe des Strings in der Variablen SR$
 3244                   ;
 3245 1233  01 5352     GO300:	LD	BC,'SR'
 3246 1236  CD CF48     	CALL	DIM7		; Adresse der Variable SR nach DE holen
 3247 1239  EB          	EX	DE,HL
 3248 123A  CD D6DD     	CALL	OPKOP		; Wert in Arithmetikregister 1 laden
 3249 123D  CD D834     	CALL	NUMKON
 3250 1240  23          	INC	HL
 3251 1241  E5          	PUSH	HL
 3252 1242  AF          	XOR	A
 3253 1243  4F          	LD	C,A
 3254 1244  ED B1       	CPIR
 3255 1246  79          	LD	A,C
 3256 1247  2F          	CPL
 3257 1248  C6 02       U12DF:	ADD	2		; wird auch als Zeiger auf UOT1=2 genutzt!
 3258 124A  CD D1E1     	CALL	STROP
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  47
BAC85   Z80

 3259 124D  D6 02       	SUB	2
 3260 124F  13          	INC	DE
 3261 1250  13          	INC	DE
 3262 1251  4F          	LD	C,A
 3263 1252  06 00       	LD	B,0
 3264 1254  E1          	POP	HL
 3265 1255  E5          	PUSH	HL
 3266 1256  D5          	PUSH	DE
 3267 1257  ED B0       	LDIR
 3268 1259  E1          	POP	HL
 3269 125A  D1          	POP	DE
 3270 125B  4F          	LD	C,A
 3271 125C  1A          	LD	A,(DE)
 3272 125D  1B          	DEC	DE
 3273 125E  FE 2E       	CP	2EH
 3274 1260  20 04       	JR	NZ,U12FD
 3275 1262  0C          	INC	C
 3276 1263  2B          	DEC	HL
 3277 1264  36 30       	LD	(HL),30H
 3278 1266  1A          U12FD:	LD	A,(DE)
 3279 1267  FE 2D       	CP	2DH
 3280 1269  20 03       	JR	NZ,U1305
 3281 126B  0C          	INC	C
 3282 126C  2B          	DEC	HL
 3283 126D  77          	LD	(HL),A
 3284 126E  C5          U1305:	PUSH	BC
 3285 126F  E5          	PUSH	HL
 3286 1270  01 53D2     	LD	BC,'SR'+80H	; SR$
 3287 1273  CD CF48     	CALL	DIM7		; Adresse der Variable SR$ nach DE holen
 3288 1276  E1          	POP	HL
 3289 1277  C1          	POP	BC
 3290 1278  EB          	EX	DE,HL
 3291 1279  71          	LD	(HL),C
 3292 127A  23          	INC	HL
 3293 127B  23          	INC	HL
 3294 127C  73          	LD	(HL),E
 3295 127D  23          	INC	HL
 3296 127E  72          	LD	(HL),D
 3297 127F  C9          	RET
 3298                   ;
 3299                   ; GOSUB 310	Umwandlung eines numerischen Wertes in einen String
 3300                   ;		Uebergabe des numerischen Wertes in der Variablen SR
 3301                   ;		Uebergabe einer festen Stringldnge in der Variablen CT
 3302                   ;		Uebergabe der Position des Dezimalpunkts in der Variablen CN
 3303                   ;		Rueckgabe des Strings in der Variablen SR$
 3304                   ;
 3305 1280  CD 15B1     GO310:	CALL	GETCN		; CN holen
 3306 1283  01 4354     	LD	BC,'CT'
 3307 1286  CD 15E7     	CALL	U167B		; Wert der Variable CT nach HL holen
 3308 1289  7D          	LD	A,L
 3309 128A  65          	LD	H,L
 3310 128B  22 003C     	LD	(XPOS2),HL
 3311 128E  F5          	PUSH	AF
 3312 128F  CD D1E1     	CALL	STROP
 3313 1292  D5          	PUSH	DE
 3314 1293  01 53D2     	LD	BC,'SR'+80H	; SR$
 3315 1296  CD CF48     	CALL	DIM7		; Adresse der Variable SR$ nach DE holen
 3316 1299  E1          	POP	HL
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  48
BAC85   Z80

 3317 129A  22 0051     	LD	(U0041),HL
 3318 129D  EB          	EX	DE,HL
 3319 129E  F1          	POP	AF
 3320 129F  77          	LD	(HL),A
 3321 12A0  23          	INC	HL
 3322 12A1  23          	INC	HL
 3323 12A2  73          	LD	(HL),E
 3324 12A3  23          	INC	HL
 3325 12A4  72          	LD	(HL),D
 3326 12A5  D5          	PUSH	DE
 3327 12A6  01 5352     	LD	BC,'SR'
 3328 12A9  CD CF48     	CALL	DIM7		; Adresse der Variable SR nach DE holen
 3329 12AC  EB          	EX	DE,HL
 3330 12AD  E5          	PUSH	HL
 3331 12AE  CD D6DD     	CALL	OPKOP		; Wert in Arithmetikregister 1 laden
 3332 12B1  CD D697     	CALL	TSGNM
 3333 12B4  E1          	POP	HL
 3334 12B5  E3          	EX	(SP),HL
 3335 12B6  3A 003C     	LD	A,(XPOS2)
 3336 12B9  30 09       	JR	NC,U135B
 3337 12BB  36 2D       	LD	(HL),2DH
 3338 12BD  23          	INC	HL
 3339 12BE  D6 02       	SUB	2
 3340 12C0  DA 1369     	JP	C,U1400
 3341 12C3  3C          	INC	A
 3342 12C4  47          U135B:	LD	B,A
 3343 12C5  3A 0044     	LD	A,(CN)		; CN
 3344 12C8  4F          	LD	C,A
 3345 12C9  B7          	OR	A
 3346 12CA  28 01       	JR	Z,U1364
 3347 12CC  0C          	INC	C
 3348 12CD  0C          U1364:	INC	C
 3349 12CE  78          	LD	A,B
 3350 12CF  91          	SUB	C
 3351 12D0  DA 1369     	JP	C,U1400
 3352 12D3  3C          	INC	A
 3353 12D4  32 003C     	LD	(XPOS2),A
 3354 12D7  E3          	EX	(SP),HL
 3355 12D8  F5          	PUSH	AF
 3356 12D9  E5          	PUSH	HL
 3357 12DA  CD 137B     	CALL	U1412
 3358 12DD  E1          	POP	HL
 3359 12DE  CD D6EE     	CALL	OPLAD
 3360 12E1  CD D5F5     	CALL	DIV1
 3361 12E4  CD D6BC     	CALL	ABS
 3362 12E7  3E 20       	LD	A,20H
 3363 12E9  B7          	OR	A
 3364 12EA  08          	EX	AF,AF'
 3365 12EB  3A 0044     	LD	A,(CN)		; CN
 3366 12EE  4F          	LD	C,A
 3367 12EF  F1          	POP	AF
 3368 12F0  81          	ADD	C
 3369 12F1  4F          	LD	C,A
 3370 12F2  06 00       	LD	B,0
 3371 12F4  C5          	PUSH	BC
 3372 12F5  CD D6C8     	CALL	OPARST
 3373 12F8  CD 137B     	CALL	U1412
 3374 12FB  01 8000     	LD	BC,8000H	; 0.5
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  49
BAC85   Z80

 3375 12FE  11 0000     	LD	DE,0
 3376 1301  CD D5F5     	CALL	DIV1
 3377 1304  C1          	POP	BC
 3378 1305  D1          	POP	DE
 3379 1306  CD D46F     	CALL	ADD5
 3380 1309  C1          	POP	BC
 3381 130A  E1          	POP	HL
 3382 130B  3A 03E8     	LD	A,(WRA1+3)
 3383 130E  FE 81       	CP	81H
 3384 1310  30 58       	JR	NC,U1401
 3385 1312  C5          U13A9:	PUSH	BC
 3386 1313  3A 003C     	LD	A,(XPOS2)
 3387 1316  B8          	CP	B
 3388 1317  20 03       	JR	NZ,U13B3
 3389 1319  36 2E       	LD	(HL),'.'
 3390 131B  23          	INC	HL
 3391 131C  3D          U13B3:	DEC	A
 3392 131D  B8          	CP	B
 3393 131E  20 04       	JR	NZ,U13BB
 3394 1320  08          	EX	AF,AF'
 3395 1321  3E 30       	LD	A,'0'
 3396 1323  08          	EX	AF,AF'
 3397 1324  E5          U13BB:	PUSH	HL
 3398 1325  01 8420     	LD	BC,8420H	; 10
 3399 1328  11 0000     	LD	DE,0
 3400 132B  CD D59A     	CALL	MUL1
 3401 132E  CD D6C8     	CALL	OPARST
 3402 1331  CD C96F     	CALL	EPRVL3		; Ausdruck berechnen -> DE
 3403 1334  7B          	LD	A,E
 3404 1335  32 003E     	LD	(YPOS2),A
 3405 1338  CD D0C0     	CALL	POS1
 3406 133B  CD D6C0     	CALL	ABS1
 3407 133E  C1          	POP	BC
 3408 133F  D1          	POP	DE
 3409 1340  CD D46F     	CALL	ADD5
 3410 1343  3A 003E     	LD	A,(YPOS2)
 3411 1346  B7          	OR	A
 3412 1347  E1          	POP	HL
 3413 1348  28 09       	JR	Z,U13EA
 3414 134A  1E 30       	LD	E,'0'
 3415 134C  83          	ADD	E
 3416 134D  77          	LD	(HL),A
 3417 134E  08          	EX	AF,AF'
 3418 134F  7B          	LD	A,E
 3419 1350  37          	SCF
 3420 1351  18 02       	JR	U13EC
 3421                   	;
 3422 1353  08          U13EA:	EX	AF,AF'
 3423 1354  77          	LD	(HL),A
 3424 1355  08          U13EC:	EX	AF,AF'
 3425 1356  23          	INC	HL
 3426 1357  C1          	POP	BC
 3427 1358  04          	INC	B
 3428 1359  78          	LD	A,B
 3429 135A  B9          	CP	C
 3430 135B  20 B5       	JR	NZ,U13A9
 3431 135D  08          	EX	AF,AF'
 3432 135E  D8          	RET	C
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  50
BAC85   Z80

 3433 135F  2A 0051     	LD	HL,(U0041)
 3434 1362  7E          	LD	A,(HL)
 3435 1363  FE 2D       	CP	'-'
 3436 1365  C0          	RET	NZ
 3437 1366  36 20       	LD	(HL),' '
 3438 1368  C9          	RET
 3439                   	;
 3440 1369  E1          U1400:	POP	HL
 3441 136A  2A 0051     U1401:	LD	HL,(U0041)
 3442 136D  3A 003E     	LD	A,(YPOS2)
 3443 1370  3C          	INC	A
 3444 1371  47          	LD	B,A
 3445 1372  3E 2A       	LD	A,'*'
 3446 1374  18 02       	JR	U140F
 3447                   	;
 3448 1376  77          U140D:	LD	(HL),A
 3449 1377  23          	INC	HL
 3450 1378  10 FC       U140F:	DJNZ	U140D
 3451 137A  C9          	RET
 3452                   ;
 3453 137B  CD D0C0     U1412:	CALL	POS1
 3454 137E  01 8420     	LD	BC,8420H	; 10
 3455 1381  11 0000     	LD	DE,0
 3456 1384  C3 D92A     	JP	EXPO+2
 3457                   ;
 3458                   ; GOSUB 330	Umwandlung aller Kleinbuchstaben in einem String in Grossbuchstaben
 3459                   ;		Uebergabe und Rueckgabe des Strings in der Variablen SR$
 3460                   ;
 3461 1387  01 53D2     GO330:	LD	BC,'SR'+80H	; SR$
 3462 138A  CD CF48     	CALL	DIM7		; Adresse der Variable SR$ nach DE holen
 3463 138D  EB          	EX	DE,HL
 3464 138E  7E          	LD	A,(HL)
 3465 138F  23          	INC	HL
 3466 1390  23          	INC	HL
 3467 1391  E5          	PUSH	HL
 3468 1392  5E          	LD	E,(HL)
 3469 1393  23          	INC	HL
 3470 1394  56          	LD	D,(HL)
 3471 1395  EB          	EX	DE,HL
 3472 1396  E3          	EX	(SP),HL
 3473 1397  E5          	PUSH	HL
 3474 1398  CD D1E1     	CALL	STROP
 3475 139B  E1          	POP	HL
 3476 139C  73          	LD	(HL),E
 3477 139D  23          	INC	HL
 3478 139E  72          	LD	(HL),D
 3479 139F  E1          	POP	HL
 3480 13A0  47          	LD	B,A
 3481 13A1  04          	INC	B
 3482 13A2  18 0E       	JR	U1449
 3483                   	;
 3484 13A4  7E          U143B:	LD	A,(HL)
 3485 13A5  FE 60       	CP	60H
 3486 13A7  38 06       	JR	C,U1446
 3487 13A9  FE 7F       	CP	7FH
 3488 13AB  30 02       	JR	NC,U1446
 3489 13AD  D6 20       	SUB	20H
 3490 13AF  12          U1446:	LD	(DE),A
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  51
BAC85   Z80

 3491 13B0  23          	INC	HL
 3492 13B1  13          	INC	DE
 3493 13B2  10 F0       U1449:	DJNZ	U143B
 3494 13B4  C9          	RET
 3495                   ;
 3496                   ; GOSUB 350	Ausgabe eines Strings auf dem Drucker
 3497                   ;		Uebergabe des Strings in der Variablen SR$
 3498                   ;
 3499 13B5  CD 15FD     GO350:	CALL	U1691		; Zeichenkette SR$ holen
 3500 13B8  EB          	EX	DE,HL		; Adresse in HL
 3501 13B9  18 05       	JR	U1457
 3502                   	;
 3503 13BB  7E          U1452:	LD	A,(HL)		; Zeichen holen
 3504 13BC  23          	INC	HL
 3505 13BD  CD 0732     	CALL	PRINT		; Zeichen an Drucker senden
 3506 13C0  10 F9       U1457:	DJNZ	U1452
 3507 13C2  C9          	RET
 3508                   ;
 3509                   ; GOSUB 360	Ausgabe eines Zeilenumbruchs auf dem Drucker
 3510                   ;
 3511 13C3  21 1CF1     GO360:	LD	HL,U1D05	; CR,LF
 3512 13C6  06 03       	LD	B,3		; 2+1
 3513 13C8  18 F6       	JR	U1457
 3514                   ;
 3515                   ; GOSUB 400	Ausgabe eines Tones
 3516                   ;		Uebergabe der Lautstaerke, Dauer und Tonhoehe
 3517                   ;		 in den Variablen SV, SD und SP
 3518                   ;
 3519 13CA  01 5356     GO400:	LD	BC,'SV'		; Sound Volume (Lautstaerke) 0-15
 3520 13CD  CD 15E7     	CALL	U167B		; Wert der Variable SV nach HL holen
 3521 13D0  E5          	PUSH	HL
 3522 13D1  CD 1550     	CALL	U15DA		; Zeitdauer SD
 3523 13D4  01 5350     	LD	BC,'SP'		; Sound Pitch (Tonhoehe)
 3524 13D7  CD 15E7     	CALL	U167B		; Wert der Variable SP nach HL holen
 3525 13DA  7D          	LD	A,L
 3526 13DB  C1          	POP	BC
 3527 13DC  2A 01EC     	LD	HL,(01ECH)	; Interrupt CTC Kanal 2 - Tondauer, Blinkfrequenz
 3528 13DF  E5          	PUSH	HL		; merken
 3529 13E0  21 1AA2     	LD	HL,ISRC2	; interne ISR fuer CTC2
 3530 13E3  22 01EC     	LD	(01ECH),HL	; jetzt aktivieren
 3531 13E6  CD 068C     	CALL	U0677
 3532 13E9  E1          	POP	HL
 3533 13EA  22 01EC     	LD	(01ECH),HL	; urspruengliche ISR
 3534 13ED  C9          	RET
 3535                   ;
 3536                   ; GOSUB 450	Warten einer bestimmten Zeit auf einen Tastendruck
 3537                   ;		Uebergabe der Dauer in der Variablen SD (in 100ms-Einheiten)
 3538                   ;
 3539 13EE  CD 1550     GO450:	CALL	U15DA		; Zeitdauer
 3540 13F1  C4 1410     	CALL	NZ,U14A7
 3541 13F4  F5          	PUSH	AF
 3542 13F5  D5          	PUSH	DE
 3543 13F6  7C          	LD	A,H
 3544 13F7  45          	LD	B,L
 3545 13F8  CD D0B1     	CALL	FRE3
 3546 13FB  CD 1226     	CALL	U12AF
 3547 13FE  21 03E8     	LD	HL,WRA1+3
 3548 1401  7E          	LD	A,(HL)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  52
BAC85   Z80

 3549 1402  D6 02       	SUB	2
 3550 1404  30 01       	JR	NC,U149E
 3551 1406  AF          	XOR	A
 3552 1407  77          U149E:	LD	(HL),A
 3553 1408  E1          	POP	HL
 3554 1409  CD D6F7     	CALL	OPTRAN
 3555 140C  F1          	POP	AF
 3556 140D  C3 1160     	JP	U11E7
 3557                   ;
 3558 1410  2A 01EC     U14A7:	LD	HL,(01ECH)	; Interrupt CTC Kanal 2 - Tondauer, Blinkfrequenz
 3559 1413  22 004F     	LD	(U003F),HL	; Originalwert hier merken
 3560 1416  21 1AA2     	LD	HL,ISRC2
 3561 1419  22 01EC     	LD	(01ECH),HL	; interne ISR fuer CTC2
 3562 141C  3E 03       	LD	A,3
 3563 141E  D3 8C       	OUT	(CTC0),A
 3564 1420  3E A7       	LD	A,0A7H
 3565 1422  D3 8E       	OUT	(CTC2),A
 3566 1424  3E AB       	LD	A,0ABH
 3567 1426  D3 8E       	OUT	(CTC2),A
 3568 1428  2A 005A     U14BF:	LD	HL,(U004A)
 3569 142B  7C          	LD	A,H
 3570 142C  B5          	OR	L
 3571 142D  28 05       	JR	Z,U14CB
 3572 142F  CD 061F     	CALL	U0613		; Taste gedrueckt?
 3573 1432  28 F4       	JR	Z,U14BF
 3574 1434  E5          U14CB:	PUSH	HL
 3575 1435  2A 004F     	LD	HL,(U003F)	; gemerkte ISR
 3576 1438  22 01EC     	LD	(01ECH),HL	; Interrupt CTC Kanal 2 - Tondauer, Blinkfrequenz
 3577 143B  E1          	POP	HL
 3578 143C  C9          	RET
 3579                   ;
 3580                   ; GOSUB 500	Oeffnen einer Datei
 3581                   ;		Uebergabe des Namens in der Variablen NF$
 3582                   ;		Festlegung eines Datei-Identifiers in der Variablen NF
 3583                   ;
 3584 143D  CD F018     GO500:	CALL	IRMON
 3585 1440  21 B6D8     	LD	HL,0B6D8H	; VRAM-Adresse Bild 0, letzte Zeile
 3586 1443  11 0010     	LD	DE,U0000
 3587 1446  01 0028     	LD	BC,40		; gesamte Zeile
 3588 1449  ED B0       	LDIR			; Inhalt der Bildschirmzeile in Puffer kopieren
 3589 144B  CD F01B     	CALL	IRMOFF
 3590 144E  CD 15CC     	CALL	U1656		; Offset gemaess NF holen nach HL und B
 3591 1451  C5          	PUSH	BC		; B=NF (0-7)
 3592 1452  48          	LD	C,B
 3593 1453  CD 15C4     	CALL	U164E		; Kanal bereits geoeffnet?
 3594 1456  DA 15DE     	JP	C,U1668		; ja, Fehler
 3595 1459  79          	LD	A,C		; C=NF
 3596 145A  FE 04       	CP	4
 3597 145C  3A 0055     	LD	A,(U0045)
 3598 145F  38 03       	JR	C,U14ED		; NF = 0..3
 3599 1461  E6 F0       	AND	0F0H		; ein anderer Kanal aus 4-7 geoeffnet?
 3600 1463  11          	DB	11H	; LD DE,0FE6H
 3601 1464  E6 0F       U14ED:	AND	0FH		; ein anderer Kanal aus 0-3 geoeffnet?
 3602 1466  C2 15DE     	JP	NZ,U1668	; ja, Fehler
 3603 1469  E5          	PUSH	HL		; Kanal-Offset
 3604         0000      if DEV
 3612                   endif
 3613 146A  01 4EC6     	LD	BC,'NF'+80H	; NF$
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  53
BAC85   Z80

 3614 146D  CD CF48     	CALL	DIM7		; Adresse der Variable NF$ nach DE holen
 3615 1470  D5          	PUSH	DE
 3616 1471  21 0060     	LD	HL,FNAME	; Dateiname hier ablegen fuer MBIN/MBOUT
 3617 1474  5D          	LD	E,L
 3618 1475  54          	LD	D,H
 3619 1476  13          	INC	DE
 3620                   ; 28.12.2023:
 3621                   ; Dateinamen fuer MBIN/MBOUT vorbereiten, dazu 3x Dateityp, 8x Dateiname
 3622 1477  36 C4       	LD	(HL),'D'+80H	; Dateityp .DDD
 3623 1479  01 0002     	LD	BC,2		; 3 Zeichen
 3624 147C  ED B0       	LDIR			; kopieren
 3625 147E  23          	INC	HL
 3626 147F  13          	INC	DE
 3627 1480  36 20       	LD	(HL),' '
 3628 1482  0E 07       	LD	C,7		; 8 Zeichen (B ist noch 0 vom letzten LDIR)
 3629 1484  ED B0       	LDIR			; 8x mit Leerzeichen vorbelegen
 3630                   ;	INC	HL		; abschliessende 0 nicht mehr erforderlich
 3631                   ;	LD	(HL),C		; Ende-0 anhaengen
 3632                   
 3633 1486  E1          	POP	HL		; HL = NF$
 3634 1487  4E          	LD	C,(HL)		; BC = Laenge der Zeichenkette
 3635 1488  23          	INC	HL
 3636                   ;	LD	B,(HL)		; B ist immer 0, noch vom letzten LDIR
 3637 1489  23          	INC	HL
 3638 148A  5E          	LD	E,(HL)
 3639 148B  23          	INC	HL
 3640 148C  56          	LD	D,(HL)		; DE = Beginn der Zeichenkette
 3641 148D  79          	LD	A,C
 3642 148E  B7          	OR	A
 3643 148F  28 0C       	JR	Z,U1518		; Laenge = 0
 3644 1491  FE 08       	CP	8
 3645 1493  38 02       	JR	C,U1517		; Laenge < 8
 3646 1495  0E 08       	LD	C,8		; Laenge auf max. 8 begrenzen
 3647 1497  21 0063     U1517:	LD	HL,FNAME+3	; Dateiname
 3648 149A  EB          	EX	DE,HL
 3649 149B  ED B0       	LDIR			; Dateiname dorthin kopieren
 3650 149D  E1          U1518:	POP	HL		; Kanal-Offset (0, 2, 4 .. 14)
 3651 149E  11 1E5D     	LD	DE,U1E71	; Sprungverteiler zum Oeffnen einer Datei
 3652 14A1  CD 15BE     	CALL	U1648		; Datei oeffnen
 3653 14A4  C1          	POP	BC
 3654 14A5  DA 15DF     	JP	C,U1669		; Fehler
 3655 14A8  3A 0055     	LD	A,(U0045)
 3656 14AB  4F          	LD	C,A
 3657 14AC  04          	INC	B
 3658 14AD  AF          	XOR	A
 3659 14AE  37          	SCF
 3660 14AF  17          U152A:	RLA
 3661 14B0  10 FD       	DJNZ	U152A
 3662 14B2  B1          	OR	C
 3663 14B3  32 0055     	LD	(U0045),A
 3664 14B6  18 5C       	JR	U158F
 3665                   ;
 3666                   ; GOSUB 540	Lesen eines Strings aus einer Datei
 3667                   ;		Uebergabe des Identifiers in der Variablen NF
 3668                   ;		Rueckgabe des Strings in der Variablen IN$
 3669                   ;
 3670 14B8  CD 15CC     GO540:	CALL	U1656		; Offset gemaess NF holen nach HL und B
 3671 14BB  CB 40       	BIT	0,B		; Kanal zum Schreiben geoeffnet?
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  54
BAC85   Z80

 3672 14BD  C2 15DF     	JP	NZ,U1669	; ja, unzulaessig
 3673 14C0  11 160C     	LD	DE,U16A0	; IN$ zurueckgeben
 3674 14C3  CD 15C4     U153E:	CALL	U164E		; Kanal geoeffnet?
 3675 14C6  D2 15DF     	JP	NC,U1669	; nein, unzulaessig
 3676 14C9  D5          	PUSH	DE
 3677 14CA  11 1E7D     	LD	DE,U1E91	; Sprungverteiler Lesen/Schreiben
 3678 14CD  19          	ADD	HL,DE
 3679 14CE  5E          	LD	E,(HL)
 3680 14CF  23          	INC	HL
 3681 14D0  56          	LD	D,(HL)		; Adresse der Routine lesen
 3682 14D1  D5          	PUSH	DE
 3683 14D2  FD E1       	POP	IY		; und in IY eintragen fuer spaeteres CALL (IY)
 3684 14D4  C9          	RET
 3685                   ;
 3686                   ; GOSUB 560	Schreiben eines Strings in eine Datei
 3687                   ;		Uebergabe des Identifiers in der Variablen NF
 3688                   ;		Uebergabe des Strings in der Variablen SR$
 3689                   ;
 3690 14D5  CD 15CC     GO560:	CALL	U1656		; Offset gemaess NF holen nach HL und B
 3691 14D8  CB 40       	BIT	0,B		; Kanal zum Lesen geoeffnet?
 3692 14DA  CA 15DF     	JP	Z,U1669		; ja, unzulaessig
 3693 14DD  11 167D     	LD	DE,U170A	; SR$ zurueckgeben
 3694 14E0  18 E1       	JR	U153E
 3695                   ;
 3696                   ; GOSUB 580	Schliessen einer Datei
 3697                   ;		Uebergabe des Identifiers in der Variablen NF
 3698                   ;
 3699 14E2  CD 15CC     GO580:	CALL	U1656		; Offset gemaess NF holen nach HL und B
 3700 14E5  C5          	PUSH	BC
 3701 14E6  CD 15C4     	CALL	U164E		; Kanal geoeffnet?
 3702 14E9  C1          	POP	BC
 3703 14EA  D2 15DF     	JP	NC,U1669	; nein, unzulaessig
 3704 14ED  C5          	PUSH	BC
 3705 14EE  04          	INC	B
 3706 14EF  3A 0055     	LD	A,(U0045)	; geoeffnete Kanaele
 3707 14F2  1F          U156D:	RRA
 3708 14F3  10 FD       	DJNZ	U156D
 3709 14F5  D2 15DE     	JP	NC,U1668	; Fehler, nicht der richtige Kanal
 3710 14F8  11 1E6D     	LD	DE,U1E81	; Sprungverteiler zum Schliessen einer Datei
 3711 14FB  CD 15BE     	CALL	U1648		; Datei schliessen
 3712 14FE  C1          	POP	BC
 3713 14FF  DA 15DF     	JP	C,U1669		; Fehler
 3714 1502  3A 0055     	LD	A,(U0045)	; geoeffnete Kanaelt
 3715 1505  4F          	LD	C,A
 3716 1506  04          	INC	B
 3717 1507  AF          	XOR	A		; alle Bits 0
 3718 1508  37          	SCF			; 1-Bit
 3719 1509  17          U1584:	RLA			; an die gewuenschte Stelle schieben
 3720 150A  10 FD       	DJNZ	U1584
 3721 150C  2F          	CPL			; Bit negieren
 3722 150D  A1          	AND	C		; geoeffneten Kanal zuruecksetzen
 3723 150E  32 0055     	LD	(U0045),A	; und eintragen
 3724 1511  CD 0920     	CALL	U09C8		; unterste Bildschirmzeile malen
 3725 1514  01 494E     U158F:	LD	BC,'IN'
 3726 1517  CD CF48     	CALL	DIM7		; Adresse der Variable IN nach DE holen
 3727 151A  13          	INC	DE
 3728 151B  13          	INC	DE
 3729 151C  13          	INC	DE
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  55
BAC85   Z80

 3730 151D  AF          	XOR	A
 3731 151E  12          	LD	(DE),A
 3732 151F  C9          	RET
 3733                   ;
 3734                   ; GOSUB 600	Initialisieren des Grafikmodus, Loeschen des Bildschirms
 3735                   ;
 3736 1520  CD 1EB6     GO600:	CALL	U1ECA		; Farbe nach Variable CC einstellen
 3737 1523  01 484F     	LD	BC,'HO'
 3738 1526  CD 15F3     	CALL	U1687		; Variable 'HO' auf 0 setzen
 3739 1529  01 5645     	LD	BC,'VE'
 3740 152C  CD 15F3     	CALL	U1687		; Variable 'VE' auf 0 setzen
 3741 152F  21 0000     	LD	HL,0
 3742 1532  22 003C     	LD	(XPOS2),HL
 3743 1535  22 003E     	LD	(YPOS2),HL
 3744 1538  22 0040     	LD	(XPOS1),HL
 3745 153B  22 0042     	LD	(YPOS1),HL
 3746 153E  C3 05DC     	JP	CLS		; Bildschirm loeschen
 3747                   ;
 3748                   ; GOTO 950	Beenden des BASICODE-Programms
 3749                   ;
 3750 1541  CD 1EB6     GO950:	CALL	U1ECA		; Farbe nach Variable CC einstellen
 3751 1544  E5          	PUSH	HL
 3752 1545  CD 05DC     	CALL	CLS		; Bildschirm loeschen
 3753 1548  E1          	POP	HL
 3754 1549  AF          	XOR	A		; Z=1 (BREAK IN ... nicht anzeigen)
 3755 154A  CD 0659     	CALL	U0642		; BRK/STOP aktivieren
 3756 154D  C3 C91B     	JP	END0		; zurueck in BASIC-ROM
 3757                   ;
 3758                   ; Warteschleife fuer GOSUB 400 (Tondauer) und GOSUB 450 (Warte auf Tastendruck)
 3759                   ;
 3760 1550  01 5344     U15DA:	LD	BC,'SD'		; Sound Duration (Tondauer in 0,1s Schritten)
 3761 1553  CD CF48     	CALL	DIM7		; Adresse der Variable SD nach DE holen
 3762 1556  D5          	PUSH	DE
 3763 1557  EB          	EX	DE,HL
 3764 1558  CD D6DD     	CALL	OPKOP		; Wert in Arithmetikregister 1 laden
 3765 155B  21 03E8     	LD	HL,WRA1+3
 3766 155E  7E          	LD	A,(HL)
 3767 155F  B7          	OR	A
 3768 1560  28 10       	JR	Z,U15FC
 3769 1562  C6 02       	ADD	2
 3770 1564  77          	LD	(HL),A
 3771 1565  FE 90       	CP	90H
 3772 1567  38 09       	JR	C,U15FC
 3773 1569  01 9180     	LD	BC,9180H	; -65536
 3774 156C  11 0000     	LD	DE,0
 3775 156F  CD D46F     	CALL	ADD5
 3776 1572  CD C96F     U15FC:	CALL	EPRVL3		; Ausdruck berechnen -> DE
 3777 1575  EB          	EX	DE,HL
 3778 1576  22 005A     	LD	(U004A),HL
 3779 1579  7C          	LD	A,H
 3780 157A  B5          	OR	L
 3781 157B  D1          	POP	DE
 3782 157C  C9          	RET
 3783                   ;
 3784                   ; Werte der Variablen HO, VE und CN holen
 3785                   ;
 3786 157D  01 484F     U1607:	LD	BC,'HO'		; Horizontalposition
 3787 1580  CD CF48     	CALL	DIM7		; Adresse der Variable HO nach DE holen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  56
BAC85   Z80

 3788 1583  EB          	EX	DE,HL
 3789 1584  CD D6DD     	CALL	OPKOP		; Wert in Arithmetikregister 1 laden
 3790 1587  01 8920     	LD	BC,8920H
 3791 158A  11 0000     	LD	DE,0		; 320
 3792 158D  CD D59A     	CALL	MUL1		; HO*320
 3793 1590  CD C96F     	CALL	EPRVL3		; Ausdruck berechnen -> DE
 3794 1593  ED 53 003C  	LD	(XPOS2),DE	; X-Position ablegen
 3795 1597  01 5645     	LD	BC,'VE'		; Vertikalposition
 3796 159A  CD CF48     	CALL	DIM7		; Adresse der Variable VE nach DE holen
 3797 159D  EB          	EX	DE,HL
 3798 159E  CD D6DD     	CALL	OPKOP		; Wert in Arithmetikregister 1 laden
 3799 15A1  01 8870     	LD	BC,8870H	; (BC=8900H waere 256)
 3800 15A4  11 0000     	LD	DE,0		; 240
 3801 15A7  CD D59A     	CALL	MUL1		; VE*240
 3802 15AA  CD C96F     	CALL	EPRVL3		; Ausdruck berechnen -> DE
 3803 15AD  ED 53 003E  	LD	(YPOS2),DE	; Y-Position ablegen
 3804 15B1  01 434E     GETCN:	LD	BC,'CN'		; Farbe (Color Numerisch)
 3805 15B4  CD 15E7     	CALL	U167B		; Wert der Variable CN nach HL holen
 3806 15B7  7D          	LD	A,L
 3807 15B8  32 0044     	LD	(CN),A		; Wert von CN speichern
 3808 15BB  C9          	RET
 3809                   
 3810 15BC  FD E9       CALLIY:	JP	(IY)		; CALL (IY)
 3811         15BD      CALLHL:	EQU	$-1		; CALL (HL)
 3812                   ;
 3813                   ; Verzweigen gemaess Sprungverteiler
 3814                   ; PE:	DE = Adresse des Sprungverteilers
 3815                   ;	HL = Offset (0 bei NF=0, 2 bei NF=2 usw.)
 3816                   ;
 3817 15BE  19          U1648:	ADD	HL,DE
 3818 15BF  7E          	LD	A,(HL)
 3819 15C0  23          	INC	HL
 3820 15C1  66          	LD	H,(HL)
 3821 15C2  6F          	LD	L,A
 3822 15C3  E9          	JP	(HL)
 3823                   ;
 3824                   ; Kanal geoeffnet?
 3825                   ; PE:	B=Kanal-Nr. NF (0-7)
 3826                   ;
 3827 15C4  04          U164E:	INC	B		; B = 1-8
 3828 15C5  3A 0055     	LD	A,(U0045)
 3829 15C8  1F          U1652:	RRA
 3830 15C9  10 FD       	DJNZ	U1652
 3831 15CB  C9          	RET
 3832                   ;
 3833                   ; Offset entsprechend Variable NF holen
 3834                   ; PA:	HL = NF*2
 3835                   ;	B = NF
 3836                   ;
 3837 15CC  D5          U1656:	PUSH	DE
 3838 15CD  01 4E46     	LD	BC,'NF'
 3839 15D0  CD 15E7     	CALL	U167B		; Wert der Variable NF nach HL holen
 3840 15D3  D1          	POP	DE
 3841 15D4  24          	INC	H
 3842 15D5  25          	DEC	H
 3843 15D6  20 06       	JR	NZ,U1668	; H > 0 ist unzulaessig
 3844 15D8  7D          	LD	A,L
 3845 15D9  45          	LD	B,L
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  57
BAC85   Z80

 3846 15DA  29          	ADD	HL,HL
 3847 15DB  FE 08       	CP	8
 3848 15DD  D8          	RET	C		; OK (NF liegt zwischen 0 und 7)
 3849                   ; Fehler:
 3850 15DE  F1          U1668:	POP	AF		; RET-Adresse vom Stack nehmen
 3851 15DF  3E FF       U1669:	LD	A,0FFH		; Fehler setzen
 3852 15E1  32 0053     	LD	(U0043),A
 3853 15E4  C3 1665     	JP	U16F9		; Variable IN zurueckmelden
 3854                   ;
 3855                   ; Wert einer Variable lesen
 3856                   ; PE:	BC=Name der Variablen
 3857                   ; PA:	HL=Zahlenwert
 3858                   ;
 3859 15E7  CD CF48     U167B:	CALL	DIM7		; Adresse der Variable nach DE holen
 3860 15EA  EB          	EX	DE,HL
 3861 15EB  CD D6DD     	CALL	OPKOP		; Wert in Arithmetikregister 1 laden
 3862 15EE  CD C96F     	CALL	EPRVL3		; Ausdruck berechnen -> DE
 3863 15F1  EB          	EX	DE,HL		; Uebergabe in HL
 3864 15F2  C9          	RET
 3865                   ;
 3866                   ; Wert einer Variable holen und Inhalt auf 0 setzen
 3867                   ; PE:	BC=Name der Variablen
 3868                   ;
 3869 15F3  CD CF48     U1687:	CALL	DIM7		; Adresse der Variable nach DE holen
 3870 15F6  AF          	XOR	A
 3871 15F7  12          	LD	(DE),A		; 0 eintragen
 3872 15F8  13          	INC	DE
 3873 15F9  13          	INC	DE
 3874 15FA  13          	INC	DE
 3875 15FB  12          	LD	(DE),A		; 0 eintragen
 3876 15FC  C9          	RET
 3877                   ;
 3878                   ; Zeichenkette aus SR$ holen
 3879                   ;
 3880 15FD  01 53D2     U1691:	LD	BC,'SR'+80H	; SR$
 3881 1600  CD CF48     	CALL	DIM7		; Adresse der Variable SR$ nach DE holen
 3882 1603  EB          	EX	DE,HL
 3883 1604  46          	LD	B,(HL)		; B = Anzahl Zeichen
 3884 1605  04          	INC	B		; Laenge+1
 3885 1606  23          	INC	HL
 3886 1607  23          	INC	HL
 3887 1608  5E          	LD	E,(HL)
 3888 1609  23          	INC	HL
 3889 160A  56          	LD	D,(HL)		; DE = Zeiger auf Zeichenkette
 3890 160B  C9          	RET
 3891                   ;
 3892                   ; Variable IN$ zurueckgeben (aus Datei Lesen)
 3893                   ;
 3894 160C  01 49CE     U16A0:	LD	BC,'IN'+80H	; IN$
 3895 160F  CD CF48     	CALL	DIM7		; Adresse der Variable IN$ nach DE holen
 3896 1612  D5          	PUSH	DE
 3897 1613  2A 03DB     	LD	HL,(FSLPTR)	; erste freie Adresse hinter den Variablen
 3898 1616  AF          	XOR	A
 3899 1617  32 0053     	LD	(U0043),A	; 00 = kein Fehler
 3900 161A  5F          	LD	E,A
 3901 161B  E5          U16AF:	PUSH	HL
 3902 161C  D5          	PUSH	DE
 3903 161D  CD 15BC     	CALL	CALLIY		; CALL (IY) => hier Leseroutine
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  58
BAC85   Z80

 3904 1620  D1          	POP	DE
 3905 1621  E1          	POP	HL
 3906 1622  FE 0D       	CP	CR
 3907 1624  28 26       	JR	Z,U16E0
 3908 1626  FE 20       	CP	' '
 3909 1628  38 04       	JR	C,U16C2
 3910 162A  FE 7F       	CP	7FH
 3911 162C  38 07       	JR	C,U16C9
 3912 162E  3E FF       U16C2:	LD	A,0FFH
 3913 1630  32 0053     	LD	(U0043),A	; FF = Fehler
 3914 1633  3E 23       	LD	A,23H
 3915 1635  77          U16C9:	LD	(HL),A
 3916 1636  23          	INC	HL
 3917 1637  E5          	PUSH	HL
 3918 1638  ED 72       	SBC	HL,SP
 3919 163A  E1          	POP	HL
 3920 163B  D2 C33E     	JP	NC,OMER
 3921 163E  1C          	INC	E
 3922 163F  3A 0054     	LD	A,(U0044)	; FFH = Abbruch/Fehler (0 = OK)
 3923 1642  57          	LD	D,A
 3924 1643  3A 0053     	LD	A,(U0043)
 3925 1646  B2          	OR	D
 3926 1647  32 0053     	LD	(U0043),A
 3927 164A  18 CF       	JR	U16AF
 3928                   	;
 3929 164C  7B          U16E0:	LD	A,E
 3930 164D  CD D1E1     	CALL	STROP
 3931 1650  E1          	POP	HL
 3932 1651  77          	LD	(HL),A
 3933 1652  23          	INC	HL
 3934 1653  23          	INC	HL
 3935 1654  73          	LD	(HL),E
 3936 1655  23          	INC	HL
 3937 1656  72          	LD	(HL),D
 3938 1657  2B          	DEC	HL
 3939 1658  2B          	DEC	HL
 3940 1659  2B          	DEC	HL
 3941 165A  B7          	OR	A
 3942 165B  28 08       	JR	Z,U16F9		; Variable IN zurueckmelden
 3943 165D  2A 03DB     	LD	HL,(FSLPTR)	; erste freie Adresse hinter den Variablen
 3944 1660  4F          	LD	C,A
 3945 1661  06 00       	LD	B,0
 3946 1663  ED B0       	LDIR
 3947 1665  01 494E     U16F9:	LD	BC,'IN'
 3948 1668  CD CF48     	CALL	DIM7		; Adresse der Variable IN nach DE holen
 3949 166B  3A 0053     	LD	A,(U0043)
 3950 166E  3C          	INC	A
 3951 166F  6F          	LD	L,A
 3952 1670  26 00       	LD	H,0
 3953 1672  2B          	DEC	HL
 3954                   ;	JP	U1671		; in Variable 'IN' eintragen
 3955                   ;
 3956                   ; Wert in eine Variable eintragen
 3957                   ; PE:	HL=Wert
 3958                   ;	DE=Adresse
 3959                   ;
 3960 1673  7C          U1671:	LD	A,H
 3961 1674  45          	LD	B,L
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  59
BAC85   Z80

 3962 1675  D5          	PUSH	DE
 3963 1676  CD D0B1     	CALL	FRE3
 3964 1679  E1          	POP	HL
 3965 167A  C3 D6F7     	JP	OPTRAN
 3966                   ;
 3967                   ; Variable SR$ zurueckgeben (in Datei schreiben)
 3968                   ;
 3969 167D  CD 15FD     U170A:	CALL	U1691		; Zeichenkette SR$ holen
 3970 1680  0E 00       	LD	C,0		; fehlerfrei annehmen
 3971 1682  18 0E       	JR	U171F
 3972                   	;
 3973 1684  C5          U1711:	PUSH	BC
 3974 1685  D5          	PUSH	DE
 3975 1686  1A          	LD	A,(DE)		; Zeichen aus SR$
 3976 1687  CD 15BC     	CALL	CALLIY		; CALL (IY) => hier Schreibroutine
 3977 168A  D1          	POP	DE
 3978 168B  C1          	POP	BC
 3979 168C  3A 0054     	LD	A,(U0044)	; FFH = Abbruch/Fehler (0 = OK)
 3980 168F  B1          	OR	C
 3981 1690  4F          	LD	C,A
 3982 1691  13          	INC	DE		; naechstes Zeichen
 3983 1692  10 F0       U171F:	DJNZ	U1711		; bis Zeichenanzahl abgearbeitet ist
 3984 1694  79          	LD	A,C
 3985 1695  32 0053     	LD	(U0043),A
 3986 1698  3E 0D       	LD	A,CR		; Zeichenkette in Datei mit CR abschliessen
 3987 169A  CD 15BC     	CALL	CALLIY		; CALL (IY) => hier Schreibroutine
 3988 169D  18 C6       	JR	U16F9		; Variable IN zurueckmelden
 3989                   ;
 3990                   ; Datei oeffnen (BASICODE lesen)
 3991                   ; NF=0
 3992                   ;
 3993 169F  CD 1713     U172D:	CALL	U178A		; Stack 1KByte nach vorn verlagern
 3994 16A2  D8          	RET	C		; zu wenig Speicherplatz
 3995 16A3  2A 0047     	LD	HL,(U0033)	; Ende ASCII-File
 3996 16A6  22 0049     	LD	(CPOINT),HL	; als Pufferzeiger eintragen (Puffer = leer)
 3997 16A9  18 07       	JR	U1740
 3998                   ;
 3999                   ; Datei Lesen (BASICODE lesen)
 4000                   ; NF=0
 4001                   ;
 4002 16AB  3A 0056     U1739:	LD	A,(U0046)
 4003 16AE  FE 04       	CP	4
 4004 16B0  28 21       	JR	Z,U1761
 4005 16B2  F5          U1740:	PUSH	AF
 4006 16B3  ED 5B 0047  	LD	DE,(U0033)	; Ende ASCII-File
 4007 16B7  2A 0049     	LD	HL,(CPOINT)	; Pufferzeiger
 4008 16BA  CD C689     	CALL	CPREG		; Vergleiche Register DE mit HL
 4009 16BD  CC 17D8     	CALL	Z,U17F1		; Puffer leer, 1 KByte-Block einlesen
 4010 16C0  7E          	LD	A,(HL)
 4011 16C1  23          	INC	HL
 4012 16C2  22 0049     	LD	(CPOINT),HL	; Pufferzeiger
 4013 16C5  32 0056     	LD	(U0046),A
 4014 16C8  FE 04       	CP	4
 4015 16CA  20 05       	JR	NZ,U175F
 4016 16CC  21 0053     	LD	HL,U0043
 4017 16CF  CB C6       	SET	0,(HL)
 4018 16D1  F1          U175F:	POP	AF
 4019 16D2  C9          	RET
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  60
BAC85   Z80

 4020                   	;
 4021 16D3  21 0053     U1761:	LD	HL,U0043
 4022 16D6  CB C6       	SET	0,(HL)
 4023 16D8  3E 0D       	LD	A,CR
 4024 16DA  C9          	RET
 4025                   ;
 4026                   ; Datei schliessen (BASICODE schreiben)
 4027                   ; NF=1
 4028                   ;
 4029 16DB  2A 0049     U17D7:	LD	HL,(CPOINT)	; Pufferzeiger
 4030 16DE  ED 5B 0047  	LD	DE,(U0033)	; Ende ASCII-File
 4031 16E2  36 04       U17DE:	LD	(HL),4		; ENDE-Zeichen eintragen
 4032 16E4  23          	INC	HL
 4033 16E5  CD C689     	CALL	CPREG		; Vergleiche Register DE mit HL
 4034 16E8  20 F8       	JR	NZ,U17DE	; bis Rest vom Puffer damit gefuellt ist
 4035 16EA  CD 175D     	CALL	U18A2		; letzten Datenblock schreiben
 4036 16ED  3A 0053     	LD	A,(U0043)
 4037 16F0  87          	ADD	A
 4038 16F1  D8          	RET	C
 4039                   ;	JP	U1769		; Datei Schliessen (BASICODE lesen)
 4040                   ;
 4041                   ; Datei schliessen (BASICODE lesen)
 4042                   ; - 1K Pufferspeicher wird wieder freigegeben
 4043                   ; NF=0
 4044                   ;
 4045 16F2  F3          U1769:	DI
 4046 16F3  21 0000     	LD	HL,0
 4047 16F6  39          	ADD	HL,SP		; HL = aktueller Stackpointer, CY=0
 4048 16F7  ED 5B 0045  	LD	DE,(U0031)	; DE = Beginn ASCII-File
 4049 16FB  D5          	PUSH	DE		; Begin ASCII-File
 4050 16FC  EB          	EX	DE,HL
 4051 16FD  ED 52       	SBC	HL,DE		; Groesse der Stack-Belegung berechnen
 4052 16FF  38 0F       	JR	C,U1787		; zu wenig Platz
 4053 1701  4D          	LD	C,L
 4054 1702  44          	LD	B,H
 4055 1703  E1          	POP	HL		; Beginn ASCII-File
 4056 1704  ED 5B 0047  	LD	DE,(U0033)	; Ende ASCII-File
 4057 1708  1B          	DEC	DE
 4058 1709  2B          	DEC	HL
 4059 170A  ED B8       	LDDR			; Stack-Inhalt mit nehmen
 4060 170C  EB          	EX	DE,HL
 4061 170D  23          	INC	HL		; Stack an Ende verlegen
 4062 170E  F9          	LD	SP,HL		; und SP neu setzen
 4063 170F  3E          	DB	3EH	; LD A,0E1H (POP HL verhindern)
 4064 1710  E1          U1787:	POP	HL
 4065 1711  FB          	EI
 4066 1712  C9          	RET
 4067                   ;
 4068                   ; Vorbereitung fuer Lesen bzw. Schreiben von BASICODE-Datenfile
 4069                   ; - Blocknummer auf FFH setzen
 4070                   ; - Stack um 1KByte nach vorn verlegen
 4071                   ; PA:	CY=1	zu wenig Speicherplatz
 4072                   ;
 4073 1713  3E FF       U178A:	LD	A,0FFH
 4074 1715  32 004B     	LD	(BLNR),A
 4075 1718  F3          	DI
 4076 1719  21 0000     	LD	HL,0
 4077 171C  39          	ADD	HL,SP
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  61
BAC85   Z80

 4078 171D  E5          	PUSH	HL		; aktueller Stack
 4079 171E  11 FC00     	LD	DE,-400H	; 1 KByte
 4080 1721  19          	ADD	HL,DE		; vor dem Stack
 4081 1722  ED 5B 03DB  	LD	DE,(FSLPTR)	; erste freie Adresse hinter den Variablen
 4082 1726  CD C689     	CALL	CPREG		; Vergleiche Register DE mit HL
 4083 1729  C1          	POP	BC		; aktueller Stack
 4084 172A  38 14       	JR	C,U17B7		; zu wenig Platz
 4085 172C  F9          	LD	SP,HL		; Stack 1KByte nach vorn verlegen
 4086 172D  EB          	EX	DE,HL		; neuer Stack jetzt in DE
 4087 172E  C5          	PUSH	BC		; aktueller Stack
 4088 172F  2A 0356     	LD	HL,(STDPTR)	; RAM-Mindestgroesse (KC85/3=7EFF KC85/4=BEFF)
 4089 1732  22 0047     	LD	(U0033),HL	; Ende ASCII-File
 4090 1735  ED 42       	SBC	HL,BC		; Groesse der Stack-Belegung berechnen
 4091 1737  4D          	LD	C,L
 4092 1738  44          	LD	B,H
 4093 1739  E1          	POP	HL		; aktueller Stack
 4094 173A  ED B0       	LDIR			; Stack-Inhalt mit nehmen
 4095 173C  ED 53 0045  	LD	(U0031),DE	; Beginn ASCII-File
 4096 1740  FB          U17B7:	EI
 4097 1741  C9          	RET
 4098                   ;
 4099                   ; Datei oeffnen (BASICODE schreiben)
 4100                   ; NF=1
 4101                   ;
 4102 1742  CD 1713     U17B9:	CALL	U178A		; Stack 1KByte nach vorn verlagern
 4103 1745  D8          	RET	C		; zu wenig Speicherplatz
 4104 1746  2A 0045     	LD	HL,(U0031)	; Beginn ASCII-File
 4105 1749  22 0049     	LD	(CPOINT),HL	; als Pufferzeiger setzen (Puffer = leer)
 4106 174C  C9          	RET
 4107                   ;
 4108                   ; Datei Schreiben (BASICODE schreiben)
 4109                   ; NF=1
 4110                   ;
 4111 174D  2A 0049     U17C4:	LD	HL,(CPOINT)	; Pufferzeiger
 4112 1750  77          	LD	(HL),A		; Datenbyte in Puffer eintragen
 4113 1751  23          	INC	HL		; +1
 4114 1752  22 0049     	LD	(CPOINT),HL	; Pufferzeiger neu
 4115 1755  ED 5B 0047  	LD	DE,(U0033)	; Ende ASCII-File
 4116 1759  CD C689     	CALL	CPREG		; Vergleiche Register DE mit HL
 4117 175C  C0          	RET	NZ		; noch Platz im Puffer
 4118                   ;
 4119                   ; BASICODE Datenblock 1 KByte aus Puffer schreiben
 4120                   ;
 4121 175D  26 00       U18A2:	LD	H,0		; Startwert Pruefbyte
 4122 175F  D9          	EXX
 4123 1760  CD 18B4     	CALL	U1919		; BASICODE Bandsusgabe vorbereiten
 4124 1763  3A 004B     	LD	A,(BLNR)
 4125 1766  3C          	INC	A		; Blocknummer +1
 4126 1767  32 004B     	LD	(BLNR),A
 4127 176A  AF          	XOR	A
 4128 176B  32 0054     	LD	(U0044),A	; Abbruch/Fehler zurueck setzen
 4129 176E  CD 191F     	CALL	VTON		; 5 Sekunden Vorton
 4130 1771  3E 01       	LD	A,1		; 01H = STH start of header
 4131 1773  CD 19A0     	CALL	BCOUT		; ein Byte schreiben
 4132 1776  3A 004B     	LD	A,(BLNR)	; Blocknummer
 4133 1779  CD 19A0     	CALL	BCOUT		; ein Byte schreiben
 4134 177C  2A 0045     	LD	HL,(U0031)	; Beginn ASCII-File
 4135 177F  22 0049     	LD	(CPOINT),HL	; Pufferzeiger
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  62
BAC85   Z80

 4136 1782  01 0400     	LD	BC,1024		; Blockgroesse = 1 KByte
 4137 1785  7E          U18CA:	LD	A,(HL)		; Byte aus Puffer entnehmen
 4138 1786  CD 19A0     	CALL	BCOUT		; ein Byte schreiben
 4139 1789  CD 062E     	CALL	U0622		; Taste gedrueckt?
 4140 178C  20 12       	JR	NZ,U18E5	; ja
 4141 178E  ED A1       	CPI			; HL=HL+1 und BC=BC-1
 4142 1790  EA 1785     	JP	PE,U18CA	; bis BC=0
 4143 1793  3E 03       U18D0:	LD	A,3		; Ende-Byte 03H = ETX
 4144 1795  CD 19A0     	CALL	BCOUT		; ein Byte schreiben
 4145 1798  CD 199B     	CALL	BCPRO		; Pruefbyte schreiben
 4146 179B  CD 1919     	CALL	NTON		; 1 Sekunde Nachton
 4147 179E  18 05       	JR	BCOOLD		; umgeleitete ISR (Ausgabe) zurueckstellen
 4148                   	;
 4149 17A0  3E FF       U18E5:	LD	A,0FFH
 4150 17A2  32 0054     	LD	(U0044),A	; Abbruch/Fehler setzen
 4151                   ;	JR	BCOOLD		; umgeleitete ISR (Ausgabe) zurueckstellen
 4152                   ;
 4153                   ; umgeleitete ISR (bei Ausgabe) wieder zurueckstellen
 4154                   ;
 4155 17A5  F3          BCOOLD:	DI
 4156 17A6  3E 03       	LD	A,3
 4157 17A8  D3 8D       	OUT	(CTC1),A
 4158 17AA  2A 004F     	LD	HL,(U003F)	; gemerkter Wert fuer
 4159 17AD  22 01EA     	LD	(01EAH),HL	; ISR CTC1
 4160 17B0  18 0D       	JR	BCOLD
 4161                   ;
 4162                   ; umgeleitete ISR (bei Eingabe) wieder zurueckstellen
 4163                   ;
 4164 17B2  F3          BCIOLD:	DI
 4165 17B3  2A 004D     	LD	HL,(U003D)	; gemerkter Wert fuer
 4166 17B6  22 01E4     	LD	(01E4H),HL	; Interrupt PIO Kanal A - Kassetteneingabe
 4167 17B9  2A 004F     	LD	HL,(U003F)	; gemerkter Wert fuer
 4168 17BC  22 01EC     	LD	(01ECH),HL	; Interrupt CTC 2
 4169 17BF  3E 03       BCOLD:	LD	A,3
 4170 17C1  D3 8D       	OUT	(CTC1),A	; CTC1 stoppen
 4171 17C3  D3 8A       	OUT	(PIOAS),A	; PIO-A DI
 4172 17C5  DB 88       	IN	A,(PIOAD)
 4173 17C7  E6 9F       	AND	9FH		; LED aus, Stop Recorder
 4174 17C9  D3 88       	OUT	(PIOAD),A
 4175 17CB  3E 47       	LD	A,47H
 4176 17CD  D3 8E       	OUT	(CTC2),A	; CTC2 Zaehler, ZK folgt
 4177 17CF  D3 8E       	OUT	(CTC2),A	; ZK
 4178 17D1  FB          	EI
 4179 17D2  21 1B4F     	LD	HL,U1B63	; Text 'Bitte Band stoppen'
 4180 17D5  C3 1A51     	JP	U1AE5		; anzeigen
 4181                   ;
 4182                   ; BASICODE-Datenblock 1 KByte einlesen in Puffer
 4183                   ;
 4184 17D8  3A 004B     U17F1:	LD	A,(BLNR)
 4185 17DB  3C          	INC	A		; erwartete Blocknummer+1
 4186 17DC  32 004B     	LD	(BLNR),A
 4187 17DF  AF          	XOR	A
 4188 17E0  32 0054     	LD	(U0044),A	; Abbruch/Fehler zuruecksetzen
 4189 17E3  CD 1887     	CALL	U18EC		; BASICODE Bandeingabe vorbereiten
 4190 17E6  CD 18D1     U17FF:	CALL	BCSYN		; Synchronisation mit Frequenzmessung
 4191 17E9  CD 1942     U1802:	CALL	BCIN		; ein Byte lesen
 4192 17EC  38 FB       	JR	C,U1802		; Fehler, naechstes Byte lesen
 4193 17EE  20 48       	JR	NZ,U1851	; Taste gedrueckt
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  63
BAC85   Z80

 4194 17F0  FE 01       	CP	1		; 01H = STH start of header
 4195 17F2  28 08       	JR	Z,U1815
 4196 17F4  21 1C02     	LD	HL,U1C16	; Text 'kein BASICODE-Bestand!'
 4197 17F7  CD 1A51     	CALL	U1AE5		; anzeigen
 4198 17FA  18 EA       	JR	U17FF		; und wiederholen
 4199                   	;
 4200 17FC  CD 1942     U1815:	CALL	BCIN		; ein Byte lesen (Blocknummer)
 4201 17FF  20 37       	JR	NZ,U1851	; Taste gedrueckt
 4202 1801  32 01F2     	LD	(U01F2),A	; Blocknummer in (IX+2) eintragen
 4203 1804  4F          	LD	C,A
 4204 1805  3A 004B     	LD	A,(BLNR)	; erwartete Blocknummer
 4205 1808  B9          	CP	C
 4206 1809  28 05       	JR	Z,U1829		; Blocknummer stimmt
 4207 180B  CD 1844     	CALL	U185D		; Anzeige gelesene und erwartete Blocknummer
 4208 180E  18 D6       	JR	U17FF		; und wiederholen
 4209                   	;
 4210 1810  2A 0045     U1829:	LD	HL,(U0031)	; Beginn ASCII-File
 4211 1813  22 0049     	LD	(CPOINT),HL	; Pufferzeiger
 4212 1816  01 0400     	LD	BC,1024		; Blockgroesse = 1 KByte
 4213 1819  CD 1942     U1832:	CALL	BCIN		; ein Byte lesen
 4214 181C  20 1A       	JR	NZ,U1851	; Taste gedrueckt
 4215 181E  77          	LD	(HL),A		; Byte in Puffer ablegen
 4216 181F  ED A1       	CPI			; HL=HL+1 und BC=BC-1
 4217 1821  EA 1819     	JP	PE,U1832	; bis BC=0
 4218 1824  CD 1942     	CALL	BCIN		; ein Byte lesen (Ende-Byte 03H = ETX)
 4219                   				; wird nicht ueberprueft
 4220 1827  CD 1942     	CALL	BCIN		; ein Byte lesen (Check-Byte)
 4221 182A  20 0C       	JR	NZ,U1851	; Taste gedrueckt
 4222 182C  D9          	EXX
 4223 182D  24          	INC	H		; Pruefsumme von BCIN berechnet
 4224 182E  25          	DEC	H		; Pruefsumme korrekt?
 4225 182F  28 0C       	JR	Z,U1856		; ja
 4226 1831  CD 1870     	CALL	U188B		; Lesefehler, zurueck J/N?
 4227 1834  28 B0       	JR	Z,U17FF		; ja, wiederholen
 4228 1836  18 05       	JR	U1856
 4229                   	;
 4230 1838  3E FF       U1851:	LD	A,0FFH		; Kennung fuer Abbruch/Fehler
 4231 183A  32 0054     	LD	(U0044),A	; Abbruch eintragen
 4232 183D  CD 17B2     U1856:	CALL	BCIOLD		; umgeleitete ISR (Eingabe) zurueckstellen
 4233 1840  2A 0045     	LD	HL,(U0031)	; Beginn ASCII-File
 4234 1843  C9          	RET
 4235                   ;
 4236                   ; Anzeige der gelesenen und erwarteten Blocknummer
 4237                   ;
 4238 1844  21 1BC6     U185D:	LD	HL,U1BDA	; Zeichenkette "falsche Blocknummer..."
 4239 1847  11 1BDB     	LD	DE,U1BEF	; hier die gelesene Blocknummer einbauen
 4240 184A  3A 01F2     	LD	A,(U01F2)	; entspricht (IX+2) = gelesene Blocknummer
 4241 184D  CD 185C     	CALL	DEHEX		; in Zeichenkette einbauen
 4242 1850  11 1BE7     	LD	DE,U1BFB	; hier die erwartete Blocknummer einbauen
 4243 1853  3A 004B     U186C:	LD	A,(BLNR)	; erwartete Blocknummer
 4244 1856  CD 185C     	CALL	DEHEX		; in Zeichenkette einbauen
 4245 1859  C3 1A51     	JP	U1AE5		; und anzeigen
 4246                   ;
 4247                   ; aehnlich AHEX, aber Eintragen in Zeichenkette (DE)
 4248                   ;
 4249 185C  F5          DEHEX:	PUSH	AF
 4250 185D  0F          	RRCA
 4251 185E  0F          	RRCA
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  64
BAC85   Z80

 4252 185F  0F          	RRCA
 4253 1860  0F          	RRCA
 4254 1861  CD 1866     	CALL	HEX1		; 1x aufrufen
 4255 1864  13          	INC	DE		; naechste Position
 4256 1865  F1          	POP	AF		; und dann reinlaufen
 4257 1866  E6 0F       HEX1:	AND	0FH		; Maske
 4258 1868  C6 90       	ADD	A,90H		; uebliche
 4259 186A  27          	DAA			; Routine
 4260 186B  CE 40       	ADC	A,40H		; fuer die
 4261 186D  27          	DAA			; Hexausgabe
 4262 186E  12          	LD	(DE),A
 4263 186F  C9          	RET
 4264                   ;
 4265                   ; Anzeige Lesefehler und Abfrage Wiederholung J/N?
 4266                   ;
 4267 1870  21 1BA1     U188B:	LD	HL,U1BB5	; Text 'Lesefehler in Block ...'
 4268 1873  11 1BB6     	LD	DE,U1BCA	; hier die erwartete Blocknummer einbauen
 4269 1876  CD 1853     	CALL	U186C		; und anzeigen...
 4270 1879  CD 0638     U1894:	CALL	U062C		; Tastatureingabe abwarten
 4271 187C  E6 5F       	AND	5FH		; upcase
 4272 187E  FE 4A       	CP	'J'
 4273 1880  C8          	RET	Z		; Z=1 heisst wiederholen
 4274 1881  FE 4E       	CP	'N'
 4275 1883  20 F4       	JR	NZ,U1894
 4276 1885  3D          	DEC	A		; Z=0 nicht wiederholen
 4277 1886  C9          	RET
 4278                   ;
 4279                   ; BASICODE Bandeingabe vorbereiten
 4280                   ;
 4281 1887  21 1B3C     U18EC:	LD	HL,U1B50	; Text 'Bitte Band starten'
 4282 188A  CD 1A51     	CALL	U1AE5		; anzeigen
 4283 188D  F3          	DI
 4284 188E  3E 83       	LD	A,83H
 4285 1890  D3 8A       	OUT	(PIOAS),A
 4286 1892  2A 01E4     	LD	HL,(01E4H)	; Interrupt PIO Kanal A - Kassetteneingabe
 4287 1895  22 004D     	LD	(U003D),HL	; hier merken
 4288 1898  21 1A7E     	LD	HL,ISRPA
 4289 189B  22 01E4     	LD	(01E4H),HL	; neuer Wert
 4290 189E  2A 01EC     	LD	HL,(01ECH)	; Interrupt CTC Kanal 2 - Tondauer, Blinkfrequenz
 4291 18A1  22 004F     	LD	(U003F),HL
 4292 18A4  21 1AA2     	LD	HL,ISRC2
 4293 18A7  22 01EC     	LD	(01ECH),HL	; interne ISR fuer CTC2
 4294 18AA  DB 88       U190F:	IN	A,(PIOAD)
 4295 18AC  F6 40       	OR	40H
 4296 18AE  E6 DF       	AND	0DFH
 4297 18B0  D3 88       	OUT	(PIOAD),A
 4298 18B2  FB          	EI
 4299 18B3  C9          	RET
 4300                   ;
 4301                   ; BASICODE Bandsusgabe vorbereiten
 4302                   ;
 4303 18B4  21 1B3C     U1919:	LD	HL,U1B50	; Text 'Bitte Band starten'
 4304 18B7  CD 1A51     	CALL	U1AE5		; anzeigen
 4305 18BA  3E 03       	LD	A,3
 4306 18BC  D3 8E       	OUT	(CTC2),A	; CTC2 stoppen
 4307 18BE  F3          	DI
 4308 18BF  2A 01EA     	LD	HL,(01EAH)	; Interrupt CTC Kanal 1 - Kassettenausgabe
 4309 18C2  22 004F     	LD	(U003F),HL	; hier merken
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  65
BAC85   Z80

 4310 18C5  21 1A98     	LD	HL,ISRC1	; neue ISR
 4311 18C8  22 01EA     	LD	(01EAH),HL	; fuer CTC1 eintragen
 4312 18CB  AF          	XOR	A
 4313 18CC  32 01F0     	LD	(U01F0),A	; (IX+0) Zeitkonstante Kassettenroutinen
 4314 18CF  18 D9       	JR	U190F
 4315                   ;
 4316                   ; Synchronisation mit Frequenzmessung
 4317                   ; PA:	Z=0	Taste gedrueckt
 4318                   ;	B'	Schwingungen fuer "1"
 4319                   ;	C'	Schwingungen fuer "0"
 4320                   ;	H'=0	Startwert fuer Pruefsummenberechnung
 4321                   ;
 4322 18D1  D9          BCSYN:	EXX
 4323 18D2  01 0D10     BCY1:	LD	BC,0D10H	; ca. 0.7 sek Tondauer bei 2400Hz
 4324 18D5  5A          BCY2:	LD	E,D
 4325 18D6  CD 062E     	CALL	U0622		; Taste gedrueckt?
 4326 18D9  C0          	RET	NZ		; ja
 4327 18DA  CD 19E4     	CALL	BCBY		; eine Schwingung messen
 4328 18DD  57          	LD	D,A
 4329 18DE  C6 04       	ADD	A,4
 4330 18E0  BB          	CP	E
 4331 18E1  38 EF       	JR	C,BCY1		; ausser Toloeranz (+5)
 4332 18E3  D6 09       	SUB	9
 4333 18E5  BB          	CP	E
 4334 18E6  30 EA       	JR	NC,BCY1		; ausser Toleranz (-5)
 4335 18E8  ED A1       	CPI			; wie DEC BC
 4336 18EA  EA 18D5     	JP	PE,BCY2		; wdh. bis BC=0
 4337 18ED  60          	LD	H,B
 4338 18EE  68          	LD	L,B		; HL=0
 4339 18EF  50          	LD	D,B		; D=0
 4340 18F0  CD 062E     BCY3:	CALL	U0622		; Taste gedrueckt?
 4341 18F3  C0          	RET	NZ		; ja
 4342 18F4  CD 19E4     	CALL	BCBY		; eine Schwingung messen
 4343 18F7  5F          	LD	E,A
 4344 18F8  19          	ADD	HL,DE		; addieren
 4345 18F9  10 F5       	DJNZ	BCY3		; 256 Messungen addieren
 4346 18FB  E5          	PUSH	HL
 4347 18FC  7C          	LD	A,H
 4348 18FD  CB 3C       	SRL	H		; /2
 4349 18FF  84          	ADD	H
 4350 1900  47          	LD	B,A		; B=1.5 Schwingungen	"1"
 4351 1901  CB 3C       	SRL	H
 4352 1903  84          	ADD	H
 4353 1904  4F          	LD	C,A		; C=1.75 Schwingungen	"0"
 4354 1905  26 00       	LD	H,0		; Startwert fuer Pruefsummenberechnung in H'
 4355 1907  D9          	EXX
 4356 1908  E1          	POP	HL
 4357 1909  7C          	LD	A,H
 4358 190A  FE 45       	CP	45H
 4359 190C  38 05       	JR	C,U1B2F
 4360 190E  21 1CAE     	LD	HL,U1CC2	; Text "Ein sehr schwaches Kassetteninterface..."
 4361 1911  18 03       	JR	U1B32		; anzeigen
 4362                   
 4363 1913  21 1B62     U1B2F:	LD	HL,U1B76	; Text 'Ich lese BASICODE'
 4364 1916  C3 1A51     U1B32:	JP	U1AE5		; anzeigen
 4365                   ;
 4366                   ; Nachton ausgeben, ca. 1 Sekunde
 4367                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  66
BAC85   Z80

 4368 1919  C5          NTON:	PUSH	BC
 4369 191A  01 C012     	LD	BC,0C012H	; ca. 1 sek
 4370 191D  18 0C       	JR	BCTON
 4371                   ;
 4372                   ; Vorton ausgeben, ca. 5 Sekunden
 4373                   ;
 4374 191F  C5          VTON:	PUSH	BC
 4375 1920  01 C05D     	LD	BC,0C05DH	; ca. 5 Sekunden
 4376 1923  3E 85       	LD	A,85H
 4377 1925  D3 8D       	OUT	(CTC1),A	; Zeitgeber, VT=16, ZK folgt
 4378 1927  3E 17       	LD	A,17H		; ZK fuer 2400Hz
 4379 1929  D3 8D       	OUT	(CTC1),A
 4380 192B  3A 01F0     BCTON:	LD	A,(U01F0)	; Zeitkonstante
 4381 192E  B7          	OR	A
 4382 192F  20 FA       	JR	NZ,BCTON	; warten, bis von ISR 0 eingetragen ist
 4383 1931  3E 01       	LD	A,1
 4384 1933  32 01F0     	LD	(U01F0),A	; wieder auf 1 setzen
 4385 1936  10 F3       	DJNZ	BCTON
 4386 1938  0D          	DEC	C
 4387 1939  20 F0       	JR	NZ,BCTON	; wiederholen
 4388 193B  3E FF       	LD	A,0FFH
 4389 193D  32 01F0     	LD	(U01F0),A	; und noch weitere 255 Schwingungen
 4390 1940  C1          	POP	BC
 4391 1941  C9          	RET
 4392                   ;
 4393                   ; Ein Byte BASICODE lesen
 4394                   ; PA:	Z=0	Taste gedrueckt
 4395                   ;	CY=1	Fehler
 4396                   ;
 4397 1942  D9          BCIN:	EXX
 4398 1943  2E 00       	LD	L,0
 4399 1945  5D          	LD	E,L		; E=0
 4400 1946  CD 062E     BCI1:	CALL	U0622		; Taste gedrueckt?
 4401 1949  C0          	RET	NZ		; ja
 4402 194A  2D          	DEC	L
 4403 194B  28 4B       	JR	Z,BCI6		; 256 mal kein Startbit gelesen
 4404 194D  CD 19EF     	CALL	BCHB		; Zeit abwarten
 4405 1950  57          	LD	D,A
 4406 1951  83          	ADD	E
 4407 1952  5A          	LD	E,D
 4408 1953  B9          	CP	C
 4409 1954  38 F0       	JR	C,BCI1		; kein Startbit
 4410 1956  CB 3F       	SRL	A
 4411 1958  B9          	CP	C
 4412 1959  30 EB       	JR	NC,BCI1		; kein Startbit
 4413 195B  1E 80       	LD	E,80H
 4414 195D  2E 00       	LD	L,0
 4415 195F  7D          BCI2:	LD	A,L
 4416 1960  B7          	OR	A
 4417 1961  CC 19EF     	CALL	Z,BCHB		; Bit lesen
 4418 1964  2E 00       	LD	L,0
 4419 1966  B8          	CP	B
 4420 1967  30 1D       	JR	NC,BCI5		; "0" einschieben
 4421 1969  57          	LD	D,A
 4422 196A  CD 19EF     	CALL	BCHB		; Bit lesen
 4423 196D  82          	ADD	D
 4424 196E  B9          	CP	C
 4425 196F  30 15       	JR	NC,BCI5		; "0" einschieben
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  67
BAC85   Z80

 4426 1971  B8          	CP	B
 4427 1972  38 06       	JR	C,BCI3
 4428 1974  CD 19EF     	CALL	BCHB		; Bit lesen
 4429 1977  87          	ADD	A
 4430 1978  18 03       	JR	BCI4
 4431                   	;
 4432 197A  CD 19E4     BCI3:	CALL	BCBY		; eine Schwingung messen
 4433 197D  B8          BCI4:	CP	B
 4434 197E  38 06       	JR	C,BCI5		; "1" einschieben
 4435 1980  D6 17       	SUB	17H
 4436 1982  CB 3F       	SRL	A
 4437 1984  6F          	LD	L,A
 4438 1985  37          	SCF			; "1"
 4439 1986  CB 1B       BCI5:	RR	E		; Bit einschieben
 4440 1988  30 D5       	JR	NC,BCI2		; 8 Bit einlesen
 4441 198A  7B          	LD	A,E
 4442 198B  AC          	XOR	H		; Pruefsumme berechnen in H'
 4443 198C  67          	LD	H,A
 4444 198D  7B          	LD	A,E
 4445 198E  EE 80       	XOR	80H		; Bit 7 invertieren
 4446 1990  CD 0935     	CALL	U09DD		; Zeichen in unterste Zeile malen
 4447 1993  CD 062E     	CALL	U0622		; Taste gedrueckt?
 4448 1996  D9          	EXX
 4449 1997  C9          	RET			; Z=0, wenn Taste gedrueckt wurde
 4450                   	;
 4451 1998  D9          BCI6:	EXX
 4452                   ;
 4453                   ; Dateiarbeit, ungenutzte Routinen
 4454                   ; NF=4..7
 4455                   ;
 4456 1999  37          U09AC:	SCF			; Fehler-Kennung
 4457 199A  C9          	RET
 4458                   ;
 4459                   ; Pruefbyte (H') ausgeben
 4460                   ;
 4461 199B  D9          BCPRO:	EXX
 4462 199C  7C          	LD	A,H		; Pruefbyte
 4463 199D  EE 80       	XOR	80H
 4464 199F  D9          	EXX
 4465                   ;
 4466                   ; Datenbyte ausgeben im BASICODE-Format
 4467                   ;
 4468 19A0  D9          BCOUT:	EXX
 4469 19A1  CD 0935     	CALL	U09DD		; Zeichen malen
 4470 19A4  EE 80       	XOR	80H		; Bit 7 negieren
 4471 19A6  4F          	LD	C,A		; Zeichen
 4472 19A7  06 09       	LD	B,9		; insgesamt 9 Bit mit Startbit
 4473 19A9  AC          	XOR	H		; Pruefsumme nebenbei mit berechnen
 4474 19AA  67          	LD	H,A
 4475 19AB  CB 21       	SLA	C		; Startbit "0" einschieben
 4476 19AD  3A 01F0     BCO1:	LD	A,(U01F0)	; (IX+0)
 4477 19B0  3C          	INC	A
 4478 19B1  3D          	DEC	A		; CY bleibt unveraendert
 4479 19B2  20 F9       	JR	NZ,BCO1		; warten, bis 0 eingetragen ist
 4480 19B4  3E 85       	LD	A,85H
 4481 19B6  D3 8D       	OUT	(CTC1),A	; neue ZK ankuendigen
 4482 19B8  CB 19       	RR	C
 4483 19BA  30 08       	JR	NC,BCO2	; Bit 0 oder 1?
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  68
BAC85   Z80

 4484 19BC  3E 17       	LD	A,17H		; ZK fuer 2400Hz
 4485 19BE  D3 8D       	OUT	(CTC1),A
 4486 19C0  3E 04       	LD	A,4		; 2 Schwingungen
 4487 19C2  18 06       	JR	BCO3
 4488                   	;
 4489 19C4  3E 2E       BCO2:	LD	A,2EH		; ZK fuer 1200Hz
 4490 19C6  D3 8D       	OUT	(CTC1),A
 4491 19C8  3E 02       	LD	A,2		; 1 Schwingung
 4492 19CA  32 01F0     BCO3:	LD	(U01F0),A	; (IX+0)
 4493 19CD  10 DE       	DJNZ	BCO1
 4494 19CF  3A 01F0     BCO4:	LD	A,(U01F0)	; (IX+0)
 4495 19D2  B7          	OR	A
 4496 19D3  20 FA       	JR	NZ,BCO4		; warten bis 0 eingetragen ist
 4497 19D5  3E 85       	LD	A,85H
 4498 19D7  D3 8D       	OUT	(CTC1),A	; neue ZK ankuendigen
 4499 19D9  3E 17       	LD	A,17H		; ZK fuer 2400Hz
 4500 19DB  D3 8D       	OUT	(CTC1),A
 4501 19DD  3E 08       	LD	A,8		; 4 Schwingungen = 2 Stoppbits
 4502 19DF  32 01F0     	LD	(U01F0),A
 4503 19E2  D9          	EXX
 4504 19E3  C9          	RET
 4505                   ;
 4506                   ; eine Schwingung messen (Addieden von 2 Halbwellen)
 4507                   ;
 4508 19E4  D5          BCBY:	PUSH	DE
 4509 19E5  CD 19EF     	CALL	BCHB		; erste Halbwelle
 4510 19E8  5F          	LD	E,A
 4511 19E9  CD 19EF     	CALL	BCHB		; zweite Halbwelle
 4512 19EC  83          	ADD	A,E		; addieren
 4513 19ED  D1          	POP	DE
 4514 19EE  C9          	RET
 4515                   ;
 4516                   ; Warten auf Flankenwechsel am PIO
 4517                   ;
 4518 19EF  AF          BCHB:	XOR	A
 4519 19F0  32 01F0     	LD	(U01F0),A	; (IX+0) auf 0 setzen
 4520 19F3  DB 88       BCHW:	IN	A,(PIOAD)
 4521 19F5  D3 88       	OUT	(PIOAD),A	; PIO freigeben
 4522 19F7  3A 01F0     	LD	A,(U01F0)
 4523 19FA  B7          	OR	A
 4524 19FB  28 F6       	JR	Z,BCHW		; Warten, bis Zeit eingetragen ist
 4525 19FD  C9          	RET
 4526                   ;
 4527                   ; Zeichen im ASCII-Speicher ablegen und auf Bildschirm malen
 4528                   ;	
 4529 19FE  F5          U1A8A:	PUSH	AF		; Zeichen
 4530 19FF  3A 003B     	LD	A,(FLAGS)
 4531 1A02  CB 77       	BIT	6,A		; unerlaubter Befehl?
 4532 1A04  28 11       	JR	Z,U1AA3
 4533 1A06  E6 BF       	AND	0BFH		; Bit 6 ruecksetzen
 4534 1A08  32 003B     	LD	(FLAGS),A
 4535 1A0B  0B          	DEC	BC
 4536 1A0C  0A          	LD	A,(BC)		; letztes Zeichen
 4537 1A0D  03          	INC	BC
 4538 1A0E  FE 3A       	CP	':'		; war das ein Doppelpunkt?
 4539 1A10  28 05       	JR	Z,U1AA3
 4540 1A12  3E 20       	LD	A,' '		; danach immer ein Leerzeichen
 4541 1A14  CD 1A18     	CALL	U1AA4		; eintragen, dann reinlaufen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  69
BAC85   Z80

 4542 1A17  F1          U1AA3:	POP	AF
 4543 1A18  02          U1AA4:	LD	(BC),A		; Zeichen in ASCII-File schreiben
 4544 1A19  03          	INC	BC		; Zeiger weiter ruecken
 4545         0000      IF KC3
 4555                   ELSE
 4556 1A1A  08          	EX	AF,AF'
 4557 1A1B  3C          	INC	A		; Zeichen zaehlen
 4558 1A1C  08          	EX	AF,AF'
 4559 1A1D  C3 0935     	JP	U09DD		; Zeichen malen
 4560                   ENDIF
 4561                   
 4562                   ;
 4563                   ; Test: ASCII-File und BASIC-Programm im Speicher?
 4564                   ;
 4565 1A20  21 212C     U1AB5:	LD	HL,Z1000	; Anfang BASIC-Programm
 4566                   ;	LD	D,A		; ???
 4567 1A23  5E          	LD	E,(HL)
 4568 1A24  23          	INC	HL
 4569 1A25  7E          	LD	A,(HL)
 4570 1A26  2B          	DEC	HL
 4571 1A27  B3          	OR	E
 4572                   ;	LD	A,D		; ???
 4573 1A28  3E 01       	LD	A,1		; A=1 (BASIC-Programm im Speicher)
 4574 1A2A  20 01       	JR	NZ,U1AC4
 4575 1A2C  3D          	DEC	A		; A=0 (kein BASIC-Programm im Speicher)
 4576 1A2D  4F          U1AC4:	LD	C,A
 4577 1A2E  3A 003B     	LD	A,(FLAGS)
 4578 1A31  E6 02       	AND	2		; Bi1 1: ASCII-File im Speicher?
 4579 1A33  28 0E       	JR	Z,U1ADA		; nein
 4580 1A35  2A 0045     	LD	HL,(U0031)	; Beginn ASCII-File
 4581 1A38  ED 5B 03D7  	LD	DE,(SVARPT)	; BASIC-Programmende+1
 4582 1A3C  CD C689     	CALL	CPREG		; Vergleiche Register DE mit HL
 4583 1A3F  38 02       	JR	C,U1ADA		; BASIC-Programm hat ASCII ueberschrieben!
 4584 1A41  CB C9       	SET	1,C		; ASCII-File im Speicher
 4585 1A43  79          U1ADA:	LD	A,C
 4586 1A44  C9          	RET
 4587                   	
 4588 1A45  21 1C45     U1ADC:	LD	HL,U1C59	; Text 'kein ASCII-File im Speicher!'
 4589 1A48  CD 1A51     	CALL	U1AE5		; anzeigen
 4590 1A4B  C3 C08C     	JP	SECST		; RESTART BASIC-Interpreter
 4591                   ;
 4592                   ; Anzeige 'Speicher voll'
 4593                   ;
 4594 1A4E  21 1B74     U0ECA:	LD	HL,U1B88	; Text 'Speichergrenze erreicht!'
 4595                   ;	JP	U1AE5		; anzeigen
 4596                   ;
 4597                   ; Zeichenkette anzeigen, welche in (HL) uebergeben wird
 4598                   ; Das erste Byte gibt dabei die Anzahl der folgenden Zeichen an
 4599                   ;
 4600 1A51  E5          U1AE5:	PUSH	HL
 4601 1A52  2A 0358     	LD	HL,(CULINO)	; aktuelle Zeilennummer
 4602 1A55  23          	INC	HL
 4603 1A56  7C          	LD	A,H
 4604 1A57  B5          	OR	L		; Zeilennummer=0?
 4605 1A58  E1          	POP	HL
 4606 1A59  20 0B       	JR	NZ,U1AFA	; wir befinden und im Programm
 4607                   ; im Direktmode normal anzeigen
 4608 1A5B  46          	LD	B,(HL)		; Anzahl
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  70
BAC85   Z80

 4609 1A5C  23          U1AF0:	INC	HL
 4610 1A5D  7E          	LD	A,(HL)		; Zeichen
 4611 1A5E  CD DDD5     	CALL	CO		; anzeigen
 4612 1A61  10 F9       	DJNZ	U1AF0
 4613 1A63  C3 CB61     	JP	CRWDY2		; Anzeige CR, LF, Dummyzeichen
 4614                   ; im Programmmode auf untere Zeile malen
 4615 1A66  CD 0917     U1AFA:	CALL	U09AE		; IRM-Adresse auf links/unten einstellen
 4616 1A69  46          	LD	B,(HL)		; Anzahl
 4617 1A6A  48          	LD	C,B
 4618 1A6B  23          U1AFF:	INC	HL
 4619 1A6C  7E          	LD	A,(HL)		; Zeichen
 4620 1A6D  CD 0935     	CALL	U09DD		; in unterste Zeile malen
 4621 1A70  10 F9       	DJNZ	U1AFF
 4622 1A72  3E 28       	LD	A,28H
 4623 1A74  91          	SUB	C
 4624 1A75  47          	LD	B,A
 4625 1A76  3E 20       	LD	A,20H
 4626 1A78  CD 0935     U1B0C:	CALL	U09DD		; Zeichen malen
 4627 1A7B  10 FB       	DJNZ	U1B0C
 4628 1A7D  C9          	RET
 4629                   ;
 4630                   ; ISR PIO-A (Kassetteneingabe)
 4631                   ;
 4632 1A7E  F5          ISRPA:	PUSH	AF
 4633 1A7F  DB 8E       	IN	A,(CTC2)	; aktueller Zaehlerstand
 4634 1A81  ED 44       	NEG
 4635 1A83  32 01F0     	LD	(U01F0),A	; Ablage der Zeit auf (IX+0)
 4636 1A86  3E 07       	LD	A,7
 4637 1A88  D3 8E       	OUT	(CTC2),A	; CTC ruecksetzen, neue ZK
 4638 1A8A  3E FC       	LD	A,0FCH
 4639 1A8C  D3 8E       	OUT	(CTC2),A	; ZK laden
 4640 1A8E  DB 88       	IN	A,(PIOAD)
 4641 1A90  EE 20       	XOR	20H		; LED ein/aus
 4642 1A92  D3 88       	OUT	(PIOAD),A
 4643 1A94  F1          IRET:	POP	AF
 4644 1A95  FB          	EI
 4645 1A96  ED 4D       	RETI
 4646                   ;
 4647                   ; ISR CTC Kanal 1 (Kassettenausgabe)
 4648                   ; (IX+0) decrementieren
 4649                   ;
 4650 1A98  F5          ISRC1:	PUSH	AF
 4651 1A99  3A 01F0     	LD	A,(U01F0)	; schneller als DEC (IX+0)
 4652 1A9C  3D          	DEC	A		; 18 statt 23 Takte
 4653 1A9D  32 01F0     	LD	(U01F0),A	; (IX+0)
 4654 1AA0  18 F2       	JR	IRET		; POP AF, EI, RETI
 4655                   ;
 4656                   ; ISR CTC Kanal 2 (Ton)-Dauer und Kassetteneingabe
 4657                   ;
 4658 1AA2  F5          ISRC2:	PUSH	AF
 4659 1AA3  E5          	PUSH	HL
 4660 1AA4  2A 005A     	LD	HL,(U004A)	; Zaehler
 4661 1AA7  2B          	DEC	HL		; decrementieren
 4662 1AA8  22 005A     	LD	(U004A),HL	; und zurueckschreiben
 4663 1AAB  7C          	LD	A,H
 4664 1AAC  B5          	OR	L		; Zaehler=0?
 4665 1AAD  20 0A       	JR	NZ,ISRCO	; nein
 4666 1AAF  3E 03       	LD	A,3
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  71
BAC85   Z80

 4667 1AB1  D3 8D       	OUT	(CTC1),A	; CTC1 stoppen
 4668 1AB3  3E 47       	LD	A,47H
 4669 1AB5  D3 8E       	OUT	(CTC2),A	; CTC2 neu starten
 4670 1AB7  D3 8E       	OUT	(CTC2),A	; mit dieser Zeitkonstante
 4671 1AB9  E1          ISRCO:	POP	HL
 4672 1ABA  18 D8       	JR	IRET		; POP AF, EI, RETI
 4673                   ;
 4674                   ; 02.01.2024: Kopie einer Tastaturtabelle direkt hier im Programm
 4675                   ; diese KTAB deaktiviert STOP- und BRK-Taste
 4676                   ;
 4677 1ABC  57 77       KTAB2:	DB	'Ww'		;		00 01
 4678 1ABE  41 61       	DB	'Aa'		;		02 03
 4679 1AC0  32 22       	DB	'2"'		;		04 05
 4680 1AC2  08 19       	DB	8,19H		; CUL		06 07
 4681 1AC4  10 0C       	DB	10H,0CH		; HOME		08 09
 4682 1AC6  2D 3D       	DB	'-='		;		0A 0B
 4683 1AC8  F2 F8       	DB	0F2H,0F8H	; F2		0C 0D
 4684 1ACA  59 79       	DB	'Yy'		;		0E 0F	
 4685 1ACC  45 65       	DB	'Ee'		;		10 11
 4686 1ACE  53 73       	DB	'Ss'		;		12 13
 4687 1AD0  33 23       	DB	'3#'		;		14 15
 4688 1AD2  5E 5D       	DB	'^]'		;		16 17
 4689 1AD4  01 0F       	DB	1,0FH		; CLR		18 19
 4690 1AD6  3A 2A       	DB	':*'		;		1A 1B
 4691 1AD8  F3 F9       	DB	0F3H,0F9H	; F3		1C 1D
 4692 1ADA  58 78       	DB	'Xx'		;		1E 1F
 4693 1ADC  54 74       	DB	'Tt'		;		20 21
 4694 1ADE  46 66       	DB	'Ff'		;		22 23
 4695 1AE0  35 25       	DB	'5%'		;		24 25
 4696 1AE2  50 70       	DB	'Pp'		;		26 27
 4697 1AE4  1F 02       	DB	1FH,2		; DEL		28 29
 4698 1AE6  30 40       	DB	'0',40H		;		2A 2B
 4699 1AE8  F5 FB       	DB	0F5H,0FBH	; F5		2C 2D
 4700 1AEA  56 76       	DB	'Vv'		;		2E 2F
 4701 1AEC  55 75       	DB	'Uu'		;		30 31
 4702 1AEE  48 68       	DB	'Hh'		;		32 33
 4703 1AF0  37 27       	DB	'7',27H		; 7 / Apostroph	34 35
 4704 1AF2  4F 6F       	DB	'Oo'		;		36 37
 4705 1AF4  1A 14       	DB	1AH,14H		; INS		38 39
 4706 1AF6  39 29       	DB	'9)'		;		3A 3B
 4707 1AF8  00 00       	DB	0,0		; BRK		3C 3D
 4708 1AFA  4E 6E       	DB	'Nn'		;		3E 3F
 4709 1AFC  49 69       	DB	'Ii'		;		40 41
 4710 1AFE  4A 6A       	DB	'Jj'		;		42 43
 4711 1B00  38 28       	DB	'8('		;		44 45
 4712 1B02  20 5B       	DB	' ['		; SPC		46 47
 4713 1B04  4B 6B       	DB	'Kk'		;		48 49
 4714 1B06  2C 3C       	DB	',<'		;		4A 4B
 4715         0000      IF KC3
 4717                   ELSE
 4718 1B08  00 1B       	DB	0,ESC		; STOP		4C 4D
 4719                   ENDIF
 4720 1B0A  4D 6D       	DB	'Mm'		;		4E 4F
 4721 1B0C  5A 7A       	DB	'Zz'		;		50 51
 4722 1B0E  47 67       	DB	'Gg'		;		52 53
 4723 1B10  36 26       	DB	'6&'		;		54 55
 4724 1B12  1C 1D       	DB	1CH,1DH		; LIST/RUN	56 57
 4725 1B14  4C 6C       	DB	'Ll'		;		58 59
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  72
BAC85   Z80

 4726 1B16  2E 3E       	DB	'.>'		;		5A 5B
 4727 1B18  F6 FC       	DB	0F6H,0FCH	; F6		5C 5D
 4728 1B1A  42 62       	DB	'Bb'		;		5E 5F
 4729 1B1C  52 72       	DB	'Rr'		;		60 61
 4730 1B1E  44 64       	DB	'Dd'		;		62 63
 4731 1B20  34 24       	DB	'4$'		;		64 65
 4732 1B22  5F 5C       	DB	'_\'		;		66 67
 4733 1B24  2B 3B       	DB	'+;'		;		68 69
 4734 1B26  2F 3F       	DB	'/?'		;		6A 6B
 4735 1B28  F4 FA       	DB	0F4H,0FAH	; F4		6C 6D
 4736 1B2A  43 63       	DB	'Cc'		;		6E 6F
 4737 1B2C  51 71       	DB	'Qq'		;		70 71
 4738 1B2E  16 05       	DB	16H,5		; CAPS		72 73
 4739 1B30  31 21       	DB	'1!'		;		74 75
 4740 1B32  0A 12       	DB	LF,12H		; CUD		76 77
 4741 1B34  0B 11       	DB	0BH,11H		; CUU		78 79
 4742 1B36  09 18       	DB	9,18H		; CUR		7A 7B
 4743 1B38  F1 F7       	DB	0F1H,0F7H	; F1		7C 7D
 4744 1B3A  0D 0E       	DB	CR,0EH		; ENTER		7E 7F
 4745                   ;
 4746                   ; Zeichenketten, jeweils erst die Anzahl der Bytes, dann der Text
 4747                   ;
 4748 1B3C  12 42 69 74 U1B50:	DB	18,'Bitte Band starten'
 4749 1B4F  12 42 69 74 U1B63:	DB	18,'Bitte Band stoppen'
 4750 1B62  11 49 63 68 U1B76:	DB	17,'Ich lese BASICODE'
 4751 1B74  18 53 70 65 U1B88:	DB	24,'Speichergrenze erreicht!'
 4752 1B8D  13 4C 65 73 U1BA1:	DB	19,'Lesefehler erkannt!'
 4753 1BA1  24 4C 65 73 U1BB5:	DB	36,'Lesefehler in Block '
 4754 1BB6  20 20 21 20 U1BCA:	DB	'  ! zurueck? J/N'
 4755 1BC6  23 66 61 6C U1BDA:	DB	35,'falsche Blocknummer '
 4756 1BDB  20 20 3B 20 U1BEF:	DB	'  ; erwarte '
 4757 1BE7  20 20 21    U1BFB:	DB	'  !'
 4758 1BEA  17 6B 65 69 U1BFE:	DB	23,'kein BASICODE-Programm!'
 4759 1C02  16 6B 65 69 U1C16:	DB	22,'kein BASICODE-Bestand!'		; keine BASICODE-Datei
 4760 1C19  1C 75 6E 65 U1C2D:	DB	28,'unerlaubter BASICODE-Befehl!'
 4761 1C36  0E 52 65 67 U1C4A:	DB	14,'Regelverstoss!'
 4762 1C45  1C 6B 65 69 U1C59:	DB	28,'kein ASCII-File im Speicher!'
 4763 1C62  19 50 72 6F U1C76:	DB	25,'Programm wurde geloescht!'
 4764 1C7C  1A 6B 65 69 U1C90:	DB	26,'kein Programm im Speicher!'
 4765 1C97  16 42 65 73 U1CAB:	DB	22,'Bestaende geschlossen!'		; Dateien geschlossen
 4766 1CAE  28 45 69 6E U1CC2:	DB	40,'Ein sehr schwaches Kassetteninterface...'
 4767 1CD7  4E 61 6D 65 	DB	'Name: ',0
 4768 1CDE  5A 65 69 6C U1CF2:	DB	'Zeile ',0
 4769 1CE5  20 69 73 74 U1CF9:	DB	' ist zu lang'
 4770 1CF1  0D 0A 00    U1D05:	DB	CR,LF,0
 4771 1CF4  08 20 08    U1D08:	DB	8,' ',8
 4772 1CF7  4C 4F 47 80 U1D0B:	DB	'LOG',80H
 4773 1CFB  20 42 79 74 U1D0F:	DB	' Bytes',CR,LF,0
 4774 1D04  0D 0A 50 72 U1D18:	DB	CR,LF,'Programm:',0
 4775 1D10  41 53 43 2D U1D24:	DB	'ASC-File:',0
 4776 1D1A  46 72 65 69 U1D2E:	DB	'Frei    :',0
 4777 1D24  0D 0A 20 2A U1D38:	DB	CR,LF,' *  - BASICODE-Menu'
 4778 1D39  0D 0A 20 2A 	DB	CR,LF,' *L - Laden, Uebersetzen und Starten'
 4779 1D5F  0D 0A 20 2A 	DB	CR,LF,' *A - Einlesen ASCII-File'
 4780 1D7A  0D 0A 20 2A 	DB	CR,LF,' *W - Retten ASCII-File'
 4781 1D93  0D 0A 20 2A 	DB	CR,LF,' *T - Uebersetzen ASCII-File ==> BASIC'
 4782 1DBB  0D 0A 20 2A 	DB	CR,LF,' *C - Uebersetzen BASIC ==> ASCII-File'
 4783 1DE3  0D 0A 20 2A 	DB	CR,LF,' *K - Listen ASCII-File'
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  73
BAC85   Z80

 4784 1DFC  0D 0A 00    	DB	CR,LF,0
 4785                   ;
 4786                   ; erlaubte Token im BASICODE-Programm
 4787                   ;
 4788 1DFF  B8          U1E13:	DB	0B8H	; ABS
 4789 1E00  B1          	DB	0B1H	; AND
 4790 1E01  CB          	DB	0CBH	; ASC
 4791 1E02  C4          	DB	0C4H	; ATN
 4792 1E03  CC          	DB	0CCH	; CHR$
 4793 1E04  C1          	DB	0C1H	; COS
 4794 1E05  83          	DB	83H	; DATA
 4795 1E06  94          	DB	94H	; DEF
 4796 1E07  85          	DB	85H	; DIM
 4797 1E08  C0          	DB	0C0H	; EXP
 4798 1E09  A7          	DB	0A7H	; FN
 4799 1E0A  81          	DB	81H	; FOR
 4800 1E0B  8A          	DB	8AH	; IF
 4801 1E0C  84          	DB	84H	; INPUT
 4802 1E0D  B7          	DB	0B7H	; INT
 4803 1E0E  CD          	DB	0CDH	; LEFT$
 4804 1E0F  C8          	DB	0C8H	; LEN
 4805 1E10  87          	DB	87H	; LET
 4806 1E11  BF          	DB	0BFH	; LN
 4807 1E12  CF          	DB	0CFH	; MID$
 4808 1E13  AA          	DB	0AAH	; NOT
 4809 1E14  91          	DB	91H	; ON
 4810 1E15  B2          	DB	0B2H	; OR
 4811 1E16  9E          	DB	9EH	; PRINT
 4812 1E17  86          	DB	86H	; READ
 4813 1E18  8D          	DB	8DH	; RETURN
 4814 1E19  CE          	DB	0CEH	; RIGHT$
 4815 1E1A  B6          	DB	0B6H	; SGN
 4816 1E1B  C2          	DB	0C2H	; SIN
 4817 1E1C  BD          	DB	0BDH	; SQR
 4818 1E1D  A5          	DB	0A5H	; TAB(
 4819 1E1E  C3          	DB	0C3H	; TAN
 4820 1E1F  CA          	DB	0CAH	; VAL
 4821 1E20  AC          	DB	0ACH	; +
 4822 1E21  AD          	DB	0ADH	; -
 4823 1E22  AE          	DB	0AEH	; *
 4824 1E23  AF          	DB	0AFH	; /
 4825 1E24  B0          	DB	0B0H	; ^
 4826 1E25  B3          	DB	0B3H	; >
 4827 1E26  B4          	DB	0B4H	; =
 4828 1E27  B5          	DB	0B5H	; <
 4829 1E28  8C          U1E3C:	DB	8CH	; GOSUB
 4830 1E29  88          	DB	88H	; GOTO
 4831 1E2A  AB          	DB	0ABH	; STEP
 4832 1E2B  A9          	DB	0A9H	; THEN
 4833 1E2C  A6          	DB	0A6H	; TO
 4834                   ;
 4835                   ; vordefinierte Variablen fuer Laufzeit
 4836                   ;
 4837 1E2D  484F        U1E41:	DW	'HO'
 4838 1E2F  0000        	DW	0
 4839 1E31  861C        	DW	861CH	; 39
 4840                   
 4841 1E33  5645        	DW	'VE'
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  74
BAC85   Z80

 4842 1E35  0000        	DW	0
 4843 1E37  8578        	DW	8578H	; 31
 4844                   
 4845 1E39  494E        	DW	'IN'
 4846 1E3B  0000        	DW	0
 4847 1E3D  0000        	DW	0	; 0
 4848                   
 4849 1E3F  49CE        	DW	'IN'+80H	; IN$
 4850 1E41  0000        	DW	0
 4851 1E43  8420        	DW	8420H	; 10
 4852                   
 4853 1E45  53D2        	DW	'SR'+80H	; SR$
 4854 1E47  0000        	DW	0
 4855 1E49  8100        	DW	8100H	; 1
 4856                   
 4857 1E4B  434E        	DW	'CN'
 4858 1E4D  0000        	DW	0
 4859 1E4F  0000        	DW	0	; 0
 4860                   
 4861 1E51  4847        	DW	'HG'
 4862 1E53  0000        	DW	0
 4863 1E55  8920        	DW	8920H	; 320
 4864                   
 4865 1E57  5647        	DW	'VG'
 4866 1E59  0000        	DW	0
 4867 1E5B  8870        	DW	8870H	; 240
 4868                   ;
 4869                   ; Sprungverteiler zum Oeffnen einer Datei
 4870                   ;
 4871 1E5D  169F        U1E71:	DW	U172D	; NF=0	BASICODE lesen
 4872 1E5F  1742        	DW	U17B9	; NF=1	BASICODE schreiben
 4873 1E61  0856        	DW	U0829	; NF=2	KC-Format lesen (TAPE)
 4874 1E63  08CE        	DW	U0915	; NF=3	KC-Format schreiben (TAPE)
 4875         0000      if DEV
 4880                   ELSE
 4881 1E65  1999        	DW	U09AC	; SCF, RET (kein weiterer Treiber)
 4882 1E67  1999        	DW	U09AC	; SCF, RET (kein weiterer Treiber)
 4883 1E69  1999        	DW	U09AC	; SCF, RET (kein weiterer Treiber)
 4884 1E6B  1999        	DW	U09AC	; SCF, RET (kein weiterer Treiber)
 4885                   ENDIF
 4886                   ;
 4887                   ; Sprungverteiler zum Schliessen einer Datei
 4888                   ;
 4889 1E6D  16F2        U1E81:	DW	U1769	; NF=0	BASICODE lesen
 4890 1E6F  16DB        	DW	U17D7	; NF=1	BASICODE schreiben
 4891 1E71  0870        	DW	U0864	; NF=2	KC-Format lesen (TAPE)
 4892 1E73  0911        	DW	U099A	; NF=3	KC-Format schreiben (TAPE)
 4893         0000      IF DEV
 4898                   ELSE
 4899 1E75  1999        	DW	U09AC	; SCF, RET (Lesen von Diskette)
 4900 1E77  1999        	DW	U09AC	; SCF, RET (Schreiben auf Diskette)
 4901 1E79  1999        	DW	U09AC	; SCF, RET (Lesen USB)
 4902 1E7B  1999        	DW	U09AC	; SCF, RET (Schreiben USB)
 4903                   ENDIF
 4904                   ;
 4905                   ; Sprungverteiler zum Datei Lesen/Schreiben (1 Byte)
 4906                   ;
 4907 1E7D  16AB        U1E91:	DW	U1739	; NF=0	BASICODE lesen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  75
BAC85   Z80

 4908 1E7F  174D        	DW	U17C4	; NF=1	BASICODE schreiben
 4909 1E81  0873        	DW	U0869	; NF=2	KC-Format lesen (TAPE)
 4910 1E83  08D8        	DW	U0946	; NF=3	KC-Format schreiben (TAPE)
 4911         0000      IF DEV
 4916                   ELSE
 4917 1E85  1999        	DW	U09AC	; SCF, RET (Lesen von Diskette)
 4918 1E87  1999        	DW	U09AC	; SCF, RET (Schreiben auf Diskette)
 4919 1E89  1999        	DW	U09AC	; SCF, RET (Lesen USB)
 4920 1E8B  1999        	DW	U09AC	; SCF, RET (Schreiben USB)
 4921                   ENDIF
 4922                   ;
 4923                   ; Sonderbefehle mit *
 4924                   ;
 4925 1E8D  4C 41 57 54 U1EA1:	DB	'LAWTCK'	; 6 Kennbuchstaben
 4926 1E93  107D        U1EA7:	DW	STAR_K		; *K
 4927 1E95  0EAF        	DW	STAR_C		; *C
 4928 1E97  0E76        	DW	STAR_T		; *T
 4929 1E99  0E46        	DW	STAR_W		; *W
 4930 1E9B  0DE0        	DW	STAR_A		; *A
 4931 1E9D  0D98        	DW	STAR_L		; *L
 4932 1E9F  0D44        	DW	STAR		; * Menu
 4933 1EA1  0DCB        	DW	CSAVE
 4934                   ;
 4935                   ; 4 Befehle, welche abgefangen werden
 4936                   ;
 4937 1EA3  43 4F 4E 54 U1EB7:	DB	'CONT',0
 4938 1EA8  47 4F 00    	DB	'GO',0
 4939 1EAB  52 55 4E 00 	DB	'RUN',0
 4940 1EAF  43 53 41 56 	DB	'CSAVE',0
 4941                   
 4942 1EB5  00          	NOP
 4943                   ;
 4944                   ; Farbe entsprechend Variable CC(0) und CC(1) einstellen
 4945                   ;
 4946 1EB6  2A 03DB     U1ECA:	LD	HL,(FSLPTR)	; erste freie Adresse hinter den Variablen
 4947 1EB9  ED 5B 03D9  	LD	DE,(DVARPT)	; Liste der Feldvariablen
 4948 1EBD  ED 52       	SBC	HL,DE		; Groesse des Variablenbereiches
 4949 1EBF  44          	LD	B,H
 4950 1EC0  4D          	LD	C,L
 4951 1EC1  03          	INC	BC		; Suchbereich
 4952 1EC2  EB          	EX	DE,HL
 4953 1EC3  3E 43       U1ED7:	LD	A,'C'
 4954 1EC5  ED B1       	CPIR			; 'C' im Variablenbereich suchen
 4955 1EC7  EA 1ECB     	JP	PE,U1EE0	; gefunden
 4956                   ; 16.11.2023: Farbe nicht veraendern, wenn CC nicht definiert ist
 4957                   ;	JR	U1F0B		; ausgesucht
 4958 1ECA  C9          	RET			; CC nicht definiert -> Farbe nicht aendern
 4959                   	;
 4960 1ECB  7E          U1EE0:	LD	A,(HL)		; folgendes Zeichen
 4961 1ECC  FE 43       	CP	'C'		; folgt noch ein 'C'?
 4962 1ECE  28 02       	JR	Z,U1EE7		; ja
 4963 1ED0  18 F1       	JR	U1ED7		; weitersuchen
 4964                   	;
 4965 1ED2              U1EE7:	; CC() gefunden
 4966 1ED2  23          	INC	HL
 4967 1ED3  23          	INC	HL
 4968 1ED4  23          	INC	HL
 4969 1ED5  23          	INC	HL
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  76
BAC85   Z80

 4970 1ED6  23          	INC	HL
 4971 1ED7  23          	INC	HL
 4972 1ED8  CD D6DD     	CALL	OPKOP		; Wert in Arithmetikregister 1 laden
 4973 1EDB  CD C96F     	CALL	EPRVL3		; Ausdruck berechnen -> DE
 4974 1EDE  7B          	LD	A,E		; Vordergrundfarbe aus CC(0)
 4975 1EDF  CB 27       	SLA	A	; *2
 4976 1EE1  CB 27       	SLA	A	; *4
 4977 1EE3  CB 27       	SLA	A	; *8
 4978                   ; 19.11.2023:
 4979                   ; Grafikfarbe wird ausschliesslich ueber CAOS-Arbeitszelle FARB ermittelt,
 4980                   ; keine Modifikation des Programmcodes mehr erforderlich
 4981                   ;	LD	(U078C+1),A	; Routine zum Linie zeichnen
 4982                   ;	LD	(U0744+1),A	; Routene zum Punkt setzen
 4983 1EE5  F5          	PUSH	AF
 4984 1EE6  CD D6DD     	CALL	OPKOP		; Wert in Arithmetikregister 1 laden
 4985 1EE9  CD C96F     	CALL	EPRVL3		; Ausdruck berechnen -> DE
 4986 1EEC  F1          	POP	AF		; Vordergrundfarbe *8
 4987 1EED  CD F018     	CALL	IRMON
 4988 1EF0  32 B7D6     	LD	(FARB),A	; Grafikfarbe eintragen
 4989 1EF3  83          	ADD	E		; + Hintergrundfarbe aus CC(1)
 4990                   ;	JR	U1F0D		; Farbwert eintragen
 4991                   ; 16.11.2023: Ferbwert nicht aendern, wenn CC() nicht vorhanden ist
 4992                   ;U1F0B:	LD	A,DEFCOL	; Standardfarbe
 4993                   ;U1F0D:
 4994 1EF4  32 B7A3     	LD	(COLOR),A	; neuen Farbwert fuer Textfarbe eintragen
 4995                   ; 17.11.2023: Farbe wird direkt aus COLOR gelesen
 4996                   ;	LD	(U1F25+1),A	; Programmcode modifizieren fuer Textanzeige im Grafikmode
 4997 1EF7  C3 0772     	JP	IOFRET		; IRM OFF, RET
 4998         0000      IF KC3
 5012                   ELSE
 5013                   ;
 5014                   ; Farbebene KC85/4 schreiben
 5015                   ;	
 5016 1EFA  F3          U1F1A:	DI			; Interrupt sperren, weil (IX+1) nicht aktualisiert wird
 5017 1EFB  DD 7E 01    	LD	A,(IX+1)
 5018 1EFE  F5          	PUSH	AF
 5019 1EFF  CB CF       	SET	1,A		; Wechsel zu Farbebene
 5020 1F01  D3 84       	OUT	(84H),A		; (IX+1) wird nicht aktualisiert, deshalb DI !!!
 5021                   ; 17.11.2023: Farbe wird direkt aus COLOR gelesen
 5022                   ;U1F25:	LD	A,20H		; hier wird der aktuelle Farbwert eingetragen
 5023 1F03  3A B7A3     	LD	A,(COLOR)	; sollte genauso funktionieren
 5024 1F06  77          	LD	(HL),A		; Farbwert eintragen in IRM
 5025 1F07  F1          	POP	AF
 5026 1F08  D3 84       	OUT	(84H),A	; Wechsel zurueck zu Pixelebene
 5027 1F0A  FB          	EI
 5028 1F0B  C9          	RET
 5029                   ENDIF
 5030                   ;
 5031                   ; Hier steht das BASIC-Programm, welches nur bei RUN sichtbar ist
 5032                   ; (bzw. mit GOSUB 100:LIST)
 5033                   ;
 5034 1F0C  00          	DB	0
 5035 1F0D  0000        	DW	0
 5036                   
 5037 1F0F              ZEILE2:	;	2! (C) Andreas und Uwe Zierott
 5038 1F0F  1F31        	DW	ZEILE4
 5039 1F11  0002        	DW	2		; Zeilennummer
 5040 1F13  9C          	DB	9CH		; REM
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  77
BAC85   Z80

 5041 1F14  20 28 43 29 	DB	' (C) Andreas und Uwe Zierott',0
 5042                   
 5043 1F31              ZEILE4:	;	4! Stand: 31.01.1990
 5044 1F31  1F49        	DW	ZEILE6
 5045 1F33  0004        	DW	4		; Zeilennummer
 5046 1F35  9C          	DB	9CH		; REM
 5047 1F36  20 53 74 61 	DB	' Stand: 31.01.1990',0
 5048                   
 5049 1F49              ZEILE6:	;	6! Farbe von Rudolf Wenzel
 5050 1F49  1F72        	DW	ZEILE8
 5051 1F4B  0006        	DW	6		; Zeilennummer
 5052 1F4D  9C          	DB	9CH		; REM
 5053         0000      IF KC3
 5055                   ELSE
 5056 1F4E  20 46 61 72 	DB	' Farbe von Rudolf Wenzel 08.12.1992',0
 5057                   ENDIF
 5058                   
 5059 1F72              ZEILE8:	;	8! Stand: 08.12.1992
 5060 1F72  1F9B        	DW	ZEIL10
 5061 1F74  0008        	DW	8		; Zeilennummer
 5062 1F76  9C          	DB	9CH		; REM
 5063         0000      IF KC3
 5065                   ELSE
 5066 1F77  20 4B 43 38 	DB	' KC85/5'
 5067                   ENDIF
 5068 1F7E  2D 41 6E 70 	DB	'-Anpassung von ML 03.01.2024',0
 5069                   
 5070 1F9B              ZEIL10:	;	10 GOTO 1000
 5071 1F9B  1FA5        	DW	ZEIL20
 5072 1F9D  000A        	DW	10		; Zeilennummer
 5073 1F9F  88          	DB	88H		; GOTO
 5074 1FA0  31 30 30 30 	DB	'1000',0
 5075                   
 5076 1FA5              ZEIL20:	;	20 CC(0)=5:CC(1)=2:CALL*1FC4:GOTO 1010
 5077                   	;	CC(0)=7	Zeichenfarbe weiss Standard
 5078                   	;	CC(1)=0	Hintergrundfarbe schwarz Standard
 5079 1FA5  1FC6        	DW	ZEI100
 5080 1FA7  0014        	DW	20		; Zeilennummer
 5081 1FA9  43 43 28 30 	DB	'CC(0)'
 5082 1FAE  B4          	DB	0B4H		; =
 5083 1FAF  37 3A 43 43 	DB	'7:CC(1)'
 5084 1FB6  B4          	DB	0B4H		; =
 5085 1FB7  30 3A       	DB	'0:'
 5086 1FB9  9D AE       	DB	9DH,0AEH	; CALL*
 5087                   	ASCTXT	GO20
    5 1FBB  31          		DB	(GO20/1000H AND 0FH) + 30H
   12 1FBC  30          		DB	(GO20/100H AND 0FH) + 30H
   16 1FBD  42          		DB	(GO20/10H AND 0FH) + 37H
   24 1FBE  34          		DB	(GO20 AND 0FH) + 30H
 5088 1FBF  3A          	DB	':'
 5089 1FC0  88          	DB	88H		; GOTO
 5090 1FC1  31 30 31 30 	DB	'1010',0
 5091                   
 5092 1FC6              ZEI100:	;	100 CALL*1FA1:RETURN
 5093 1FC6  1FD2        	DW	ZEI110
 5094 1FC8  0064        	DW	100		; Zeilennummer
 5095 1FCA  9D AE       	DB	9DH,0AEH	; CALL*
 5096                   	ASCTXT	GO100
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  78
BAC85   Z80

   12 1FCC  35          		DB	(GO100/100H AND 0FH) + 30H
   16 1FCD  44          		DB	(GO100/10H AND 0FH) + 37H
   24 1FCE  39          		DB	(GO100 AND 0FH) + 30H
 5097 1FCF  3A          	DB	':'
 5098 1FD0  8D 00       	DB	8DH,0		; RETURN
 5099                   
 5100 1FD2              ZEI110:	;	110 CALL*1FDA:RETURN
 5101 1FD2  1FDF        	DW	ZEI120
 5102 1FD4  006E        	DW	110
 5103 1FD6  9D AE       	DB	9DH,0AEH	; CALL*
 5104                   	ASCTXT	GO110
    5 1FD8  31          		DB	(GO110/1000H AND 0FH) + 30H
   12 1FD9  30          		DB	(GO110/100H AND 0FH) + 30H
   16 1FDA  46          		DB	(GO110/10H AND 0FH) + 37H
   22 1FDB  42          		DB	(GO110 AND 0FH) + 37H
 5105 1FDC  3A          	DB	':'
 5106 1FDD  8D 00       	DB	8DH,0		; RETURN
 5107                   
 5108 1FDF              ZEI120:	;	120 CALL*11BC:RETURN
 5109 1FDF  1FEC        	DW	ZEI150
 5110 1FE1  0078        	DW	120		; Zeilennummer
 5111 1FE3  9D AE       	DB	9DH,0AEH	; CALL*
 5112                   	ASCTXT	GO120
    5 1FE5  31          		DB	(GO120/1000H AND 0FH) + 30H
   12 1FE6  31          		DB	(GO120/100H AND 0FH) + 30H
   18 1FE7  33          		DB	(GO120/10H AND 0FH) + 30H
   22 1FE8  42          		DB	(GO120 AND 0FH) + 37H
 5113 1FE9  3A          	DB	':'
 5114 1FEA  8D 00       	DB	8DH,0		; RETURN
 5115                   
 5116 1FEC              ZEI150:	;	150 CALL*1FD3:RETURN
 5117 1FEC  1FF8        	DW	ZEI200
 5118 1FEE  0096        	DW	150		; Zeilennummer
 5119 1FF0  9D AE       	DB	9DH,0AEH	; CALL*
 5120                   	ASCTXT	GO150
   12 1FF2  35          		DB	(GO150/100H AND 0FH) + 30H
   16 1FF3  45          		DB	(GO150/10H AND 0FH) + 37H
   24 1FF4  33          		DB	(GO150 AND 0FH) + 30H
 5121 1FF5  3A          	DB	':'
 5122 1FF6  8D 00       	DB	8DH,0		; RETURN
 5123                   
 5124 1FF8              ZEI200:	;	200 CALL*11DF:RETURN
 5125 1FF8  2005        	DW	ZEI210
 5126 1FFA  00C8        	DW	200		; Zeilennummer
 5127 1FFC  9D AE       	DB	9DH,0AEH	; CALL*
 5128                   	ASCTXT	GO200
    5 1FFE  31          		DB	(GO200/1000H AND 0FH) + 30H
   12 1FFF  31          		DB	(GO200/100H AND 0FH) + 30H
   18 2000  35          		DB	(GO200/10H AND 0FH) + 30H
   24 2001  38          		DB	(GO200 AND 0FH) + 30H
 5129 2002  3A          	DB	':'
 5130 2003  8D 00       	DB	8DH,0		; RETURN
 5131                   
 5132 2005              ZEI210:	;	210 CALL*11E4:RETURN
 5133 2005  2012        	DW	ZEI220
 5134 2007  00D2        	DW	210		; Zeilennummer
 5135 2009  9D AE       	DB	9DH,0AEH	; CALL*
 5136                   	ASCTXT	GO210
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  79
BAC85   Z80

    5 200B  31          		DB	(GO210/1000H AND 0FH) + 30H
   12 200C  31          		DB	(GO210/100H AND 0FH) + 30H
   18 200D  35          		DB	(GO210/10H AND 0FH) + 30H
   22 200E  44          		DB	(GO210 AND 0FH) + 37H
 5137 200F  3A          	DB	':'
 5138 2010  8D 00       	DB	8DH,0		; RETURN
 5139                   
 5140 2012              ZEI220:	;	220 CALL*124F:RETURN
 5141 2012  201F        	DW	ZEI250
 5142 2014  00DC        	DW	220		; Zeilennummer
 5143 2016  9D AE       	DB	9DH,0AEH	; CALL*
 5144                   	ASCTXT	GO220
    5 2018  31          		DB	(GO220/1000H AND 0FH) + 30H
   12 2019  31          		DB	(GO220/100H AND 0FH) + 30H
   16 201A  43          		DB	(GO220/10H AND 0FH) + 37H
   24 201B  38          		DB	(GO220 AND 0FH) + 30H
 5145 201C  3A          	DB	':'
 5146 201D  8D 00       	DB	8DH,0		; RETURN
 5147                   
 5148 201F              ZEI250:	;	250 CALL*6F1:RETURN
 5149 201F  202B        	DW	ZEI260
 5150 2021  00FA        	DW	250		; Zeilennummer
 5151 2023  9D AE       	DB	9DH,0AEH	; CALL*
 5152                   	ASCTXT	GO250
   12 2025  37          		DB	(GO250/100H AND 0FH) + 30H
   18 2026  30          		DB	(GO250/10H AND 0FH) + 30H
   24 2027  36          		DB	(GO250 AND 0FH) + 30H
 5153 2028  3A          	DB	':'
 5154 2029  8D 00       	DB	8DH,0		; RETURN
 5155                   
 5156 202B              ZEI260:	;	260 CALL*1274:RETURN
 5157 202B  2038        	DW	ZEI270
 5158 202D  0104        	DW	260		; Zeilennummer
 5159 202F  9D AE       	DB	9DH,0AEH	; CALL*
 5160                   	ASCTXT	GO260
    5 2031  31          		DB	(GO260/1000H AND 0FH) + 30H
   12 2032  31          		DB	(GO260/100H AND 0FH) + 30H
   16 2033  45          		DB	(GO260/10H AND 0FH) + 37H
   22 2034  42          		DB	(GO260 AND 0FH) + 37H
 5161 2035  3A          	DB	':'
 5162 2036  8D 00       	DB	8DH,0		; RETURN
 5163                   
 5164 2038              ZEI270:	;	270 CALL*128D:RETURN
 5165 2038  2045        	DW	ZEI280
 5166 203A  010E        	DW	270		; Zeilennummer
 5167 203C  9D AE       	DB	9DH,0AEH	; CALL*
 5168                   	ASCTXT	GO270
    5 203E  31          		DB	(GO270/1000H AND 0FH) + 30H
   12 203F  32          		DB	(GO270/100H AND 0FH) + 30H
   18 2040  30          		DB	(GO270/10H AND 0FH) + 30H
   24 2041  34          		DB	(GO270 AND 0FH) + 30H
 5169 2042  3A          	DB	':'
 5170 2043  8D 00       	DB	8DH,0		; RETURN
 5171                   
 5172 2045              ZEI280:	;	280 CALL*12BC:RETURN
 5173 2045  2051        	DW	ZEI300
 5174 2047  0118        	DW	280		; Zeilennummer
 5175                   ; 11.11.2023 GUSOB 280 Funktion deaktiviert
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  80
BAC85   Z80

 5176                   ; 02.01.2024 wieder aktiviert
 5177 2049  9D AE       	DB	9DH,0AEH	; CALL*
 5178                   	ASCTXT	GO280
   12 204B  36          		DB	(GO280/100H AND 0FH) + 30H
   18 204C  34          		DB	(GO280/10H AND 0FH) + 30H
   22 204D  45          		DB	(GO280 AND 0FH) + 37H
 5179 204E  3A          	DB	':'
 5180 204F  8D 00       	DB	8DH,0		; RETURN
 5181                   
 5182 2051              ZEI300:	;	300 CALL*12CA:RETURN
 5183 2051  205E        	DW	ZEI310
 5184 2053  012C        	DW	300		; Zeilennummer
 5185 2055  9D AE       	DB	9DH,0AEH	; CALL*
 5186                   	ASCTXT	GO300
    5 2057  31          		DB	(GO300/1000H AND 0FH) + 30H
   12 2058  32          		DB	(GO300/100H AND 0FH) + 30H
   18 2059  33          		DB	(GO300/10H AND 0FH) + 30H
   24 205A  33          		DB	(GO300 AND 0FH) + 30H
 5187 205B  3A          	DB	':'
 5188 205C  8D 00       	DB	8DH,0		; RETURN
 5189                   
 5190 205E              ZEI310:	;	310 CALL*1317:RETURN
 5191 205E  206B        	DW	ZEI330
 5192 2060  0136        	DW	310		; Zeilennummer
 5193 2062  9D AE       	DB	9DH,0AEH	; CALL*
 5194                   	ASCTXT	GO310
    5 2064  31          		DB	(GO310/1000H AND 0FH) + 30H
   12 2065  32          		DB	(GO310/100H AND 0FH) + 30H
   18 2066  38          		DB	(GO310/10H AND 0FH) + 30H
   24 2067  30          		DB	(GO310 AND 0FH) + 30H
 5195 2068  3A          	DB	':'
 5196 2069  8D 00       	DB	8DH,0		; RETURN
 5197                   
 5198 206B              ZEI330:	;	330 CALL*141E:RETURN
 5199 206B  2078        	DW	ZEI350
 5200 206D  014A        	DW	330		; Zeilennummer
 5201 206F  9D AE       	DB	9DH,0AEH	; CALL*
 5202                   	ASCTXT	GO330
    5 2071  31          		DB	(GO330/1000H AND 0FH) + 30H
   12 2072  33          		DB	(GO330/100H AND 0FH) + 30H
   18 2073  38          		DB	(GO330/10H AND 0FH) + 30H
   24 2074  37          		DB	(GO330 AND 0FH) + 30H
 5203 2075  3A          	DB	':'
 5204 2076  8D 00       	DB	8DH,0		; RETURN
 5205                   
 5206 2078              ZEI350:	;	350 CALL*144C:RETURN
 5207 2078  2085        	DW	ZEI360
 5208 207A  015E        	DW	350		; Zeilennummer
 5209 207C  9D AE       	DB	9DH,0AEH	; CALL*
 5210                   	ASCTXT	GO350
    5 207E  31          		DB	(GO350/1000H AND 0FH) + 30H
   12 207F  33          		DB	(GO350/100H AND 0FH) + 30H
   16 2080  42          		DB	(GO350/10H AND 0FH) + 37H
   24 2081  35          		DB	(GO350 AND 0FH) + 30H
 5211 2082  3A          	DB	':'
 5212 2083  8D 00       	DB	8DH,0		; RETURN
 5213                   
 5214 2085              ZEI360:	;	360 CALL*145A:RETURN
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  81
BAC85   Z80

 5215 2085  2092        	DW	ZEI400
 5216 2087  0168        	DW	360		; Zeilennummer
 5217 2089  9D AE       	DB	9DH,0AEH	; CALL*
 5218                   	ASCTXT	GO360
    5 208B  31          		DB	(GO360/1000H AND 0FH) + 30H
   12 208C  33          		DB	(GO360/100H AND 0FH) + 30H
   16 208D  43          		DB	(GO360/10H AND 0FH) + 37H
   24 208E  33          		DB	(GO360 AND 0FH) + 30H
 5219 208F  3A          	DB	':'
 5220 2090  8D 00       	DB	8DH,0		; RETURN
 5221                   
 5222 2092              ZEI400:	;	400 CALL*1461:RETURN
 5223 2092  209F        	DW	ZEI450
 5224 2094  0190        	DW	400		; Zeilennummer
 5225 2096  9D AE       	DB	9DH,0AEH	; CALL*
 5226                   	ASCTXT	GO400
    5 2098  31          		DB	(GO400/1000H AND 0FH) + 30H
   12 2099  33          		DB	(GO400/100H AND 0FH) + 30H
   16 209A  43          		DB	(GO400/10H AND 0FH) + 37H
   22 209B  41          		DB	(GO400 AND 0FH) + 37H
 5227 209C  3A          	DB	':'
 5228 209D  8D 00       	DB	8DH,0		; RETURN
 5229                   
 5230 209F              ZEI450:	;	450 CALL*1485:RETURN
 5231 209F  20AC        	DW	ZEI500
 5232 20A1  01C2        	DW	450		; Zeilennummer
 5233 20A3  9D AE       	DB	9DH,0AEH	; CALL*
 5234                   	ASCTXT	GO450
    5 20A5  31          		DB	(GO450/1000H AND 0FH) + 30H
   12 20A6  33          		DB	(GO450/100H AND 0FH) + 30H
   16 20A7  45          		DB	(GO450/10H AND 0FH) + 37H
   22 20A8  45          		DB	(GO450 AND 0FH) + 37H
 5235 20A9  3A          	DB	':'
 5236 20AA  8D 00       	DB	8DH,0		; RETURN
 5237                   
 5238 20AC              ZEI500:	;	500 CALL*14D4:RETURN
 5239 20AC  20B9        	DW	ZEI540
 5240 20AE  01F4        	DW	500		; Zeilennummer
 5241 20B0  9D AE       	DB	9DH,0AEH	; CALL*
 5242                   	ASCTXT	GO500
    5 20B2  31          		DB	(GO500/1000H AND 0FH) + 30H
   12 20B3  34          		DB	(GO500/100H AND 0FH) + 30H
   18 20B4  33          		DB	(GO500/10H AND 0FH) + 30H
   22 20B5  44          		DB	(GO500 AND 0FH) + 37H
 5243 20B6  3A          	DB	':'
 5244 20B7  8D 00       	DB	8DH,0		; RETURN
 5245                   
 5246 20B9              ZEI540:	;	540 CALL*1533:RETURN
 5247 20B9  20C6        	DW	ZEI560
 5248 20BB  021C        	DW	540		; Zeilennummer
 5249 20BD  9D AE       	DB	9DH,0AEH	; CALL*
 5250                   	ASCTXT	GO540
    5 20BF  31          		DB	(GO540/1000H AND 0FH) + 30H
   12 20C0  34          		DB	(GO540/100H AND 0FH) + 30H
   16 20C1  42          		DB	(GO540/10H AND 0FH) + 37H
   24 20C2  38          		DB	(GO540 AND 0FH) + 30H
 5251 20C3  3A          	DB	':'
 5252 20C4  8D 00       	DB	8DH,0		; RETURN
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  82
BAC85   Z80

 5253                   
 5254 20C6              ZEI560:	;	560 CALL*1550:RETURN
 5255 20C6  20D3        	DW	ZEI580
 5256 20C8  0230        	DW	560		; Zeilennummer
 5257 20CA  9D AE       	DB	9DH,0AEH	; CALL*
 5258                   	ASCTXT	GO560
    5 20CC  31          		DB	(GO560/1000H AND 0FH) + 30H
   12 20CD  34          		DB	(GO560/100H AND 0FH) + 30H
   16 20CE  44          		DB	(GO560/10H AND 0FH) + 37H
   24 20CF  35          		DB	(GO560 AND 0FH) + 30H
 5259 20D0  3A          	DB	':'
 5260 20D1  8D 00       	DB	8DH,0		; RETURN
 5261                   
 5262 20D3              ZEI580:	;	580 CALL*155D:RETURN
 5263 20D3  20E0        	DW	ZEI600
 5264 20D5  0244        	DW	580		; Zeilennummer
 5265 20D7  9D AE       	DB	9DH,0AEH	; CALL*
 5266                   	ASCTXT	GO580
    5 20D9  31          		DB	(GO580/1000H AND 0FH) + 30H
   12 20DA  34          		DB	(GO580/100H AND 0FH) + 30H
   16 20DB  45          		DB	(GO580/10H AND 0FH) + 37H
   24 20DC  32          		DB	(GO580 AND 0FH) + 30H
 5267 20DD  3A          	DB	':'
 5268 20DE  8D 00       	DB	8DH,0		; RETURN
 5269                   
 5270 20E0              ZEI600:	;	600 CALL*1FA8:RETURN
 5271 20E0  20ED        	DW	ZEI620
 5272 20E2  0258        	DW	600		; Zeilennummer
 5273 20E4  9D AE       	DB	9DH,0AEH	; CALL*
 5274                   	ASCTXT	GO600
    5 20E6  31          		DB	(GO600/1000H AND 0FH) + 30H
   12 20E7  35          		DB	(GO600/100H AND 0FH) + 30H
   18 20E8  32          		DB	(GO600/10H AND 0FH) + 30H
   24 20E9  30          		DB	(GO600 AND 0FH) + 30H
 5275 20EA  3A          	DB	':'
 5276 20EB  8D 00       	DB	8DH,0		; RETURN
 5277                   
 5278 20ED              ZEI620:	;	620 CALL*1FAF:RETURN
 5279 20ED  20F9        	DW	ZEI630
 5280 20EF  026C        	DW	620		; Zeilennummer
 5281 20F1  9D AE       	DB	9DH,0AEH	; CALL*
 5282                   	ASCTXT	GO620
   12 20F3  37          		DB	(GO620/100H AND 0FH) + 30H
   18 20F4  33          		DB	(GO620/10H AND 0FH) + 30H
   22 20F5  41          		DB	(GO620 AND 0FH) + 37H
 5283 20F6  3A          	DB	':'
 5284 20F7  8D 00       	DB	8DH,0		; RETURN
 5285                   
 5286 20F9              ZEI630:	;	630 CALL*1FB6:RETURN
 5287 20F9  2105        	DW	ZEI650
 5288 20FB  0276        	DW	630		; Zeilennummer
 5289 20FD  9D AE       	DB	9DH,0AEH	; CALL*
 5290                   	ASCTXT	GO630
   12 20FF  37          		DB	(GO630/100H AND 0FH) + 30H
   18 2100  37          		DB	(GO630/10H AND 0FH) + 30H
   24 2101  36          		DB	(GO630 AND 0FH) + 30H
 5291 2102  3A          	DB	':'
 5292 2103  8D 00       	DB	8DH,0		; RETURN
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  83
BAC85   Z80

 5293                   
 5294 2105              ZEI650:	;	650 CALL*1FBD:RETURN
 5295 2105  2111        	DW	ZEI950
 5296 2107  028A        	DW	650		; Zeilennummer
 5297 2109  9D AE       	DB	9DH,0AEH	; CALL*
 5298                   	ASCTXT	GO650
   12 210B  37          		DB	(GO650/100H AND 0FH) + 30H
   16 210C  42          		DB	(GO650/10H AND 0FH) + 37H
   24 210D  32          		DB	(GO650 AND 0FH) + 30H
 5299 210E  3A          	DB	':'
 5300 210F  8D 00       	DB	8DH,0		; RETURN
 5301                   
 5302 2111              ZEI950:	;	950 CC(0)=6:CC(1)=1:CALL*1FE1
 5303                   	;	CC(0)=6	Zeichenfarbe gelb
 5304                   	;	CC(1)=1	Hintergrundfarbe blau
 5305 2111  212C        	DW	Z1000
 5306 2113  03B6        	DW	950		; Zeilennummer
 5307 2115  43 43 28 30 	DB	'CC(0)'
 5308 211A  B4          	DB	0B4H		; =
 5309 211B  36 3A 43 43 	DB	'6:CC(1)'
 5310 2122  B4          	DB	0B4H		; =
 5311 2123  31 3A       	DB	'1:'
 5312 2125  9D AE       	DB	9DH,0AEH	; CALL*
 5313                   	ASCTXT	GO950
    5 2127  31          		DB	(GO950/1000H AND 0FH) + 30H
   12 2128  35          		DB	(GO950/100H AND 0FH) + 30H
   18 2129  34          		DB	(GO950/10H AND 0FH) + 30H
   24 212A  31          		DB	(GO950 AND 0FH) + 30H
 5314 212B  00          	DB	0
 5315                   
 5316 212C  0000        Z1000:	DW	0		; Anfang BASIC-Programm
 5317 212E              U21F3:				; Ende BASCICODE
 5318                   ;
 5319                   ; V.24-Druckertreiber (wird nach BA00H kopiert und dort ausgefuehrt)
 5320                   ;
 5321                   	.phase	0BA00H
 5322 BA00  CD BAFE     UBA00:	CALL	UBAFE
 5323 BA03  76          UBA03:	HALT
 5324 BA04  DD 7E 0D    	LD	A,(IX+13)	; Tastencode
 5325 BA07  B7          	OR	A		; eingetragen?
 5326 BA08  20 F9       	JR	NZ,UBA03	; nein, weiter warten
 5327 BA0A  AF          	XOR	A
 5328 BA0B  32 BD7C     	LD	(UBD78),A
 5329 BA0E  76          UBA0E:	HALT
 5330 BA0F  3A BD7C     	LD	A,(UBD78)
 5331 BA12  B7          	OR	A
 5332 BA13  28 08       	JR	Z,UBA1D
 5333 BA15  CD F003     	CALL	PV1
 5334 BA18  0E          	DB	KBDZ
 5335 BA19  30 F3       	JR	NC,UBA0E
 5336 BA1B  18 06       	JR	UBA23
 5337                   	;
 5338 BA1D  DD 7E 0D    UBA1D:	LD	A,(IX+13)
 5339 BA20  B7          	OR	A
 5340 BA21  28 EB       	JR	Z,UBA0E
 5341 BA23  FE 08       UBA23:	CP	8
 5342 BA25  20 10       	JR	NZ,UBA37
 5343 BA27  2A BD78     	LD	HL,(UBD74)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  84
BAC85   Z80

 5344 BA2A  7C          	LD	A,H
 5345 BA2B  B5          	OR	L
 5346 BA2C  28 E0       	JR	Z,UBA0E
 5347 BA2E  2B          	DEC	HL
 5348 BA2F  22 BD78     	LD	(UBD74),HL
 5349 BA32  CD BB19     	CALL	UBB19
 5350 BA35  18 D7       	JR	UBA0E
 5351                   	;
 5352 BA37  FE 09       UBA37:	CP	9
 5353 BA39  20 14       	JR	NZ,UBA4F
 5354 BA3B  2A BD76     	LD	HL,(UBD72)
 5355 BA3E  11 013F     	LD	DE,013FH
 5356 BA41  CD BD5D     	CALL	UBD59
 5357 BA44  28 C8       	JR	Z,UBA0E
 5358 BA46  23          	INC	HL
 5359 BA47  22 BD76     	LD	(UBD72),HL
 5360 BA4A  CD BB1F     	CALL	UBB1F
 5361 BA4D  18 BF       	JR	UBA0E
 5362                   	;
 5363 BA4F  FE 0A       UBA4F:	CP	0AH
 5364 BA51  20 10       	JR	NZ,UBA63
 5365 BA53  3A BD7A     	LD	A,(UBD76)
 5366 BA56  FE FF       	CP	0FFH
 5367 BA58  28 B4       	JR	Z,UBA0E
 5368 BA5A  3C          	INC	A
 5369 BA5B  32 BD7A     	LD	(UBD76),A
 5370 BA5E  CD BB35     	CALL	UBB35
 5371 BA61  18 AB       	JR	UBA0E
 5372                   	;
 5373 BA63  FE 0B       UBA63:	CP	0BH
 5374 BA65  20 0F       	JR	NZ,UBA76
 5375 BA67  3A BD7B     	LD	A,(UBD77)
 5376 BA6A  B7          	OR	A
 5377 BA6B  28 A1       	JR	Z,UBA0E
 5378 BA6D  3D          	DEC	A
 5379 BA6E  32 BD7B     	LD	(UBD77),A
 5380 BA71  CD BB2F     	CALL	UBB2F
 5381 BA74  18 98       	JR	UBA0E
 5382                   	;
 5383 BA76  FE 19       UBA76:	CP	19H
 5384 BA78  20 16       	JR	NZ,UBA90
 5385 BA7A  2A BD76     	LD	HL,(UBD72)
 5386 BA7D  ED 5B BD78  	LD	DE,(UBD74)
 5387 BA81  CD BD5D     	CALL	UBD59
 5388 BA84  28 88       	JR	Z,UBA0E
 5389 BA86  CD BB1F     	CALL	UBB1F
 5390 BA89  2B          	DEC	HL
 5391 BA8A  22 BD76     	LD	(UBD72),HL
 5392 BA8D  C3 BA0E     	JP	UBA0E
 5393                   	;
 5394 BA90  FE 18       UBA90:	CP	18H
 5395 BA92  20 17       	JR	NZ,UBAAB
 5396 BA94  2A BD78     	LD	HL,(UBD74)
 5397 BA97  ED 5B BD76  	LD	DE,(UBD72)
 5398 BA9B  CD BD5D     	CALL	UBD59
 5399 BA9E  CA BA0E     	JP	Z,UBA0E
 5400 BAA1  CD BB19     	CALL	UBB19
 5401 BAA4  23          	INC	HL
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  85
BAC85   Z80

 5402 BAA5  22 BD78     	LD	(UBD74),HL
 5403 BAA8  C3 BA0E     	JP	UBA0E
 5404                   	;
 5405 BAAB  FE 12       UBAAB:	CP	12H
 5406 BAAD  20 15       	JR	NZ,UBAC4
 5407 BAAF  3A BD7A     	LD	A,(UBD76)
 5408 BAB2  47          	LD	B,A
 5409 BAB3  3A BD7B     	LD	A,(UBD77)
 5410 BAB6  B8          	CP	B
 5411 BAB7  CA BA0E     	JP	Z,UBA0E
 5412 BABA  CD BB2F     	CALL	UBB2F
 5413 BABD  3C          	INC	A
 5414 BABE  32 BD7B     	LD	(UBD77),A
 5415 BAC1  C3 BA0E     	JP	UBA0E
 5416                   	;
 5417 BAC4  FE 11       UBAC4:	CP	11H
 5418 BAC6  20 15       	JR	NZ,UBADD
 5419 BAC8  3A BD7B     	LD	A,(UBD77)
 5420 BACB  47          	LD	B,A
 5421 BACC  3A BD7A     	LD	A,(UBD76)
 5422 BACF  B8          	CP	B
 5423 BAD0  CA BA0E     	JP	Z,UBA0E
 5424 BAD3  CD BB35     	CALL	UBB35
 5425 BAD6  3D          	DEC	A
 5426 BAD7  32 BD7A     	LD	(UBD76),A
 5427 BADA  C3 BA0E     	JP	UBA0E
 5428                   	;
 5429 BADD  FE 16       UBADD:	CP	16H
 5430 BADF  20 11       	JR	NZ,UBAF2
 5431 BAE1  76          UBAE1:	HALT
 5432 BAE2  DD 7E 0D    	LD	A,(IX+13)
 5433 BAE5  B7          	OR	A
 5434 BAE6  20 F9       	JR	NZ,UBAE1
 5435 BAE8  3A BD7C     	LD	A,(UBD78)
 5436 BAEB  2F          	CPL
 5437 BAEC  32 BD7C     	LD	(UBD78),A
 5438 BAEF  C3 BA0E     	JP	UBA0E
 5439                   	;
 5440 BAF2  FE 0D       UBAF2:	CP	0DH
 5441 BAF4  28 08       	JR	Z,UBAFE
 5442 BAF6  FE 10       	CP	10H
 5443 BAF8  CC BAFE     	CALL	Z,UBAFE
 5444 BAFB  C3 BA0E     	JP	UBA0E
 5445                   ;
 5446 BAFE  3A BD7B     UBAFE:	LD	A,(UBD77)
 5447 BB01  47          	LD	B,A
 5448 BB02  3A BD7A     	LD	A,(UBD76)
 5449 BB05  2A BD78     	LD	HL,(UBD74)
 5450 BB08  ED 5B BD76  	LD	DE,(UBD72)
 5451 BB0C  B8          UBB0C:	CP	B
 5452 BB0D  28 06       	JR	Z,UBB15
 5453 BB0F  CD BB6F     	CALL	UBB6F
 5454 BB12  3D          	DEC	A
 5455 BB13  18 F7       	JR	UBB0C
 5456                   	;
 5457 BB15  CD BB6F     UBB15:	CALL	UBB6F
 5458 BB18  C9          	RET
 5459                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  86
BAC85   Z80

 5460 BB19  E5          UBB19:	PUSH	HL
 5461 BB1A  2A BD78     	LD	HL,(UBD74)
 5462 BB1D  18 04       	JR	UBB23
 5463                   	;
 5464 BB1F  E5          UBB1F:	PUSH	HL
 5465 BB20  2A BD76     	LD	HL,(UBD72)
 5466 BB23  3A BD7A     UBB23:	LD	A,(UBD76)
 5467 BB26  47          	LD	B,A
 5468 BB27  3A BD7B     	LD	A,(UBD77)
 5469 BB2A  CD BB45     	CALL	UBB45
 5470 BB2D  E1          	POP	HL
 5471 BB2E  C9          	RET
 5472                   
 5473 BB2F  F5          UBB2F:	PUSH	AF
 5474 BB30  3A BD7B     	LD	A,(UBD77)
 5475 BB33  18 04       	JR	UBB39
 5476                   	;
 5477 BB35  F5          UBB35:	PUSH	AF
 5478 BB36  3A BD7A     	LD	A,(UBD76)
 5479 BB39  2A BD78     UBB39:	LD	HL,(UBD74)
 5480 BB3C  ED 5B BD76  	LD	DE,(UBD72)
 5481 BB40  CD BB6F     	CALL	UBB6F
 5482 BB43  F1          	POP	AF
 5483 BB44  C9          	RET
 5484                   
 5485 BB45  D5          UBB45:	PUSH	DE
 5486 BB46  F5          	PUSH	AF
 5487 BB47  E5          	PUSH	HL
 5488 BB48  C5          	PUSH	BC
 5489 BB49  CD BBA2     	CALL	UBBA2
 5490 BB4C  08          	EX	AF,AF'
 5491 BB4D  AF          	XOR	A
 5492 BB4E  04          	INC	B
 5493 BB4F  37          	SCF
 5494 BB50  1F          UBB50:	RRA
 5495 BB51  10 FD       	DJNZ	UBB50
 5496 BB53  08          	EX	AF,AF'
 5497 BB54  C1          	POP	BC
 5498 BB55  E1          	POP	HL
 5499 BB56  E5          	PUSH	HL
 5500 BB57  CD BBB7     	CALL	UBBB7
 5501 BB5A  3D          	DEC	A
 5502 BB5B  3C          UBB5B:	INC	A
 5503 BB5C  E5          	PUSH	HL
 5504 BB5D  65          	LD	H,L
 5505 BB5E  CB FC       	SET	7,H
 5506 BB60  6F          	LD	L,A
 5507 BB61  08          	EX	AF,AF'
 5508 BB62  F5          	PUSH	AF
 5509 BB63  AE          	XOR	(HL)
 5510 BB64  77          	LD	(HL),A
 5511 BB65  F1          	POP	AF
 5512 BB66  08          	EX	AF,AF'
 5513 BB67  E1          	POP	HL
 5514 BB68  B8          	CP	B
 5515 BB69  20 F0       	JR	NZ,UBB5B
 5516 BB6B  E1          	POP	HL
 5517 BB6C  F1          	POP	AF
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  87
BAC85   Z80

 5518 BB6D  D1          	POP	DE
 5519 BB6E  C9          	RET
 5520                   ;
 5521 BB6F  D5          UBB6F:	PUSH	DE
 5522 BB70  E5          	PUSH	HL
 5523 BB71  C5          	PUSH	BC
 5524 BB72  F5          	PUSH	AF
 5525 BB73  EB          	EX	DE,HL
 5526 BB74  CD BBA2     	CALL	UBBA2
 5527 BB77  48          	LD	C,B
 5528 BB78  EB          	EX	DE,HL
 5529 BB79  CD BBA2     	CALL	UBBA2
 5530 BB7C  E5          	PUSH	HL
 5531 BB7D  B7          	OR	A
 5532 BB7E  ED 52       	SBC	HL,DE
 5533 BB80  E1          	POP	HL
 5534 BB81  28 15       	JR	Z,UBB98
 5535 BB83  C5          	PUSH	BC
 5536 BB84  0E 07       	LD	C,7
 5537 BB86  CD BBC0     	CALL	UBBC0
 5538 BB89  C1          	POP	BC
 5539 BB8A  06 00       	LD	B,0
 5540 BB8C  AE          	XOR	(HL)
 5541 BB8D  77          UBB8D:	LD	(HL),A
 5542 BB8E  24          	INC	H
 5543 BB8F  CD BBD7     	CALL	UBBD7
 5544 BB92  28 04       	JR	Z,UBB98
 5545 BB94  7E          	LD	A,(HL)
 5546 BB95  2F          	CPL
 5547 BB96  18 F5       	JR	UBB8D
 5548                   	;
 5549 BB98  CD BBC0     UBB98:	CALL	UBBC0
 5550 BB9B  AE          	XOR	(HL)
 5551 BB9C  77          	LD	(HL),A
 5552 BB9D  F1          	POP	AF
 5553 BB9E  C1          	POP	BC
 5554 BB9F  E1          	POP	HL
 5555 BBA0  D1          	POP	DE
 5556 BBA1  C9          	RET
 5557                   ;
 5558 BBA2  D5          UBBA2:	PUSH	DE
 5559 BBA3  54          	LD	D,H
 5560 BBA4  5D          	LD	E,L
 5561 BBA5  CD BBB7     	CALL	UBBB7
 5562 BBA8  E5          	PUSH	HL
 5563 BBA9  29          	ADD	HL,HL
 5564 BBAA  29          	ADD	HL,HL
 5565 BBAB  29          	ADD	HL,HL
 5566 BBAC  EB          	EX	DE,HL
 5567 BBAD  ED 52       	SBC	HL,DE
 5568 BBAF  45          	LD	B,L
 5569 BBB0  E1          	POP	HL
 5570 BBB1  65          	LD	H,L
 5571 BBB2  CB FC       	SET	7,H
 5572 BBB4  6F          	LD	L,A
 5573 BBB5  D1          	POP	DE
 5574 BBB6  C9          	RET
 5575                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  88
BAC85   Z80

 5576 BBB7  29          UBBB7:	ADD	HL,HL
 5577 BBB8  29          	ADD	HL,HL
 5578 BBB9  29          	ADD	HL,HL
 5579 BBBA  29          	ADD	HL,HL
 5580 BBBB  29          	ADD	HL,HL
 5581 BBBC  6C          	LD	L,H
 5582 BBBD  26 00       	LD	H,0
 5583 BBBF  C9          	RET
 5584                   ;
 5585 BBC0  C5          UBBC0:	PUSH	BC
 5586 BBC1  79          	LD	A,C
 5587 BBC2  90          	SUB	B
 5588 BBC3  3C          	INC	A
 5589 BBC4  48          	LD	C,B
 5590 BBC5  47          	LD	B,A
 5591 BBC6  79          	LD	A,C
 5592 BBC7  B7          	OR	A
 5593 BBC8  20 02       	JR	NZ,UBBCC
 5594 BBCA  0E 08       	LD	C,8
 5595 BBCC  AF          UBBCC:	XOR	A
 5596 BBCD  37          UBBCD:	SCF
 5597 BBCE  1F          	RRA
 5598 BBCF  10 FC       	DJNZ	UBBCD
 5599 BBD1  41          	LD	B,C
 5600 BBD2  0F          UBBD2:	RRCA
 5601 BBD3  10 FD       	DJNZ	UBBD2
 5602 BBD5  C1          	POP	BC
 5603 BBD6  C9          	RET
 5604                   ;
 5605 BBD7  E5          UBBD7:	PUSH	HL
 5606 BBD8  B7          	OR	A
 5607 BBD9  ED 52       	SBC	HL,DE
 5608 BBDB  E1          	POP	HL
 5609 BBDC  C9          	RET
 5610                   
 5611 BBDD  00          UBBDD:	DB	0		; hier stand schon 7F7FH drin ???
 5612 BBDE  7F          	DB	7FH		; wird nur zu 7F7FH, wenn V.24-Modul vorhanden
 5613 BBDF  56 32 34 49 	DB	'V24I'
 5614 BBE3  01          	DB	1
 5615 BBE4  21 B781     	LD	HL,ARGN
 5616 BBE7  11 BD73     	LD	DE,UBD6F
 5617 BBEA  46          	LD	B,(HL)		; Anzahl Argumente
 5618 BBEB  04          	INC	B
 5619 BBEC  18 04       	JR	UBBF2
 5620                   	;
 5621 BBEE  7E          UBBEE:	LD	A,(HL)
 5622 BBEF  12          	LD	(DE),A
 5623 BBF0  13          	INC	DE
 5624 BBF1  23          	INC	HL
 5625 BBF2  23          UBBF2:	INC	HL
 5626 BBF3  10 F9       	DJNZ	UBBEE
 5627                   ;
 5628                   ; V.24-Treiber initialisieren
 5629 BBF5  AF          UBBF5:	XOR	A
 5630 BBF6  32 BD81     	LD	(UBD7D),A
 5631 BBF9  01 0780     	LD	BC,0780H	; ab Steckplatz 7
 5632 BBFC  ED 78       UBBFC:	IN	A,(C)		; Kennbyte lesen
 5633 BBFE  FE EE       	CP	0EEH		; M003?
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  89
BAC85   Z80

 5634 BC00  28 09       	JR	Z,UBC0A		; ja, V.24-Modul gefunden
 5635 BC02  04          	INC	B		; Suche vorwarts
 5636 BC03  20 F7       	JR	NZ,UBBFC	; bis B=0
 5637 BC05  3E FF       UBC04:	LD	A,0FFH
 5638 BC07  32 BD81     	LD	(UBD7D),A
 5639 BC0A  C9          	RET
 5640                   	;
 5641 BC0B  3E 7F       UBC0A:	LD	A,7FH		; Prolog
 5642 BC0D  32 BBDD     	LD	(UBBDD),A	; aktivieren
 5643 BC10  3E 01       	LD	A,1
 5644 BC12  ED 79       	OUT	(C),A		; Modul einschalten
 5645 BC14  69          	LD	L,C
 5646 BC15  26 B8       	LD	H,0B8H
 5647 BC17  77          	LD	(HL),A		; und in Modultabelle eintragen
 5648 BC18  21 BD37     	LD	HL,UBD33	; Druckerausgabe-Routine
 5649 BC1B  22 B7BE     	LD	(UOUT1+1),HL
 5650 BC1E  21 BC70     	LD	HL,UBC6C	; Hardcopy-Routine
 5651 BC21  22 B799     	LD	(HCADR),HL
 5652 BC24  01 020C     	LD	BC,020CH	; 2 Byte an Portadresse 0CH
 5653 BC27  21 BD63     	LD	HL,UBD5F	; Initialisierungsdaten
 5654 BC2A  F3          	DI
 5655 BC2B  ED B3       	OTIR			; CTC initialisieren
 5656 BC2D  01 060A     	LD	BC,060AH	; 6 Byte an Portadresse 0AH
 5657 BC30  ED B3       	OTIR			; SIO initialisieren
 5658 BC32  FB          	EI
 5659 BC33  21 BD6B     	LD	HL,UBD67	; Initialisierungsdaten Drucker
 5660 BC36  06 08       	LD	B,8
 5661 BC38  C5          UBC34:	PUSH	BC
 5662 BC39  3E 01       	LD	A,1
 5663 BC3B  CD F003     	CALL	PV1
 5664 BC3E  14          	DB	WAIT
 5665 BC3F  C1          	POP	BC
 5666 BC40  DB 0A       	IN	A,(0AH)
 5667 BC42  CB 57       	BIT	2,A
 5668 BC44  28 BF       	JR	Z,UBC04
 5669 BC46  7E          	LD	A,(HL)
 5670 BC47  D3 08       	OUT	(8),A
 5671 BC49  23          	INC	HL
 5672 BC4A  10 EC       	DJNZ	UBC34
 5673 BC4C  C3 BD3E     	JP	UBD3A
 5674                   ;
 5675 BC4F  F5          UBC4B:	PUSH	AF
 5676 BC50  DB 0A       UBC4C:	IN	A,(0AH)
 5677 BC52  CB 57       	BIT	2,A
 5678 BC54  20 10       	JR	NZ,UBC62
 5679 BC56  3A BD81     	LD	A,(UBD7D)
 5680 BC59  B7          	OR	A
 5681 BC5A  20 12       	JR	NZ,UBC6A
 5682 BC5C  C5          	PUSH	BC
 5683 BC5D  3E 01       	LD	A,1
 5684 BC5F  CD F003     	CALL	PV1
 5685 BC62  14          	DB	WAIT
 5686 BC63  C1          	POP	BC
 5687 BC64  18 EA       	JR	UBC4C
 5688                   	;
 5689 BC66  AF          UBC62:	XOR	A
 5690 BC67  32 BD81     	LD	(UBD7D),A
 5691 BC6A  F1          	POP	AF
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  90
BAC85   Z80

 5692 BC6B  D3 08       	OUT	(8),A
 5693 BC6D  C9          	RET
 5694                   	;
 5695 BC6E  F1          UBC6A:	POP	AF
 5696 BC6F  C9          	RET
 5697                   ;
 5698                   ; Hardcopy-Routine
 5699                   ;
 5700 BC70  D5          UBC6C:	PUSH	DE
 5701 BC71  CD BA00     	CALL	UBA00
 5702 BC74  3A BD73     	LD	A,(UBD6F)
 5703 BC77  47          	LD	B,A
 5704 BC78  2A BD76     	LD	HL,(UBD72)
 5705 BC7B  ED 5B BD78  	LD	DE,(UBD74)
 5706 BC7F  B7          	OR	A
 5707 BC80  ED 52       	SBC	HL,DE
 5708 BC82  23          	INC	HL
 5709 BC83  EB          	EX	DE,HL
 5710 BC84  21 0000     	LD	HL,0
 5711 BC87  19          UBC83:	ADD	HL,DE
 5712 BC88  10 FD       	DJNZ	UBC83
 5713 BC8A  22 BD7F     	LD	(UBD7B),HL
 5714 BC8D  3A BD74     	LD	A,(UBD70)
 5715 BC90  47          	LD	B,A
 5716 BC91  3A BD7B     	LD	A,(UBD77)
 5717 BC94  4F          	LD	C,A
 5718 BC95  2A BD78     UBC91:	LD	HL,(UBD74)
 5719 BC98  22 BD7C     	LD	(UBD78),HL
 5720 BC9B  DD 7E 0D    	LD	A,(IX+13)
 5721 BC9E  FE 03       	CP	3
 5722 BCA0  28 43       	JR	Z,UBCE1
 5723 BCA2  CD BD1A     	CALL	UBD16
 5724 BCA5  C5          UBCA1:	PUSH	BC
 5725 BCA6  16 08       	LD	D,8
 5726 BCA8  AF          	XOR	A
 5727 BCA9  32 BD7E     	LD	(UBD7A),A
 5728 BCAC  CD BCEB     UBCA8:	CALL	UBCE7
 5729 BCAF  08          	EX	AF,AF'
 5730 BCB0  CB 0B       	RRC	E
 5731 BCB2  17          	RLA
 5732 BCB3  08          	EX	AF,AF'
 5733 BCB4  10 05       	DJNZ	UBCB7
 5734 BCB6  3A BD74     	LD	A,(UBD70)
 5735 BCB9  47          	LD	B,A
 5736 BCBA  0C          	INC	C
 5737 BCBB  15          UBCB7:	DEC	D
 5738 BCBC  20 EE       	JR	NZ,UBCA8
 5739 BCBE  3A BD73     	LD	A,(UBD6F)
 5740 BCC1  C5          	PUSH	BC
 5741 BCC2  47          	LD	B,A
 5742 BCC3  08          	EX	AF,AF'
 5743 BCC4  CD BC4F     UBCC0:	CALL	UBC4B
 5744 BCC7  10 FB       	DJNZ	UBCC0
 5745 BCC9  C1          	POP	BC
 5746 BCCA  D5          	PUSH	DE
 5747 BCCB  2A BD7C     	LD	HL,(UBD78)
 5748 BCCE  ED 5B BD76  	LD	DE,(UBD72)
 5749 BCD2  CD BD5D     	CALL	UBD59
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  91
BAC85   Z80

 5750 BCD5  D1          	POP	DE
 5751 BCD6  28 07       	JR	Z,UBCDB
 5752 BCD8  C1          	POP	BC
 5753 BCD9  23          	INC	HL
 5754 BCDA  22 BD7C     	LD	(UBD78),HL
 5755 BCDD  18 C6       	JR	UBCA1
 5756                   	;
 5757 BCDF  E1          UBCDB:	POP	HL
 5758 BCE0  CD BD09     	CALL	UBD05
 5759 BCE3  28 B0       	JR	Z,UBC91
 5760 BCE5  D1          UBCE1:	POP	DE
 5761 BCE6  DD CB 08 86 	RES	0,(IX+8)
 5762 BCEA  C9          	RET
 5763                   ;
 5764 BCEB  D5          UBCE7:	PUSH	DE
 5765 BCEC  C5          	PUSH	BC
 5766 BCED  CD BD09     	CALL	UBD05
 5767 BCF0  20 0C       	JR	NZ,UBCFA
 5768 BCF2  2A BD7C     	LD	HL,(UBD78)
 5769 BCF5  79          	LD	A,C
 5770 BCF6  CD BBA2     	CALL	UBBA2
 5771 BCF9  04          	INC	B
 5772 BCFA  7E          	LD	A,(HL)
 5773 BCFB  17          UBCF7:	RLA
 5774 BCFC  10 FD       	DJNZ	UBCF7
 5775 BCFE  C1          UBCFA:	POP	BC
 5776 BCFF  38 04       	JR	C,UBD01
 5777 BD01  D1          	POP	DE
 5778 BD02  1E 00       	LD	E,0
 5779 BD04  C9          	RET
 5780                   	;
 5781 BD05  D1          UBD01:	POP	DE
 5782 BD06  1E FF       	LD	E,0FFH
 5783 BD08  C9          	RET
 5784                   ;
 5785 BD09  3A BD7A     UBD05:	LD	A,(UBD76)
 5786 BD0C  B9          	CP	C
 5787 BD0D  28 05       	JR	Z,UBD10
 5788 BD0F  3A BD7E     	LD	A,(UBD7A)
 5789 BD12  B7          	OR	A
 5790 BD13  C9          	RET
 5791                   	;
 5792 BD14  3E FF       UBD10:	LD	A,0FFH
 5793 BD16  32 BD7E     	LD	(UBD7A),A
 5794 BD19  C9          	RET
 5795                   ;
 5796 BD1A  CD BD3E     UBD16:	CALL	UBD3A
 5797 BD1D  3E 1B       	LD	A,ESC
 5798 BD1F  CD BC4F     	CALL	UBC4B
 5799 BD22  3E 2A       	LD	A,'*'
 5800 BD24  CD BC4F     	CALL	UBC4B
 5801 BD27  3E 05       	LD	A,5
 5802 BD29  CD BC4F     	CALL	UBC4B
 5803 BD2C  2A BD7F     	LD	HL,(UBD7B)
 5804 BD2F  7D          	LD	A,L
 5805 BD30  CD BC4F     	CALL	UBC4B
 5806 BD33  7C          	LD	A,H
 5807 BD34  C3 BC4F     	JP	UBC4B
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  92
BAC85   Z80

 5808                   ;
 5809                   ; Druckerausgabe UOT1
 5810                   ;
 5811 BD37  FE 0D       UBD33:	CP	CR
 5812 BD39  C2 BC4F     	JP	NZ,UBC4B
 5813 BD3C  18 05       	JR	UBD3F
 5814                   	;
 5815 BD3E  3E 0A       UBD3A:	LD	A,LF
 5816 BD40  CD BC4F     	CALL	UBC4B
 5817 BD43  E5          UBD3F:	PUSH	HL
 5818 BD44  F5          	PUSH	AF
 5819 BD45  C5          	PUSH	BC
 5820 BD46  3E 0D       	LD	A,0DH
 5821 BD48  CD BC4F     	CALL	UBC4B
 5822 BD4B  3A BD75     	LD	A,(UBD71)
 5823 BD4E  47          	LD	B,A
 5824 BD4F  04          	INC	B
 5825 BD50  3E 20       	LD	A,20H
 5826 BD52  18 03       	JR	UBD53
 5827                   	;
 5828 BD54  CD BC4F     UBD50:	CALL	UBC4B
 5829 BD57  10 FB       UBD53:	DJNZ	UBD50
 5830 BD59  C1          	POP	BC
 5831 BD5A  F1          	POP	AF
 5832 BD5B  E1          	POP	HL
 5833 BD5C  C9          	RET
 5834                   ;
 5835 BD5D  E5          UBD59:	PUSH	HL
 5836 BD5E  B7          	OR	A
 5837 BD5F  ED 52       	SBC	HL,DE
 5838 BD61  E1          	POP	HL
 5839 BD62  C9          	RET
 5840                   ;
 5841                   ; Initialisierungsdaten CTC, SIO
 5842                   ;
 5843 BD63  47          UBD5F:	DB	47H		; CTC Steuerbyte
 5844 BD64  5B          	DB	5BH		; CTC Zeitkonstante
 5845 BD65  04 04       	DB	04H,04H		; SIO WR4
 5846 BD67  03 20       	DB	03H,20H		; SIO WR3
 5847 BD69  05 6A       	DB	05H,6AH		; SIO WR5
 5848                   ;
 5849                   ; Initialisierungsdaten Drucker
 5850                   ;
 5851 BD6B  1B 40       UBD67:	DB	ESC,'@'		; Drucker initialisieren
 5852 BD6D  1B 52 00    	DB	ESC,'R',0	; Zeichensatz USA
 5853 BD70  1B 41 08    	DB	ESC,'A',8	; Zeilenabstand 8/72 Zoll
 5854                   
 5855 BD73  01          UBD6F:	DB	1
 5856 BD74  01          UBD70:	DB	1
 5857 BD75  0A          UBD71:	DB	10
 5858 BD76  F0          UBD72:	DB	0F0H
 5859 BD77  00          	DB	0
 5860 BD78  50          UBD74:	DB	50H
 5861 BD79  00          	DB	0
 5862 BD7A  C0          UBD76:	DB	0C0H
 5863 BD7B  40          UBD77:	DB	40H
 5864 BD7C              UBD78:
 5865         BD7E      UBD7A	EQU	$+2
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  93
BAC85   Z80

 5866         BD7F      UBD7B	EQU	$+3
 5867         BD81      UBD7D	EQU	$+5
 5868                   	.dephase	; Ende des V.24-Treibers
 5869                   
 5870 24AA  1D          U256B:	DB	1DH	; Autostart BASIC-Programm
 0 Error(s) Detected.
 8364 Absolute Bytes. 667 Symbols Detected.
      ;
 5851 BD6B  1B 40       UBD67:	DB	ESC,'@'		; Drucker initialisieren
 5852 BD6D  1B 52 00  